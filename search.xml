<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>é…’åº—ç®¡ç†ç³»ç»Ÿ-ç”¨æˆ·æ¨¡å—</title>
      <link href="/2023/09/05/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97/"/>
      <url>/2023/09/05/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h3 id="æƒé™è®¤è¯"><a href="#æƒé™è®¤è¯" class="headerlink" title="æƒé™è®¤è¯"></a>æƒé™è®¤è¯</h3><p>ä»¥å‰å†™é¡¹ç›®çš„æ—¶å€™æ ¹æœ¬æ²¡æœ‰æ€ä¹ˆè€ƒè™‘è¿‡æƒé™é—®é¢˜ï¼Œå¾ˆç®€å•çš„åšäº†ä¸€ä¸ªtokenéªŒè¯å°±ç»“æŸäº†ï¼Œç°åœ¨è‡ªå·±å¼€å§‹è€ƒè™‘åˆ°è¿™äº›é—®é¢˜å‘ç°è‡ªå·±æ ¹æœ¬æƒ³ä¸åˆ°ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>é¦–å…ˆæ‹…å¿ƒçš„æ˜¯åŒè§’è‰²ä¹‹é—´èµ„æºçš„ç›¸äº’è®¿é—®é—®é¢˜ï¼Œä¹Ÿè®¸å¯ä»¥é€šè¿‡éªŒè¯ç”¨æˆ·çš„è§’è‰²èº«ä»½æ¥è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœåŒè§’è‰²è¯•å›¾è®¿é—®å…¶ä»–ç”¨æˆ·çš„èµ„æºï¼Œä¸å¯¹tokenä¸­çš„ç”¨æˆ·idè¿›è¡Œè§£ææ˜¯æ²¡æ³•è§£å†³çš„ã€‚è¿™æ ·çš„è¯æˆ‘åœ¨Gatewayçš„å¾®æœåŠ¡ä¸­è¿˜éœ€è¦æ·»åŠ ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œæˆ‘ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¿…é¡»å¦‚æ­¤â€¦æˆ‘ä¸»è§‚ä¸Šæ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œç¡®å®æƒ³ä¸åˆ°æ›´ä¼˜é›…çš„åŠæ³•ï¼Œä½†æ˜¯æ„Ÿè§‰è¿™æ ·å­ä¼šå¾ˆç¬¨ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exchange åŒ…å«è¯·æ±‚å¤´ï¼Œè¯·æ±‚ä½“çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> chain è¿‡æ»¤å™¨é“¾ï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨å°†å…¶æ”¾è¡Œè‡³ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> Monoç±»å‹çš„ç»“æœï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨åªéœ€è¦è¿”å›chain.filter(exchange)å³å¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">    <span class="comment">//  è·å–è¯·æ±‚</span></span><br><span class="line">    <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">    <span class="comment">//  ä»è¯·æ±‚ä¸­è·å–è¯·æ±‚å¤´</span></span><br><span class="line">    <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> request.getHeaders();</span><br><span class="line">    <span class="comment">//  è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">requestPath</span> <span class="operator">=</span> request.getURI().getPath();</span><br><span class="line">    <span class="comment">//  åˆ¤æ–­æ˜¯å¦éœ€è¦æ ¸éªŒtoken</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//  éœ€è¦token</span></span><br><span class="line">    <span class="keyword">if</span>(tokenShouldCheck(requestPath)) &#123;</span><br><span class="line">      <span class="comment">//  ä¸åŒ…å«token</span></span><br><span class="line">      <span class="keyword">if</span>(!headers.containsKey(<span class="string">&quot;Authorization&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">//  èº«ä»½éªŒè¯å¤±è´¥ï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        <span class="comment">//  å‚æ•°æ˜¯HttpStatusç±»å‹çš„ï¼Œæœªç™»å½•çŠ¶æ€ç ä¸º401</span></span><br><span class="line">        response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  æ ¸éªŒtokenæ˜¯å¦æœ‰æ•ˆ,ä»¥åŠç”¨æˆ·æƒé™èƒ½å¦è·å–èµ„æº</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">      <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtils.getClaimsByToken(token);</span><br><span class="line">      <span class="comment">//  è¿‡æœŸ</span></span><br><span class="line">      <span class="keyword">if</span>(claims.getExpiration().getTime() &lt; <span class="keyword">new</span> <span class="title class_">Date</span>().getTime()) &#123;</span><br><span class="line">        <span class="comment">//  tokenè¿‡æœŸï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  æ²¡æœ‰è¿‡æœŸï¼Œå¯¹æƒé™è¿›è¡ŒéªŒè¯  </span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Boolean <span class="title function_">tokenShouldCheck</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !path.equals(<span class="string">&quot;/users/login&quot;</span>) &amp;&amp; !path.equals(<span class="string">&quot;/users/register&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´æ®µä»£ç æˆ‘åªèƒ½è¯´ï¼Œå’Œä¼˜é›…æ˜¯å®Œå…¨ä¸æ²¾è¾¹ï¼Œæ„Ÿè§‰è¿‡æ»¤å™¨åªå­¦åˆ°äº†çš®æ¯›â€¦</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>å…¶ä»–åŠŸèƒ½ä»¥å‰éƒ½å†™çƒ‚äº†ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„æ„Ÿè§‰ï¼Œä¸èƒ½å¾ˆå¥½çš„å®Œæˆæƒé™è®¤è¯æ˜¯æˆ‘è®¤ä¸ºè¿™é¡¹ç›®å¼€å±€çš„è´¥ç¬”ğŸ˜¡</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é¡¹ç›® </category>
          
          <category> é…’åº—ç®¡ç†ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Feign </tag>
            
            <tag> SpringCloudGateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…’åº—ç®¡ç†ç³»ç»Ÿ-è®¾è®¡è§„åˆ’</title>
      <link href="/2023/09/02/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E8%AE%BE%E8%AE%A1%E8%A7%84%E5%88%92/"/>
      <url>/2023/09/02/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E8%AE%BE%E8%AE%A1%E8%A7%84%E5%88%92/</url>
      
        <content type="html"><![CDATA[<h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>ç»è¿‡å¯¹SpringCloudçš„åŸºç¡€çŸ¥è¯†å­¦ä¹ åï¼Œå¸Œæœ›å°†å®ƒåº”ç”¨åˆ°é…’åº—ç®¡ç†ç³»ç»Ÿè¿™ä¸ªé¡¹ç›®ä¸­å»ã€‚æˆ‘çš„è§„åˆ’å¦‚ä¸‹ï¼š</p><ul><li>åœ¨åŠŸèƒ½éœ€æ±‚å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œåˆ†æå¹¶å°†ä¸šåŠ¡æ‹†è§£æˆå¤šä¸ªæ¨¡å—å®ç°å¾®æœåŠ¡æ¶æ„</li><li>è¿›è¡Œåˆæ­¥çš„å®ä½“ç±»è®¾è®¡ï¼Œæ•°æ®åº“è®¾è®¡</li><li>ä¼˜å…ˆä½¿ç”¨å·²æŒæ¡æŠ€èƒ½å®ŒæˆåŸºç¡€åŠŸèƒ½æ¨¡å—ï¼Œå¦‚å¤„ç†ç§’æ€åº“å­˜æš‚æ—¶ä¸è€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œç›®å‰è®¡åˆ’ä½¿ç”¨synchronizedè§£å†³</li></ul><p>å½“å‰é˜»åŠ›ï¼š</p><ul><li>å‰ç«¯è®¾è®¡</li><li>ç”¨æˆ·æƒé™æ§åˆ¶ç®¡ç†è¿™å—æ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ ï¼Œåªèƒ½åŸºç¡€çš„ä½¿ç”¨JWTè¿›è¡Œtokenè§£æ</li><li>Flaskæ¡†æ¶å¹¶æ²¡æœ‰å®é™…ä¸Šæ‰‹å†™è¿‡ï¼Œä¹Ÿå¹¶æ²¡æœ‰ä½¿ç”¨Pythonè¿›è¡Œè¿‡ä¸æ•°æ®åº“äº¤äº’çš„é¡¹ç›®å¼€å‘ï¼Œæ²¡æœ‰ç¼–å†™è¿‡è„šæœ¬</li><li>æ¶ˆæ¯ä¸­é—´ä»¶æ²¡æœ‰è¿‡å¤šå®é™…ç¼–ç ç»éªŒï¼Œå°šæ— æ³•ç¡®è®¤èƒ½å¦é¡ºåˆ©æŠ•å…¥åˆ°é¡¹ç›®ä½¿ç”¨ä¸­</li></ul><p>ç†æƒ³çŠ¶æ€ï¼š</p><ul><li><input disabled="" type="checkbox"> èƒ½å¤Ÿç†Ÿç»ƒçš„ä½¿ç”¨SpringCloudå¯¹é¡¹ç›®å„ä¸ªæœåŠ¡æ¨¡å—è¿›è¡Œå¼€å‘</li><li><input disabled="" type="checkbox"> å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶æ¥å®ç°å¯¹é«˜å¹¶å‘çš„æ”¯æŒï¼Œå¼•å…¥redisç¼“å­˜æ¥æé«˜ç§’æ€æ•ˆç‡</li><li><input disabled="" type="checkbox"> è¡¥å……SpringSecurityçŸ¥è¯†ï¼Œå¯¹æƒé™è®¤è¯è¿›è¡Œå®Œå–„</li></ul><h3 id="æ¨¡å—è®¾è®¡"><a href="#æ¨¡å—è®¾è®¡" class="headerlink" title="æ¨¡å—è®¾è®¡"></a>æ¨¡å—è®¾è®¡</h3><p>ä»…é’ˆå¯¹Javaéƒ¨åˆ†çš„SpringCloudå¾®æœåŠ¡è®¾è®¡</p><ol><li>ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼šè´Ÿè´£å¤„ç†ç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•ã€åŸºæœ¬ä¿¡æ¯ç»´æŠ¤ç­‰åŠŸèƒ½ã€‚</li><li>é…’åº—ä¿¡æ¯ç®¡ç†æ¨¡å—ï¼šè´Ÿè´£å¤„ç†é…’åº—åˆ—è¡¨ã€åŸºæœ¬ä¿¡æ¯ã€ç»†èŠ‚ä¿¡æ¯çš„ç»´æŠ¤ç­‰åŠŸèƒ½ã€‚</li><li>è®¢å•ç®¡ç†æ¨¡å—ï¼šè´Ÿè´£å¤„ç†ç”¨æˆ·é¢„å®šçš„è®¢å•ï¼ŒåŒ…æ‹¬æµè§ˆè®¢å•ç­‰åŠŸèƒ½ã€‚</li><li>ç®¡ç†å‘˜å®¢æˆ·ç®¡ç†æ¨¡å—ï¼šè´Ÿè´£å¸®åŠ©å®¢æˆ·é‡ç½®å¯†ç ï¼Œç”Ÿæˆæ–°çš„éšæœºå¯†ç ï¼Œåˆ é™¤ç”¨æˆ·</li></ol><h3 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h3><p>é’ˆå¯¹é…’åº—ç®¡ç†ç³»ç»Ÿçš„ä¸šåŠ¡è¿›è¡Œæ•°æ®åº“è®¾è®¡å’Œç±»å›¾çš„è®¾è®¡</p><h4 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h4><h4 id="t-user"><a href="#t-user" class="headerlink" title="t_user"></a>t_user</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">ç”¨æˆ·id</td></tr><tr><td align="center">username</td><td align="center">varchar</td><td align="center">255</td><td align="center">ç”¨æˆ·å</td></tr><tr><td align="center">password</td><td align="center">varchar</td><td align="center">255</td><td align="center">å¯†ç </td></tr><tr><td align="center">salt</td><td align="center">varchar</td><td align="center">255</td><td align="center">ç›å€¼</td></tr><tr><td align="center">sex</td><td align="center">int</td><td align="center"></td><td align="center">æ€§åˆ«(å¥³0ï¼Œç”·1)</td></tr><tr><td align="center">type</td><td align="center">int</td><td align="center"></td><td align="center">ç±»å‹(0æœªæˆå¹´äººï¼Œ1æˆå¹´äºº)</td></tr><tr><td align="center">identity</td><td align="center">int</td><td align="center"></td><td align="center">èº«ä»½(0ä¸ºæ™®é€šç”¨æˆ·ï¼Œ1ä¸ºç”¨æˆ·ç®¡ç†å‘˜ï¼Œ2ä¸ºé…’åº—ç®¡ç†äººå‘˜ï¼Œ3ä¸ºé…’åº—ç®¡ç†å‘˜)</td></tr><tr><td align="center">idcn</td><td align="center">char</td><td align="center">18</td><td align="center">èº«ä»½è¯å·ç </td></tr><tr><td align="center">real_name</td><td align="center">varchar</td><td align="center">255</td><td align="center">çœŸå®å§“å</td></tr><tr><td align="center">phone</td><td align="center">varchar</td><td align="center">255</td><td align="center">ç”µè¯å·ç </td></tr><tr><td align="center">email</td><td align="center">varchar</td><td align="center">255</td><td align="center">é‚®ç®±</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-hotel"><a href="#t-hotel" class="headerlink" title="t_hotel"></a>t_hotel</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">ç”¨æˆ·id</td></tr><tr><td align="center">name</td><td align="center">varchar</td><td align="center">255</td><td align="center">é…’åº—åç§°</td></tr><tr><td align="center">address</td><td align="center">varchar</td><td align="center">255</td><td align="center">é…’åº—åœ°å€</td></tr><tr><td align="center">introduction</td><td align="center">varchar</td><td align="center">255</td><td align="center">é…’åº—ä»‹ç»</td></tr><tr><td align="center">phone</td><td align="center">varchar</td><td align="center"></td><td align="center">è”ç³»æ–¹å¼</td></tr><tr><td align="center">stars</td><td align="center">int</td><td align="center"></td><td align="center">æ˜Ÿçº§</td></tr><tr><td align="center">brand</td><td align="center">varchar</td><td align="center">255</td><td align="center">å“ç‰Œ</td></tr><tr><td align="center">business_district</td><td align="center">varchar</td><td align="center">255</td><td align="center">æ‰€å±å•†åœˆ</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-order"><a href="#t-order" class="headerlink" title="t_order"></a>t_order</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">è®¢å•id</td></tr><tr><td align="center">user_id</td><td align="center">int</td><td align="center">255</td><td align="center">ç”¨æˆ·id</td></tr><tr><td align="center">room_id</td><td align="center">int</td><td align="center">255</td><td align="center">æˆ¿é—´id</td></tr><tr><td align="center">check_in_date</td><td align="center">datetime</td><td align="center">255</td><td align="center">å…¥ä½æ—¥æœŸ</td></tr><tr><td align="center">check_out_date</td><td align="center">datetime</td><td align="center"></td><td align="center">é€€æˆ¿æ—¥æœŸ</td></tr><tr><td align="center">room_num</td><td align="center">int</td><td align="center"></td><td align="center">æˆ¿é—´æ•°é‡</td></tr><tr><td align="center">expected_guest_num</td><td align="center">int</td><td align="center"></td><td align="center">é¢„æœŸå…¥ä½äººæ•°</td></tr><tr><td align="center">has_children</td><td align="center">int</td><td align="center">18</td><td align="center">æ˜¯å¦æœ‰å„¿ç«¥ï¼ˆ0æ— 1æœ‰ï¼‰</td></tr><tr><td align="center">status</td><td align="center">int</td><td align="center">255</td><td align="center">è®¢å•çŠ¶æ€ï¼ˆ0æœªæ”¯ä»˜ï¼Œ1å·²æ”¯ä»˜ï¼Œ2å·²å–æ¶ˆï¼‰</td></tr><tr><td align="center">price</td><td align="center">decimal</td><td align="center">255</td><td align="center">è®¢å•ä»·æ ¼</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-room"><a href="#t-room" class="headerlink" title="t_room"></a>t_room</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">æˆ¿é—´id</td></tr><tr><td align="center">hotel_id</td><td align="center">int</td><td align="center"></td><td align="center">æ‰€å±é…’åº—id</td></tr><tr><td align="center">num</td><td align="center">int</td><td align="center"></td><td align="center">å‰©ä½™æ•°é‡</td></tr><tr><td align="center">type</td><td align="center">varchar</td><td align="center">255</td><td align="center">æˆ¿é—´ç±»å‹ï¼ˆ0å•äººé—´ï¼Œ1åŒåºŠæˆ¿ï¼Œ2å¤§åºŠæˆ¿ï¼‰</td></tr><tr><td align="center">original_price</td><td align="center">decimal</td><td align="center"></td><td align="center">åŸä»·</td></tr><tr><td align="center">price</td><td align="center">decimal</td><td align="center"></td><td align="center">å½“å‰ä»·æ ¼</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-facilities"><a href="#t-facilities" class="headerlink" title="t_facilities"></a>t_facilities</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">è®¾æ–½id</td></tr><tr><td align="center">name</td><td align="center">varchar</td><td align="center">255</td><td align="center">è®¾æ–½åç§°</td></tr><tr><td align="center">is_free</td><td align="center">int</td><td align="center"></td><td align="center">æ˜¯å¦å…è´¹(0ä»˜è´¹ï¼Œ1å…è´¹)</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-hotel-facilities"><a href="#t-hotel-facilities" class="headerlink" title="t_hotel_facilities"></a>t_hotel_facilities</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">hotel_id</td><td align="center">int</td><td align="center"></td><td align="center">é…’åº—id</td></tr><tr><td align="center">facilities_id</td><td align="center">int</td><td align="center"></td><td align="center">è®¾æ–½id</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="ç±»å›¾"><a href="#ç±»å›¾" class="headerlink" title="ç±»å›¾"></a>ç±»å›¾</h4><p>æœ‰æœºä¼šå†è¡¥å§ï¼Œå…ˆğŸ•Šäº†</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é¡¹ç›® </category>
          
          <category> é…’åº—ç®¡ç†ç³»ç»Ÿ </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UML </tag>
            
            <tag> æ•°æ®åº“è®¾è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-GateWay</title>
      <link href="/2023/09/02/SpringCloud-GateWay/"/>
      <url>/2023/09/02/SpringCloud-GateWay/</url>
      
        <content type="html"><![CDATA[<h3 id="ç½‘å…³åŠŸèƒ½"><a href="#ç½‘å…³åŠŸèƒ½" class="headerlink" title="ç½‘å…³åŠŸèƒ½"></a>ç½‘å…³åŠŸèƒ½</h3><ol><li>èº«ä»½è®¤è¯ï¼Œæƒé™è®¤è¯</li><li>æœåŠ¡è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡</li><li>è¯·æ±‚é™æµ</li></ol><h3 id="æ­å»ºç½‘å…³"><a href="#æ­å»ºç½‘å…³" class="headerlink" title="æ­å»ºç½‘å…³"></a>æ­å»ºç½‘å…³</h3><ol><li>æ·»åŠ ä¾èµ–ï¼ŒnacosæœåŠ¡å‘ç°ä»¥åŠç½‘å…³çš„ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ç½‘å…³ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–å†™è·¯ç”±é…ç½®ä»¥åŠnacosçš„åœ°å€</li></ol><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># è·¯ç”±çš„idï¼Œè‡ªå®šä¹‰ï¼Œå”¯ä¸€å³å¯</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡çš„æ„æ€ï¼Œåé¢è·Ÿç€æœåŠ¡çš„åç§°</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œè¯·æ±‚åŒ¹é…è§„åˆ™ï¼Œåªè¦ä»¥userå¼€å¤´çš„å°±åŒ¹é…</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¥ç€å‘ç½‘å…³æ‰€åœ¨ç«¯å£å‘é€è¯·æ±‚ä¿¡æ¯ï¼Œå¦‚<a href="http://localhost:10010/user/1%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0userService%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%BF%94%E5%9B%9E%E3%80%82">http://localhost:10010/user/1ï¼Œå°±å¯ä»¥å¾—åˆ°userServiceæœåŠ¡çš„è¿”å›ã€‚</a></p><p>æœåŠ¡æµç¨‹ï¼š</p><p><img src="https://s2.loli.net/2023/09/02/oTYa7EjHKGSqIVC.png" alt="image-20230902161302541"></p><h3 id="è·¯ç”±æ–­è¨€å·¥å‚"><a href="#è·¯ç”±æ–­è¨€å·¥å‚" class="headerlink" title="è·¯ç”±æ–­è¨€å·¥å‚"></a>è·¯ç”±æ–­è¨€å·¥å‚</h3><p>Springæä¾›äº†å¤šç§æ–­è¨€å·¥å‚ï¼Œé™¤äº†Pathç”¨æ¥é™åˆ¶è·¯å¾„ä»¥å¤–ï¼Œè¿˜å¯ä»¥é™åˆ¶ipï¼Œé™åˆ¶æ—¶é—´ç­‰</p><p><img src="https://s2.loli.net/2023/09/02/z782hbNTxtBpIZS.png" alt="image-20230902162312852"></p><p>è¯¦æƒ…å®ä¾‹è§SpringCloudGatewayæ–‡æ¡£<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">è·¯ç”±æ–­è¨€å·¥å‚</a></p><h3 id="è·¯ç”±è¿‡æ»¤å™¨"><a href="#è·¯ç”±è¿‡æ»¤å™¨" class="headerlink" title="è·¯ç”±è¿‡æ»¤å™¨"></a>è·¯ç”±è¿‡æ»¤å™¨</h3><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>å¯¹è¯·æ±‚æˆ–è€…å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</p><h4 id="è¯·æ±‚æµç¨‹"><a href="#è¯·æ±‚æµç¨‹" class="headerlink" title="è¯·æ±‚æµç¨‹"></a>è¯·æ±‚æµç¨‹</h4><p>å®¢æˆ·ç«¯å‘ç½‘å…³å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚ç»è¿‡å¤šå±‚è¿‡æ»¤å™¨åˆ°è¾¾æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯çš„å“åº”ä¹Ÿä¼šç»è¿‡è¿‡æ»¤å™¨å†è¿”å›ç»™å®¢æˆ·ç«¯</p><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>åŠ å…¥æƒ³è¦ç»™è¯·æ±‚å¤´æ·»åŠ ä¸€ä¸ªtoken</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># è·¯ç”±çš„idï¼Œè‡ªå®šä¹‰ï¼Œå”¯ä¸€å³å¯</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userService</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡çš„æ„æ€ï¼Œåé¢è·Ÿç€æœåŠ¡çš„åç§°</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œè¯·æ±‚åŒ¹é…è§„åˆ™ï¼Œåªè¦ä»¥userå¼€å¤´çš„å°±åŒ¹é…</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddRequestHeader=token,</span> <span class="string">xxx</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=token,</span> <span class="string">xxx</span> <span class="comment"># é»˜è®¤è¿‡æ»¤å™¨ï¼Œä¼šå¯¹æ‰€æœ‰è¯·æ±‚éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</span></span><br></pre></td></tr></table></figure><p>SpringCloudå®˜ç½‘æä¾›äº†31ç§è¿‡æ»¤å™¨ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒ<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories">è¿‡æ»¤å™¨å·¥å‚</a></p><h4 id="å…¨å±€è¿‡æ»¤å™¨"><a href="#å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="å…¨å±€è¿‡æ»¤å™¨"></a>å…¨å±€è¿‡æ»¤å™¨</h4><p>å®šä¹‰ä¸€ä¸ªç±»å¹¶ä¸”å®ç°GlobalFilteræ¥å£ï¼Œå¹¶ä¸”é‡å†™å‡½æ•°filter</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exchange åŒ…å«è¯·æ±‚å¤´ï¼Œè¯·æ±‚ä½“çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> chain è¿‡æ»¤å™¨é“¾ï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨å°†å…¶æ”¾è¡Œè‡³ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> Monoç±»å‹çš„ç»“æœï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨åªéœ€è¦è¿”å›chain.filter(exchange)å³å¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">    <span class="comment">//  è·å–è¯·æ±‚</span></span><br><span class="line">    <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">    <span class="comment">//  ä»è¯·æ±‚ä¸­è·å–å‚æ•°</span></span><br><span class="line">    MultiValueMap&lt;String, String&gt; params = request.getQueryParams();</span><br><span class="line">    <span class="comment">//  è·å–å…·ä½“å‚æ•°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> params.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">    <span class="comment">//  åˆ¤æ–­èº«ä»½ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>.equals(authorization)) &#123;</span><br><span class="line">      <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//  èº«ä»½éªŒè¯å¤±è´¥ï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">    <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">    <span class="comment">//  å‚æ•°æ˜¯HttpStatusç±»å‹çš„ï¼Œæœªç™»å½•çŠ¶æ€ç ä¸º401</span></span><br><span class="line">    response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response.setComplete();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Order(-1)æ³¨è§£æ˜¯è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼ˆæˆ–è€…è¯´ä¼˜å…ˆçº§ï¼‰ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</p><p>@Componentæ³¨è§£å°†è¿‡æ»¤å™¨æ³¨å†Œä¸ºä¸€ä¸ªBean</p><p><strong>æ€»ç»“æ­¥éª¤ï¼š</strong></p><ol><li>å®ç°GlobalFilteræ¥å£</li><li>æ·»åŠ @Orderå’Œ@Componentæ³¨è§£è‡³ç±»</li><li>ç¼–å†™è¿‡æ»¤å¤„ç†é€»è¾‘</li></ol><h4 id="è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº"><a href="#è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº" class="headerlink" title="è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº"></a>è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº</h4><p>æ¯ä¸ªè¿‡æ»¤å™¨éƒ½æœ‰ä¸€ä¸ªorderå€¼ï¼Œæ ¹æ®orderå€¼è¿›è¡Œæ’åº</p><p>GlobalFilteræ˜¯ç”±æˆ‘ä»¬è‡ªå®šä¹‰orderçš„å€¼çš„</p><p>è·¯ç”±è¿‡æ»¤å™¨ä¸é»˜è®¤è¿‡æ»¤å™¨çš„orderå€¼ç”±springå†³å®šï¼Œspringé»˜è®¤æŒ‰ç…§å£°æ˜é¡ºåºä»1å¼€å§‹é€’å¢</p><p>å½“orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§é»˜è®¤è¿‡æ»¤å™¨&gt;è·¯ç”±è¿‡æ»¤å™¨&gt;å…¨å±€è¿‡æ»¤å™¨çš„é¡ºåºæ‰§è¡Œ</p><h3 id="è·¨åŸŸå¤„ç†"><a href="#è·¨åŸŸå¤„ç†" class="headerlink" title="è·¨åŸŸå¤„ç†"></a>è·¨åŸŸå¤„ç†</h3><p>åªéœ€è¦é€šè¿‡springçš„é…ç½®å°±å¯ä»¥å¯¹ç½‘å…³çš„è·¨åŸŸè¿›è¡Œå¤„ç†</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line">  <span class="attr">globalcors:</span></span><br><span class="line">    <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span></span><br><span class="line"><span class="attr">corsConfigurations:</span></span><br><span class="line">  <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line"><span class="attr">allowedOrigins:</span> <span class="comment"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ï¼Œspring boot2.4ä»¥å‰çš„é…ç½®</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;http://localhost&quot;</span></span><br><span class="line"><span class="comment"># allowedOriginPatterns: &quot;*&quot; # spring boot2.4ä»¥åçš„é…ç½®  </span></span><br><span class="line"><span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment">#  æ˜¯å¦å…è®¸å¸¦cookie</span></span><br><span class="line"><span class="attr">allowedMethods:</span> <span class="comment"># è·¨åŸŸæ–¹æ³•è®¾ç½®</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GET</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">OPTIONS</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">PUT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DELETE</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">POST</span></span><br><span class="line"><span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># å…è®¸æºå¸¦çš„è¯·æ±‚å¤´ä¿¡æ¯</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">36000</span> <span class="comment"># è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ,å•ä½s</span></span><br></pre></td></tr></table></figure><h3 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h3><p>æ¥SpringCloud-Feignçš„é¢˜å¤–è¯ï¼Œæœç„¶æœ‰æ—¶å€™æ— æ³•ç†è§£æŸä¸ªçŸ¥è¯†çš„æ—¶å€™ï¼Œä¸å¦¨ç»§ç»­å­¦ä¸‹å»çœ‹çœ‹ï¼Œåç»§æ‹‰åŠ¨å‰é©±äº†å±äºæ˜¯</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> GateWay </tag>
            
            <tag> æƒé™è®¤è¯ </tag>
            
            <tag> æœåŠ¡è·¯ç”± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Feign</title>
      <link href="/2023/09/02/SpringCloud-Feign/"/>
      <url>/2023/09/02/SpringCloud-Feign/</url>
      
        <content type="html"><![CDATA[<h3 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h3><p>ç”±äºå¾®æœåŠ¡æ¶æ„ï¼Œæ— æ³•ç›´æ¥è¯·æ±‚å…¶ä»–æœåŠ¡çš„serviceï¼Œéœ€è¦è¿œç¨‹è°ƒç”¨ï¼Œå› æ­¤ä¼šç”¨åˆ°RestTemplateæ¥åšè¿œç¨‹è°ƒç”¨ã€‚åŒæ—¶æˆ‘ä»¬ä½¿ç”¨Ribbonç»“åˆRestTemplateæ¥å®ç°ä½¿ç”¨æœåŠ¡åç§°ä»£æ›¿ipå’Œç«¯å£ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚Feignåˆ™æ˜¯ä¸€ç§æ›´åŠ ä¼˜é›…çš„æ–¹å¼ï¼Œä¸ä¼šéœ€è¦åƒRestTemplateä¸€æ ·å‡ºç°url</p><h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>é¦–å…ˆæ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åä¸»å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š@EnableFeignClientsæ³¨è§£ï¼Œå°±åƒ@EnableEurekaServeræ³¨è§£ä¸€æ ·</p><p>åœ¨Serviceæ¥å£ä¸Šæ·»åŠ @FeignClientæ³¨è§£ï¼Œå¹¶ä¸”æŒ‡å®šæœåŠ¡çš„åç§°ï¼ˆæ³¨å†Œåˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„åç§°ï¼‰ï¼Œå› æ­¤è¿™é‡Œå°±å¯ä»¥å®ç°è·¨æœåŠ¡è°ƒç”¨ï¼Œåªéœ€è¦å®ç°æ³¨å†Œå…¶ä»–æœåŠ¡çš„åç§°çš„æ¥å£ã€‚ä½¿ç”¨èµ·æ¥çš„æ•´ä½“æ„Ÿè§‰åƒcontroller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Feigné…ç½®"><a href="#Feigné…ç½®" class="headerlink" title="Feigné…ç½®"></a>Feigné…ç½®</h3><p><strong>æ–¹å¼ä¸€ï¼š</strong>é€šè¿‡ä¿®æ”¹ymlæ–‡ä»¶å¯¹feignè¿›è¡Œé…ç½®</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  OrderService</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼äºŒï¼š</strong>é€šè¿‡é…ç½®ç±»å’Œæ³¨è§£</p><p>åˆ›å»ºä¸€ä¸ªconfigurationç±»ï¼Œé…ç½®Logger.Levelè¿™ä¸ªBeanï¼ŒåŠ åœ¨æŒ‡å®šæœåŠ¡çš„@FeignClient(value &#x3D; â€œuserserviceâ€)æ³¨è§£ä¸­ï¼Œæˆ–è€…åŠ åœ¨å¯åŠ¨ç±»çš„@EnableFeignClients( defaultConfiguration &#x3D; xxxconfiguration.class )æ³¨è§£ä¸­ã€‚</p><h3 id="Feignæ€§èƒ½ä¼˜åŒ–"><a href="#Feignæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="Feignæ€§èƒ½ä¼˜åŒ–"></a>Feignæ€§èƒ½ä¼˜åŒ–</h3><p>Feignåº•å±‚é»˜è®¤ä½¿ç”¨çš„URLConnectionï¼Œä¸æ”¯æŒè¿æ¥æ± ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨Apache HttpClientæ¥æ”¯æŒè¿æ¥æ± ï¼ˆå‡å°‘è¿æ¥çš„åˆ›å»ºä¸é‡Šæ”¾ï¼‰</p><h4 id="ä½¿ç”¨æ–¹æ³•-1"><a href="#ä½¿ç”¨æ–¹æ³•-1" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><p>æ·»åŠ HttpClientä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®è¿æ¥æ± </p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ”¯æŒHttpClientçš„å¼€å…³</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment"># æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment"># å•ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span></span><br></pre></td></tr></table></figure><h3 id="Feign-Api"><a href="#Feign-Api" class="headerlink" title="Feign-Api"></a>Feign-Api</h3><p>controllerå’ŒFeignClientçš„é‡åˆåº¦è¾ƒé«˜ï¼Œå¯ä»¥é€šè¿‡é‡‡ç”¨å®šä¹‰æ¥å£ï¼Œè®©äºŒè€…éƒ½å»ç»§æ‰¿è¿™ä¸ªæ¥å£ï¼Œåˆ©ç”¨è¿™ç§æ–¹å¼æä¾›ä¾¿æ·ã€‚</p><p>å­˜åœ¨çš„é—®é¢˜ï¼šç´§è€¦åˆ</p><p>æˆ‘æ›´åå‘çš„æ–¹æ³•æ˜¯å°†FeignClientã€POJOã€Feignçš„é»˜è®¤é…ç½®å°è£…åˆ°ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œé€šè¿‡å¼•å…¥æ¨¡å—æ¥ä¾›å…¶ä»–æ¶ˆè´¹è€…ä½¿ç”¨ã€‚è¿™æ ·åšä¹Ÿå¯ä»¥é¿å…æ¯ä¸ªæœåŠ¡éƒ½è¦å»å®ç°ä¸€æ ·çš„FeignClientï¼Œåˆ›å»ºå®ä½“ç±»ç­‰ã€‚</p><p>å­˜åœ¨çš„é—®é¢˜ï¼šæœ‰çš„æœåŠ¡å¯èƒ½ä»…ä»…éœ€è¦éƒ¨åˆ†å®ä½“ç±»å’ŒåŠŸèƒ½ï¼Œæœ‰æ‰€å†—ä½™</p><h4 id="ä½¿ç”¨æ–¹æ³•-2"><a href="#ä½¿ç”¨æ–¹æ³•-2" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><p>åœ¨å…¶ä»–æœåŠ¡çš„pomæ–‡ä»¶ä¸­å¼•å…¥è¯¥feign-apiçš„ä¾èµ–ï¼Œè¿™æ ·å°±å¯ä»¥å¼•å…¥æœ¬æ¨¡å—ä¸­æœªåˆ›å»ºçš„å®ä½“ç±»ï¼Œå®ç°å¤ç”¨</p><p>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šå¯¹FeignClientçš„è‡ªåŠ¨è£…é…ï¼Œ@Autowiredåªèƒ½è£…é…é¡¹ç›®æ‰€åœ¨åŒ…ç›®å½•ä¸‹çš„Beanï¼Œå› æ­¤éœ€è¦åœ¨@EnableFeignClientsæ³¨è§£ä¸Šæ·»åŠ clientså‚æ•°ã€‚</p><p>@EnableFeignClients( clients &#x3D; {UserClient.class, OrderClent.class}, defaultConfiguration &#x3D; xxxconfiguration.class ) clientså‚æ•°å¯ä»¥æ˜¯æ•°ç»„</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æµç¨‹æ¢³ç†ï¼š</p><ol><li>æœåŠ¡æ¨¡å—ä¸éœ€è¦å®ç°FeignClientæ¥å®ç°è·¨æœåŠ¡ï¼Œä¸éœ€è¦åˆ›å»ºå…¶ä»–çš„å®ä½“</li><li>é€šè¿‡åˆ›å»ºfeign-apiæ¥å¯¹æœåŠ¡è¿›è¡Œå°è£…ï¼Œä¸ºå…¶ä»–æœåŠ¡çš„è·¨æœåŠ¡è°ƒç”¨æä¾›æ¥å£ï¼ŒåŒæ—¶å‡å°‘äº†å®ä½“ç±»é‡å¤å†™çš„æƒ…å†µ</li></ol><p>å¼€å‘æµç¨‹ï¼š</p><p>providerçš„æœåŠ¡ç›¸å…³å†…å®¹æŒ‰ç…§springbootä¸€æ ·ç…§å¸¸å†™ï¼Œç„¶ååœ¨provider-apiä¸­æä¾›å¯¹æœåŠ¡controllerçš„è®¿é—®ï¼Œå…¶ä»–æœåŠ¡éœ€è¦è·¨æœåŠ¡è°ƒç”¨æ—¶é€šè¿‡provider-apiæ¥ä»å…¶å®ƒæœåŠ¡çš„controllerä¸­è·å–</p><h3 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h3><p>æ˜¨æ™šä¸€ç›´åœ¨æ€è€ƒå‰ç«¯åˆ°åº•æ˜¯å¦‚ä½•è°ƒç”¨æœ‰å¤šä¸ªå®ä¾‹çš„åç«¯æœåŠ¡ï¼Œä¸ºæ­¤å»äº†è§£äº†ä¸€ä¸‹nginxçš„è´Ÿè½½å‡è¡¡å’Œåå‘ä»£ç†ã€‚</p><p>æˆ‘çš„çº ç»“ç‚¹åœ¨äºï¼Œæˆ‘ç›®å‰å­¦åˆ°çš„springcloudå†…éƒ¨çš„è´Ÿè½½å‡è¡¡éƒ½æ˜¯æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡å…¶ä»–æœåŠ¡çš„åç§°å‘æ³¨å†Œä¸­å¿ƒè¿›è¡Œè¯·æ±‚ï¼Œç„¶åå†æ ¹æ®è¿”å›çš„æœåŠ¡å®ä¾‹åˆ—è¡¨è´Ÿè½½å‡è¡¡ã€‚é‚£å¦‚æœè¿™ä¸ªæœåŠ¡æœ¬èº«æˆ‘ä»å‰ç«¯å‘ä»–å‘èµ·è¯·æ±‚ï¼Œåˆåº”è¯¥æ€ä¹ˆåšæ‰èƒ½ä¸è®¿é—®å›ºå®šçš„ç«¯å£å·å‘¢ï¼Ÿ</p><p>æœ€åˆæƒ³åˆ°çš„æ–¹æ³•æ˜¯å°†å¯¹è¿™å°ä¸»æœºçš„httpè¯·æ±‚ï¼Œå…¨éƒ¨å‘nacoså¯»æ‰¾æœåŠ¡åç§°çš„è¿™ç§æ–¹å¼ï¼Œå½“ç„¶åªæ˜¯æˆ‘çš„çŒœæƒ³ã€‚ä»Šå¤©æŸ¥èµ„æ–™ï¼Œè²Œä¼¼æ˜¯é€šè¿‡å‘ç½‘å…³å‘å‡ºè¯·æ±‚ï¼Œå†ç”±ç½‘å…³è¿›è¡Œè·¯ç”±åˆ°å…·ä½“æœåŠ¡ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œä»è®¾è®¡çš„è§’åº¦æ„Ÿè§‰éå¸¸åˆç†ï¼Œå‰ç«¯çš„è¯·æ±‚å¯ä»¥é€šè¿‡nginxçš„è´Ÿè½½å‡è¡¡å‘ä¸åŒç½‘å…³å®ä¾‹å‘é€ï¼Œç½‘å…³åˆå¯ä»¥æ ¹æ®urlçš„è·¯å¾„å‘å…·ä½“çš„æœåŠ¡è¯·æ±‚ï¼ŒæœåŠ¡åˆ™åˆè¢«æ³¨å†Œåˆ°äº†nacosï¼Œè‹¥å­˜åœ¨å¤šä¸ªå®ä¾‹ä¹Ÿä¼šåœ¨openfeignä¸­å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>è«åå…¶å¦™å°±ä¸²è”èµ·æ¥äº†ï¼Œå­¦å®Œç½‘å…³å†çœ‹çœ‹</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Feign </tag>
            
            <tag> RestTemplate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Nacos</title>
      <link href="/2023/09/01/SpringCloud-Nacos/"/>
      <url>/2023/09/01/SpringCloud-Nacos/</url>
      
        <content type="html"><![CDATA[<h3 id="NacosæœåŠ¡æ³¨å†Œ"><a href="#NacosæœåŠ¡æ³¨å†Œ" class="headerlink" title="NacosæœåŠ¡æ³¨å†Œ"></a>NacosæœåŠ¡æ³¨å†Œ</h3><p>é¦–å…ˆçˆ¶æ¨¡å—çš„ä¾èµ–æ§åˆ¶å¤„éœ€è¦æ·»åŠ spring cloud alibaba</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringCloudAlibabaæœ‰å…³ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€åœ¨æœåŠ¡æ¨¡å—çš„pomä¸­æ·»åŠ spring-cloud-starter-alibaba-nacos-discoveryä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ›´æ”¹é…ç½®ï¼Œnacosæ˜¯åœ¨springcloudé…ç½®ä¸­çš„</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼šEnableDiscoveryClientæ³¨è§£ç°åœ¨æ˜¯å¯é€‰é¡¹äº†ï¼Œåªè¦ä¾èµ–äº†ä»¥spring-cloud-starter-netflixä¸ºå‰ç¼€çš„åº“(ä¾‹å¦‚spring-cloud-starter-netflix-eureka-client)ï¼Œå°±å¯ç”¨äº†<strong>æœåŠ¡æ³¨å†Œå‘ç°</strong>åŠŸèƒ½ï¼›</p><h3 id="æœåŠ¡åˆ†å±‚æ¶æ„"><a href="#æœåŠ¡åˆ†å±‚æ¶æ„" class="headerlink" title="æœåŠ¡åˆ†å±‚æ¶æ„"></a>æœåŠ¡åˆ†å±‚æ¶æ„</h3><p>Nacosçš„æœåŠ¡æŒ‰ç…§æœåŠ¡-&gt;é›†ç¾¤-&gt;å®ä¾‹æ¥åˆ†å±‚ï¼Œä¼˜å…ˆè°ƒç”¨æœ¬åœ°é›†ç¾¤å†…çš„å®ä¾‹ï¼Œæœ¬åœ°é›†ç¾¤ä¸­å®ä¾‹ä¸å¯ç”¨å†è°ƒç”¨å…¶ä»–é›†ç¾¤çš„å®ä¾‹</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span> </span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HangZhou</span> <span class="comment"># é›†ç¾¤åç§°</span></span><br></pre></td></tr></table></figure><h3 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p>å¦‚æœæƒ³è¦é…ç½®ä¼˜å…ˆè°ƒç”¨æœ¬åœ°é›†ç¾¤å†…çš„å®ä¾‹ï¼Œéœ€è¦ä¿®æ”¹nacosçš„é…ç½®ï¼Œä¾‹å¦‚è®¢å•æœåŠ¡æƒ³è¦ä¼˜å…ˆè°ƒç”¨æœ¬åœ°ç”¨æˆ·æœåŠ¡çš„å®ä¾‹ï¼Œéœ€è¦ä½¿ç”¨nacosçš„è´Ÿè½½å‡è¡¡ç­–ç•¥</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="comment"># è§„åˆ™ç±»çš„åç§°</span></span><br></pre></td></tr></table></figure><p>NacosRuleä¼˜å…ˆé€‰æ‹©æœ¬åœ°é›†ç¾¤ï¼Œé›†ç¾¤å†…éƒ¨éšæœºé€‰æ‹©ï¼›å½“æœ¬åœ°é›†ç¾¤å¥åº·æœåŠ¡æ•°ä¸º0æ—¶ï¼Œé€‰æ‹©è·¨é›†ç¾¤è®¿é—®å¹¶è­¦å‘Š</p><h4 id="æƒé‡é…ç½®"><a href="#æƒé‡é…ç½®" class="headerlink" title="æƒé‡é…ç½®"></a>æƒé‡é…ç½®</h4><p>æ§åˆ¶å°å¯ä»¥ä¿®æ”¹å®ä¾‹çš„æƒé‡ï¼Œæƒé‡è¶Šé«˜ï¼Œç”¨æˆ·è¯·æ±‚æ›´å¤šçš„å‘è¯¥å®ä¾‹è¿ç§»ã€‚åœ¨æœåŠ¡å‡çº§ä¸­ï¼Œå¯ä»¥é€šè¿‡å°†æƒé‡æ¯”ä¾‹è°ƒä¸º0ç„¶åè¿›è¡Œå‡çº§ï¼Œä¹‹åå†è°ƒæˆå°æƒé‡è¿›è¡Œä¸€æ®µæ—¶é—´æµ‹è¯•ï¼Œç¨³å®šåæ¢å¤æƒé‡</p><h3 id="NameSpace"><a href="#NameSpace" class="headerlink" title="NameSpace"></a>NameSpace</h3><p>ç¯å¢ƒéš”ç¦»ï¼Œå¯¹ç›¸ä¼¼çš„æœåŠ¡å¯ä»¥è¿›è¡Œåˆ†ç»„ï¼Œå¦‚æœä¸åŒç»„çš„æœåŠ¡ä¹Ÿæ— æ³•ç›¸äº’è®¿é—®ã€‚æ¯ä¸ªnamespaceæœ‰å”¯ä¸€çš„idï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹å®ƒçš„å€¼æ¥è®¾ç½®ç¯å¢ƒ</p><h3 id="Nacoså’ŒEurekaçš„åŒºåˆ«"><a href="#Nacoså’ŒEurekaçš„åŒºåˆ«" class="headerlink" title="Nacoså’ŒEurekaçš„åŒºåˆ«"></a>Nacoså’ŒEurekaçš„åŒºåˆ«</h3><h4 id="å¥åº·ç›‘æµ‹"><a href="#å¥åº·ç›‘æµ‹" class="headerlink" title="å¥åº·ç›‘æµ‹"></a>å¥åº·ç›‘æµ‹</h4><p>å¯¹äºæœåŠ¡æä¾›è€…çš„å¥åº·çŠ¶æ€ç›‘æµ‹ï¼Œnacoså°†æœåŠ¡å®ä¾‹åˆ†ä¸ºä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹</p><p>ä¸´æ—¶å®ä¾‹ï¼š</p><p>å’ŒEurekaä¸€æ ·ï¼Œä½¿ç”¨å¿ƒè·³æ£€æµ‹ï¼Œå¦‚æœä¸åœ¨æœåŠ¡å°±ä¼šä¸»åŠ¨å‰”é™¤ï¼ˆé»˜è®¤æƒ…å†µä¸‹å¦‚æœä¸é…ç½®ï¼Œå®ä¾‹éƒ½æ˜¯ä¸´æ—¶çš„ï¼‰</p><p>éä¸´æ—¶å®ä¾‹ï¼š</p><p>éä¸´æ—¶å®ä¾‹åˆ™ä¼šç”±nacosä¸»åŠ¨å‘èµ·è¯¢é—®æœåŠ¡å®ä¾‹çš„å¥åº·çŠ¶æ€ï¼Œå¹¶ä¸”ä¸ä¼šå°†ä¸å¥åº·çš„æœåŠ¡å®ä¾‹æ¸…æ¥šï¼Œä¼šç­‰å¾…æ¢å¤</p><p>åˆ›å»ºéä¸´æ—¶å®ä¾‹åªéœ€è¦ä¿®æ”¹discoveryçš„å€¼</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span> </span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HangZhou</span> <span class="comment"># é›†ç¾¤åç§°</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span> <span class="comment"># æ˜¯å¦ä¸ºä¸´æ—¶å®ä¾‹</span></span><br></pre></td></tr></table></figure><h4 id="æœåŠ¡åˆ—è¡¨"><a href="#æœåŠ¡åˆ—è¡¨" class="headerlink" title="æœåŠ¡åˆ—è¡¨"></a>æœåŠ¡åˆ—è¡¨</h4><p>Eurekaå’ŒNacoséƒ½ä¼šå®šæ—¶æ‹‰å–æœåŠ¡åˆ—è¡¨åŠ åˆ°ç¼“å­˜ä¸­ï¼Œæé«˜æ•ˆç‡ã€‚ä½†æ˜¯Nacosè¿˜é‡‡å–äº†æ¶ˆæ¯æ¨é€çš„å½¢å¼ï¼Œå½“æœåŠ¡å‘ç”Ÿå˜æ›´ï¼Œä¼šä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™æ¶ˆè´¹è€…</p><h3 id="é…ç½®ç®¡ç†"><a href="#é…ç½®ç®¡ç†" class="headerlink" title="é…ç½®ç®¡ç†"></a>é…ç½®ç®¡ç†</h3><h4 id="é…ç½®è®¾ç½®"><a href="#é…ç½®è®¾ç½®" class="headerlink" title="é…ç½®è®¾ç½®"></a>é…ç½®è®¾ç½®</h4><p>å‘½åè§„åˆ™æ˜¯ æœåŠ¡å-è¿è¡Œç¯å¢ƒ.yamlå¦‚userservice-dev.yaml</p><p>é…ç½®å†…å®¹åªè®¾ç½®æœ‰çƒ­æ›´æ–°éœ€æ±‚çš„é…ç½®é¡¹ï¼Œä¾‹å¦‚æ—¥æœŸæ ¼å¼ç­‰ï¼›åƒæ•°æ®åº“åœ°å€è¿™ç§å¯ä»¥ä¸æ”¾ä¸Šå»</p><h4 id="é…ç½®æ‹‰å–"><a href="#é…ç½®æ‹‰å–" class="headerlink" title="é…ç½®æ‹‰å–"></a>é…ç½®æ‹‰å–</h4><p>é…ç½®è¯»å–æ­¥éª¤ï¼š</p><p><img src="https://s2.loli.net/2023/09/01/iCF7szOZ6HVGjlS.png" alt="image-20230901202139446.png"></p><p>bootstap.ymlé…ç½®çš„ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œå¯ä»¥è¯»å–åˆ°nacosçš„åœ°å€ï¼Œå†è¯»å–nacosçš„é…ç½®æ–‡ä»¶ï¼Œæœ€åè¯»å–application.ymlçš„é…ç½®æ–‡ä»¶</p><p>é¦–å…ˆåœ¨<strong>å¾®æœåŠ¡</strong>å¼•å…¥nacos-configä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos configä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€åˆ›å»ºbootstrap.ymlæ–‡ä»¶ï¼Œå¼•å¯¼é…ç½®æ–‡ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºapplication.yml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-service</span> <span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># å¼€å‘ç¯å¢ƒ</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacosåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># æ–‡ä»¶åç¼€å</span></span><br></pre></td></tr></table></figure><p>ä¸‰è€…ç»“åˆå‘ç°å°±æ˜¯åœ¨æ§åˆ¶å°åˆ›å»ºçš„é…ç½®idå³userservice-dev.yaml</p><p>åŒæ—¶ï¼Œä¹‹å‰çš„application.ymlä¸­çš„é‡å¤é…ç½®å¯ä»¥åˆ é™¤äº†ï¼Œå¦‚æœåŠ¡åç§°å’Œnacosåœ°å€</p><p>æ³¨ï¼šnacosé…ç½®ç®¡ç†æ˜¯æŒ‰æœåŠ¡åˆ†çš„ï¼Œå› æ­¤å†™åœ¨<strong>å¾®æœåŠ¡</strong>æ¨¡å—ä¸­</p><h4 id="é…ç½®çƒ­æ›´æ–°"><a href="#é…ç½®çƒ­æ›´æ–°" class="headerlink" title="é…ç½®çƒ­æ›´æ–°"></a>é…ç½®çƒ­æ›´æ–°</h4><p>å‰ç½®çŸ¥è¯†ï¼š</p><p>ä½¿ç”¨@Value(â€œ${pattern.dateformat}â€)æ³¨è§£å¯ä»¥è·å–é…ç½®é¡¹ï¼ˆæ”¹æˆNacosValueï¼‰</p><p>@ConfigurationProperties(prefix &#x3D; â€œxxxâ€) çº¦å®šå¤§äºé…ç½®ï¼Œåªè¦prefixå‰ç¼€xxxä¸å˜é‡åè¿›è¡Œæ‹¼æ¥ä¸é…ç½®ä¸€è‡´ï¼Œå°±å¯ä»¥æ³¨å…¥</p><p>æ–¹æ³•ä¸€ï¼šåœ¨Valueæ³¨è§£æ‰€åœ¨ç±»ä¸ŠåŠ ä¸€ä¸ªæ³¨è§£@RefreshScopeï¼Œå¯ä»¥å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯æœåŠ¡</p><p>æ–¹æ³•äºŒï¼šä½¿ç”¨@ConfigurationProperties(prefix &#x3D; â€œxxxâ€)æ³¨è§£</p><h3 id="å°æ’æ›²"><a href="#å°æ’æ›²" class="headerlink" title="å°æ’æ›²"></a>å°æ’æ›²</h3><p>æµªè´¹äº†è¿‘ä¸€ä¸ªå°æ—¶æ—¶é—´åœ¨å¤„ç†ä¾èµ–å’Œé…ç½®çš„é—®é¢˜ä¸Šã€‚è¿™é‡Œå±äºæ˜¯å¯¹dependencymanagementä¸ç†Ÿæ‚‰äº†ã€‚</p><p>ä½¿ç”¨dependencyManagementå¯ä»¥ç»Ÿä¸€ç®¡ç†é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œç¡®ä¿åº”ç”¨çš„å„ä¸ªé¡¹ç›®çš„ä¾èµ–å’Œç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ç”¨æ¯ä¸ªæ¨¡å—é¡¹ç›®éƒ½å¼„ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œä¸åˆ©äºç®¡ç†ï¼Œå½“éœ€è¦å˜æ›´ç‰ˆæœ¬å·çš„æ—¶å€™åªéœ€è¦åœ¨çˆ¶ç±»å®¹å™¨é‡Œæ›´æ–°ï¼Œä¸éœ€è¦ä»»ä½•ä¸€ä¸ªå­é¡¹ç›®çš„ä¿®æ”¹ï¼›å¦‚æœæŸä¸ªå­é¡¹ç›®éœ€è¦å¦å¤–ä¸€ä¸ªç‰¹æ®Šçš„ç‰ˆæœ¬å·æ—¶ï¼Œåªéœ€è¦åœ¨è‡ªå·±çš„æ¨¡å—dependenciesä¸­å£°æ˜ä¸€ä¸ªç‰ˆæœ¬å·å³å¯ã€‚å­ç±»å°±ä¼šä½¿ç”¨å­ç±»å£°æ˜çš„ç‰ˆæœ¬å·ï¼Œä¸ç»§æ‰¿äºçˆ¶ç±»ç‰ˆæœ¬å·ã€‚</p><p>è¯¯è§£ï¼šä»¥ä¸ºåœ¨çˆ¶æ¨¡å—ä¸­å®šä¹‰dependencyManagementä¹‹åï¼Œå­æ¨¡å—å°±å¯ä»¥ç»§æ‰¿ä¸‹æ¥ï¼Œä½†æ˜¯åœ¨mavenä¸­å‘ç°å­æ¨¡å—ä¸­å¹¶æ²¡æœ‰ç»§æ‰¿ä¸‹æ¥ä¾èµ–ã€‚å®é™…ä¸Šæ˜¯å­æ¨¡å—ä¸­ä¾ç„¶éœ€è¦æ·»åŠ ç›¸å…³ä¾èµ–ä½†æ˜¯ä¸ç”¨åŠ ç‰ˆæœ¬å·ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šæƒ³è¦å®ç°æˆ‘çš„éœ€æ±‚åªéœ€è¦å°†çˆ¶æ¨¡å—çš„ä¾èµ–æ ‡ç­¾dependencyManagementåˆ é™¤ï¼Œä»…ä½¿ç”¨dependencieså³å¯</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!--nacos --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--mybatis --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--mysql --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--webèµ·æ­¥ä¾èµ–--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Nacos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Ribbon</title>
      <link href="/2023/08/30/SpringCloud-Ribbon/"/>
      <url>/2023/08/30/SpringCloud-Ribbon/</url>
      
        <content type="html"><![CDATA[<h3 id="Ribbonè´Ÿè½½å‡è¡¡æµç¨‹"><a href="#Ribbonè´Ÿè½½å‡è¡¡æµç¨‹" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡æµç¨‹"></a>Ribbonè´Ÿè½½å‡è¡¡æµç¨‹</h3><p>åƒè¿™æ ·çš„urlï¼š<a href="http://userservice/user/1">http://userservice/user/1</a> æ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡httpè®¿é—®çš„ï¼Œå› ä¸ºå®é™…ä¸Šä¸å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªç½‘ç«™ï¼Œå› æ­¤Ribbonèµ·åˆ°ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå¤„ç†çš„ä½œç”¨</p><ol><li><p>æ”¶åˆ°è¯·æ±‚åï¼Œå‘Eurekaæ‹‰å–æœåŠ¡</p></li><li><p>è¿”å›æœåŠ¡åˆ—è¡¨ï¼Œè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œè½®è¯¢è·å–å…·ä½“æœåŠ¡ç«¯å£</p></li></ol><p>å…·ä½“æ“ä½œéœ€è¦åœ¨xxx-serviceæ¨¡å—ä¸­çš„xxxServiceApplicationä¸­å°†RestTemplateæ³¨å…¥springå®¹å™¨</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Ribbonåº•å±‚"><a href="#Ribbonåº•å±‚" class="headerlink" title="Ribbonåº•å±‚"></a>Ribbonåº•å±‚</h3><ol><li>LoadBalancerInterceptoræ‹¦æˆªhttpè¯·æ±‚ï¼Œå°†è¯·æ±‚è§£æå¾—åˆ°æœåŠ¡åç§°</li><li>å°†æœåŠ¡åç§°äº¤ç»™RibbonLoadBalancerClient</li><li>RibbonLoadBalancerClienté€šè¿‡DynamicServerListLoadBalancerå‘eurekaæ‹‰å–æœåŠ¡åˆ—è¡¨</li><li>DynamicServerListLoadBalanceré€šè¿‡è´Ÿè½½å‡è¡¡ç­–ç•¥IRuleä»æœåŠ¡åˆ—è¡¨ä¸­è¿›è¡Œé€‰æ‹©ï¼Œæäº¤ç»™RibbonLoadBalancerClient</li><li>RibbonLoadBalancerClientå¯¹urlè¿›è¡Œä¿®æ”¹ï¼Œå‘èµ·è¯·æ±‚</li></ol><h3 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p><img src="https://s2.loli.net/2023/08/30/Vc82tw4vB5gkmPi.png" alt="image-20230830184232870.png"></p><h4 id="ä¿®æ”¹ç­–ç•¥"><a href="#ä¿®æ”¹ç­–ç•¥" class="headerlink" title="ä¿®æ”¹ç­–ç•¥"></a>ä¿®æ”¹ç­–ç•¥</h4><ol><li>é€šè¿‡åœ¨ç›¸å…³æœåŠ¡ä¸­å°†IRuleæ³¨å…¥springå®¹å™¨å®ç°å¯¹è´Ÿè½½å‡è¡¡ç­–ç•¥çš„ä¿®æ”¹ï¼Œä¾‹å¦‚xxx-serviceæ¨¡å—ä¸­çš„xxxServiceApplicationä¸­ï¼ˆæœ¬èº«ä¹Ÿç®—æ˜¯é…ç½®ç±»ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">randomRule</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œåœ¨xxx-serviceæ¨¡å—ä¸­çš„ymlé…ç½®ä¸­æ·»åŠ </li></ol><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.magus.config.RandomRule</span> <span class="comment"># è§„åˆ™ç±»çš„åç§°</span></span><br></pre></td></tr></table></figure><h3 id="é¥¥é¥¿åŠ è½½"><a href="#é¥¥é¥¿åŠ è½½" class="headerlink" title="é¥¥é¥¿åŠ è½½"></a>é¥¥é¥¿åŠ è½½</h3><p>Ribboné»˜è®¤æ˜¯æ‡’åŠ è½½ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ‰ä¼šåˆ›å»ºLoadBalancerClientï¼Œè¯·æ±‚æ—¶é—´è¾ƒé•¿ã€‚ä½¿ç”¨é¥¥é¥¿åŠ è½½å¯ä»¥åœ¨æœåŠ¡å¯åŠ¨æ—¶å°±åˆ›å»ºï¼Œå‡å°‘è¯·æ±‚æ—¶é—´</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="string">userservice</span> <span class="comment"># å•ä¸ªæœåŠ¡</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="comment"># å¤šä¸ªæœåŠ¡</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">userservice</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">orderservice</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Ribbon </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Eureka</title>
      <link href="/2023/08/30/SpringCloud-Eureka/"/>
      <url>/2023/08/30/SpringCloud-Eureka/</url>
      
        <content type="html"><![CDATA[<h3 id="Eurekaè§’è‰²"><a href="#Eurekaè§’è‰²" class="headerlink" title="Eurekaè§’è‰²"></a>Eurekaè§’è‰²</h3><p>æœåŠ¡ç«¯ï¼šEurekaServerï¼ŒæœåŠ¡ç«¯ï¼Œæ³¨å†Œä¸­å¿ƒã€‚è´Ÿè´£å¿ƒè·³ç›‘æ§ï¼Œè®°å½•æœåŠ¡ä¿¡æ¯</p><p>å®¢æˆ·ç«¯ï¼šEurekaClientï¼Œåˆ†ä¸ºæ¶ˆè´¹è€…å’Œæä¾›è€…ã€‚</p><h3 id="Eurekaçš„ä½œç”¨"><a href="#Eurekaçš„ä½œç”¨" class="headerlink" title="Eurekaçš„ä½œç”¨"></a>Eurekaçš„ä½œç”¨</h3><p>eurekaæœåŠ¡ç±»ä¼¼æ³¨å†Œä¸­å¿ƒï¼š</p><ol><li>æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…å°†æœåŠ¡ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</li><li>æ¶ˆè´¹è€…å‘æ³¨å†Œä¸­å¿ƒæ‹‰å–æä¾›è€…çš„æ–°æ¶ˆæ¯</li><li>é€šè¿‡è´Ÿè½½å‡è¡¡è¿›è¡Œé€‰æ‹©</li><li>å®ç°è¿œç¨‹è°ƒç”¨</li></ol><p>æ³¨å†Œä¸­å¿ƒä½¿ç”¨å¿ƒè·³ç»­çº¦ï¼Œéšæ—¶ç›‘æ§æœåŠ¡çŠ¶æ€</p><h3 id="Eurekaæ­å»º"><a href="#Eurekaæ­å»º" class="headerlink" title="Eurekaæ­å»º"></a>Eurekaæ­å»º</h3><p>æ­å»ºæœåŠ¡æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥spring-cloud-starter-netflix-eureka-serverä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- EurekaæœåŠ¡ç«¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœçˆ¶å·¥ç¨‹ä¸­å·²ç»é€‰å¥½äº†springcloudçš„ç‰ˆæœ¬ä»¥åŠç›¸å…³ä¾èµ–ï¼Œè¿™é‡Œä¸éœ€è¦å¡«å†™ç‰ˆæœ¬å·</p><ol start="2"><li>ç¼–å†™å¯åŠ¨ç±»ï¼Œå¹¶æ·»åŠ @EnableEurekaServeræ³¨è§£</li><li>ç¼–å†™ymlé…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯å£ã€æœåŠ¡åç§°ã€åœ°å€ä¿¡æ¯ï¼ˆç”¨äºeurekaé›†ç¾¤é€šä¿¡ï¼‰</li></ol><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Tomcat</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9099</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Spring</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hms_eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">sevice-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:$&#123;server.port&#125;/eureka</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œé€‰æ‹©ä¸å°†è‡ªå·±æ³¨å†Œ </span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ³¨å†Œ"></a>æœåŠ¡æ³¨å†Œ</h3><p>åœ¨ä¾èµ–ä¸­å¼•å…¥</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Eurekaå®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶åœ¨application.ymlä¸­é…ç½®eurekaç›¸å…³ä¿¡æ¯</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:9099/eureka</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå¯åŠ¨ç±»ä¸Šè¦åŠ ä¸Š@EnableEurekaServeræ³¨è§£</p><p>ä¸€ç›´é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæ—¥å¿—å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2023-08-30 16:57:34.306  INFO 1076 --- [           main] com.magus.UserServiceApplication         : No active profile <span class="built_in">set</span>, falling back to default profiles: default</span><br><span class="line">2023-08-30 16:57:34.580  INFO 1076 --- [           main] o.s.cloud.context.scope.GenericScope     : BeanFactory <span class="built_in">id</span>=24ae86d6-4a71-3421-838c-868a60323ef7</span><br><span class="line">2023-08-30 16:57:34.621  INFO 1076 --- [           main] trationDelegate<span class="variable">$BeanPostProcessorChecker</span> : Bean <span class="string">&#x27;org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration&#x27;</span> of <span class="built_in">type</span> [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$<span class="variable">$9adaa148</span>] is not eligible <span class="keyword">for</span> getting processed by all BeanPostProcessors (<span class="keyword">for</span> example: not eligible <span class="keyword">for</span> auto-proxying)</span><br><span class="line">2023-08-30 16:57:34.632  INFO 1076 --- [           main] trationDelegate<span class="variable">$BeanPostProcessorChecker</span> : Bean <span class="string">&#x27;org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration&#x27;</span> of <span class="built_in">type</span> [org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration$$EnhancerBySpringCGLIB$<span class="variable">$b6f4a445</span>] is not eligible <span class="keyword">for</span> getting processed by all BeanPostProcessors (<span class="keyword">for</span> example: not eligible <span class="keyword">for</span> auto-proxying)</span><br><span class="line">2023-08-30 16:57:34.644  WARN 1076 --- [           main] c.n.c.sources.URLConfigurationSource     : No URLs will be polled as dynamic configuration sources.</span><br><span class="line">2023-08-30 16:57:34.644  INFO 1076 --- [           main] c.n.c.sources.URLConfigurationSource     : To <span class="built_in">enable</span> URLs as dynamic configuration sources, define System property archaius.configurationSource.additionalUrls or make config.properties available on classpath.</span><br><span class="line">2023-08-30 16:57:34.649  WARN 1076 --- [           main] c.n.c.sources.URLConfigurationSource     : No URLs will be polled as dynamic configuration sources.</span><br><span class="line">2023-08-30 16:57:34.649  INFO 1076 --- [           main] c.n.c.sources.URLConfigurationSource     : To <span class="built_in">enable</span> URLs as dynamic configuration sources, define System property archaius.configurationSource.additionalUrls or make config.properties available on classpath.</span><br><span class="line">2023-08-30 16:57:36.516  INFO 1076 --- [           main] o.s.cloud.commons.util.InetUtils         : Cannot determine <span class="built_in">local</span> hostname</span><br><span class="line">2023-08-30 16:57:38.145  INFO 1076 --- [           main] o.s.cloud.commons.util.InetUtils         : Cannot determine <span class="built_in">local</span> hostname</span><br><span class="line">2023-08-30 16:57:38.203  INFO 1076 --- [           main] o.s.c.n.eureka.InstanceInfoFactory       : Setting initial instance status as: STARTING</span><br><span class="line">2023-08-30 16:57:38.224  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Initializing Eureka <span class="keyword">in</span> region us-east-1</span><br><span class="line">2023-08-30 16:57:38.855  INFO 1076 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using JSON encoding codec LegacyJacksonJson</span><br><span class="line">2023-08-30 16:57:38.855  INFO 1076 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using JSON decoding codec LegacyJacksonJson</span><br><span class="line">2023-08-30 16:57:38.928  INFO 1076 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using XML encoding codec XStreamXml</span><br><span class="line">2023-08-30 16:57:38.929  INFO 1076 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using XML decoding codec XStreamXml</span><br><span class="line">2023-08-30 16:57:39.042  INFO 1076 --- [           main] c.n.d.s.r.aws.ConfigClusterResolver      : Resolving eureka endpoints via configuration</span><br><span class="line">2023-08-30 16:57:39.460  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Disable delta property : <span class="literal">false</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Single vip registry refresh property : null</span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Force full registry fetch : <span class="literal">false</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Application is null : <span class="literal">false</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Registered Applications size is zero : <span class="literal">true</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Application version is -1: <span class="literal">true</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Getting all instance registry info from the eureka server</span><br><span class="line">2023-08-30 16:57:39.535  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : The response status is 200</span><br><span class="line">2023-08-30 16:57:39.536  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Starting heartbeat executor: renew interval is: 30</span><br><span class="line">2023-08-30 16:57:39.538  INFO 1076 --- [           main] c.n.discovery.InstanceInfoReplicator     : InstanceInfoReplicator onDemand update allowed rate per min is 4</span><br><span class="line">2023-08-30 16:57:39.541  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Discovery Client initialized at timestamp 1693385859540 with initial instances count: 0</span><br><span class="line">2023-08-30 16:57:39.542  INFO 1076 --- [           main] o.s.c.n.e.s.EurekaServiceRegistry        : Registering application USER-SERVICE with eureka with status UP</span><br><span class="line">2023-08-30 16:57:39.543  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Saw <span class="built_in">local</span> status change event StatusChangeEvent [timestamp=1693385859543, current=UP, previous=STARTING]</span><br><span class="line">2023-08-30 16:57:39.544  INFO 1076 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999: registering service...</span><br><span class="line">2023-08-30 16:57:39.554  INFO 1076 --- [           main] com.magus.UserServiceApplication         : Started UserServiceApplication <span class="keyword">in</span> 9.058 seconds (JVM running <span class="keyword">for</span> 10.165)</span><br><span class="line">2023-08-30 16:57:39.556  INFO 1076 --- [       Thread-5] o.s.c.n.e.s.EurekaServiceRegistry        : Unregistering application USER-SERVICE with eureka with status DOWN</span><br><span class="line">2023-08-30 16:57:39.557  WARN 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : Saw <span class="built_in">local</span> status change event StatusChangeEvent [timestamp=1693385859557, current=DOWN, previous=UP]</span><br><span class="line">2023-08-30 16:57:39.561  INFO 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : Shutting down DiscoveryClient ...</span><br><span class="line">2023-08-30 16:57:39.602  INFO 1076 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999 - registration status: 204</span><br><span class="line">2023-08-30 16:57:39.603  INFO 1076 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999: registering service...</span><br><span class="line">2023-08-30 16:57:39.614  INFO 1076 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999 - registration status: 204</span><br><span class="line">2023-08-30 16:57:39.615  INFO 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : Unregistering ...</span><br><span class="line">2023-08-30 16:57:39.630  INFO 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999 - deregister  status: 200</span><br><span class="line">2023-08-30 16:57:39.637  INFO 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : Completed shut down of DiscoveryClient</span><br></pre></td></tr></table></figure><p><strong>åŸå› ï¼š</strong> Eurekaå®¢æˆ·ç«¯ï¼ˆæœåŠ¡æä¾›è€…&#x2F;æ¶ˆè´¹è€…ï¼‰æ²¡æœ‰æˆåŠŸå¼•å…¥webçš„starterï¼ˆå¤´ç–¼äº†åŠå°æ—¶ï¼‰ã€‚</p><h4 id="æ³¨å†Œå¤šä¸ªå®ä¾‹"><a href="#æ³¨å†Œå¤šä¸ªå®ä¾‹" class="headerlink" title="æ³¨å†Œå¤šä¸ªå®ä¾‹"></a>æ³¨å†Œå¤šä¸ªå®ä¾‹</h4><p>å¯ä»¥å¯¹æœåŠ¡çš„é…ç½®è¿›è¡Œå¤åˆ¶ç„¶ååœ¨VMè®¾ç½®ä¸­æ·»åŠ å‚æ•°-Dserver.port&#x3D;xxxx</p><h3 id="æœåŠ¡æ‹‰å–"><a href="#æœåŠ¡æ‹‰å–" class="headerlink" title="æœåŠ¡æ‹‰å–"></a>æœåŠ¡æ‹‰å–</h3><ol><li>åŒæ³¨å†Œï¼Œå¼•å…¥ä¾èµ–ï¼Œé…ç½®eurekaåœ°å€ã€‚</li><li>ç»™ResTemplateæ·»åŠ @LoadBanlancedæ³¨è§£ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰</li><li>ç”¨æœåŠ¡æä¾›è€…çš„æ³¨å†ŒæœåŠ¡åç§°ä»£æ›¿urlä¸­çš„ä¸€éƒ¨åˆ†è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œä¾‹å¦‚ <a href="http://userservice/user/1">http://userservice/user/1</a> (restful)</li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Eurekaèµ·åˆ°ä¸ºæœåŠ¡ä¹‹é—´æä¾›è¿œç¨‹è°ƒç”¨çš„ä½œç”¨ï¼Œæ¥å®ç°å°†æœåŠ¡åˆ†ç¦»åˆèƒ½äº¤äº’</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Eureka </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyFirstBlog</title>
      <link href="/2023/08/29/MyFirstBlog/"/>
      <url>/2023/08/29/MyFirstBlog/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬ä¸€ç¯‡æ–‡ç« "><a href="#ç¬¬ä¸€ç¯‡æ–‡ç« " class="headerlink" title="ç¬¬ä¸€ç¯‡æ–‡ç« "></a>ç¬¬ä¸€ç¯‡æ–‡ç« </h2><p>2023å¹´8æœˆ29æ—¥æ­£å¼æ­å»ºå±äºæˆ‘çš„åšå®¢ï¼Œå¸Œæœ›æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½å†™å‡ºåƒhexoä¸€æ ·èƒ½è¢«ç™¾ä¸‡äººä½¿ç”¨çš„project</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
