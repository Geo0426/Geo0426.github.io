<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Unityå­¦ä¹ æ—¥å¿—</title>
      <link href="/2024/06/12/Unity%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%BF%97/"/>
      <url>/2024/06/12/Unity%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h2 id="æ‘„åƒæœº"><a href="#æ‘„åƒæœº" class="headerlink" title="æ‘„åƒæœº"></a>æ‘„åƒæœº</h2><p>ç›¸æœºæŠ•å½±åˆ†ä¸ºé€è§†å’Œæ­£äº¤ï¼Œé€è§†å°±æ˜¯è¿‘å¤§è¿œå°ï¼Œä¸€èˆ¬3Dæ¸¸æˆéƒ½ä¼šä½¿ç”¨ï¼›æ­£äº¤ä¸€èˆ¬ç”¨äº2Då¼€å‘ï¼Œä¸åˆ†å¤§å°ã€‚</p><p>å¤šä¸ªç›¸æœºèåˆä½¿ç”¨ï¼Œå¯ä»¥å°†æ¸…é™¤æ ‡å¿—è®¾ç½®ä¸ºä»…æ·±åº¦ï¼Œå¯ä»¥å°†å¤šä¸ªç›¸æœºæ‹æ‘„åˆ°çš„åœºæ™¯è¿›è¡Œèåˆã€‚</p><p>é€šè¿‡è£å‰ªå¹³é¢è°ƒæ•´è¿‘é¢å’Œè¿œé¢ï¼Œå¯ä»¥è°ƒæ•´ç›¸æœºçš„æ‹æ‘„èŒƒå›´å¤§å°ã€‚</p><p>ä¿®æ”¹ç›¸æœºçš„ç›®æ ‡çº¹ç†ï¼Œå¯ä»¥è®©ç›¸æœºæ¸²æŸ“ç”»é¢è¢«æ¸²æŸ“åˆ°ç›®æ ‡çº¹ç†ä¸­ï¼Œå¯ä»¥ç±»ä¼¼ç›‘æ§çš„æ–¹å¼èµ‹ç»™å…¶ä»–ç‰©ä½“ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C#è„šæœ¬å­¦ä¹ æ—¥å¿—</title>
      <link href="/2024/06/06/C#%E8%84%9A%E6%9C%AC%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%BF%97/"/>
      <url>/2024/06/06/C#%E8%84%9A%E6%9C%AC%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h2 id="C-è„šæœ¬ç”Ÿå‘½å‘¨æœŸ"><a href="#C-è„šæœ¬ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="C#è„šæœ¬ç”Ÿå‘½å‘¨æœŸ"></a>C#è„šæœ¬ç”Ÿå‘½å‘¨æœŸ</h2><ul><li>Awakeï¼šåˆå§‹åŒ–ã€‚</li><li>Enableï¼šæ¸²æŸ“å¯ç”¨æ—¶è°ƒç”¨ï¼Œåˆå§‹åŒ–æ–¹æ³•ä¸èƒ½å†™åœ¨é‡Œé¢ã€‚</li><li>Startï¼šç¬¬ä¸€æ¬¡Enableåè°ƒç”¨ã€‚</li><li>Updateï¼šæ¯ä¸€å¸§è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>LateUpdateï¼šupdateæ‰§è¡Œå®Œlateupdateå°±ä¼šæ‰§è¡Œã€‚</li><li>FixedUpdateï¼šç±»ä¼¼å®šæ—¶å™¨ï¼Œå®šæœŸæ‰§è¡Œï¼Œä¸æœºå™¨æ€§èƒ½å¸§æ•°æ— å…³ï¼Œä»…å’Œæ—¶é—´æœ‰å…³ã€‚é»˜è®¤0.02sã€‚</li><li>UnDisableï¼šéæ¿€æ´»çŠ¶æ€è°ƒç”¨ã€‚</li><li>OnDestroyï¼šé”€æ¯æ—¶è°ƒç”¨ã€‚</li></ul><h2 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h2><p>ä¸Šä¸€å¸§åˆ°ä¸‹ä¸€å¸§çš„æ¸¸æˆæ—¶é—´Time.deltaTimeã€‚</p><p>æ—¶é—´ç¼©æ”¾å€¼Time.timeScaleã€‚</p><h2 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h2><p>æ¸¸æˆæ•°æ®æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆåªè¯»ï¼ŒåŠ å¯†å‹ç¼©ï¼‰Applicants.dataPathã€‚</p><p>æŒä¹…åŒ–æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆå¯å†™ï¼‰Applicants.persistentDataPathã€‚</p><p>StreamingAssetsæ–‡ä»¶å¤¹è·¯å¾„ï¼ˆåªè¯»ï¼Œä¸åŠ å¯†ï¼‰Application.streamingAssetsPathã€‚</p><p>ä¸´æ—¶æ–‡ä»¶å¤¹Application.temporaryCachePathã€‚</p><p>åå°è¿è¡ŒApplication.runInBackgroundã€‚</p><p>æ‰“å¼€url Application.OpenURLã€‚</p><p>é€€å‡ºæ¸¸æˆApplication.Quit()ã€‚</p><h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><p>SceneManager.CreateScene()åˆ›å»ºåœºæ™¯ã€‚</p><p>SceneManager.LoadScene(â€œåœºæ™¯åç§°ï¼ˆç¼–å·ï¼‰â€)åŠ è½½åœºæ™¯ï¼›LoadSceneModeå‚æ•°è®¾ç½®ä¸ºSingleæ—¶åªåŠ è½½å½“å‰åœºæ™¯ï¼Œè®¾ç½®ä¸ºAdditiveæ—¶å åŠ åœºæ™¯ã€‚</p><p>SceneManager.LoadSceneAsync()å¼‚æ­¥åŠ è½½åœºæ™¯ï¼Œå½“åœºæ™¯å¾ˆå¤§æ—¶åŠ è½½é€Ÿåº¦è¾ƒæ…¢ã€‚</p><p>SceneManager.UnloadSceneAsync()å¸è½½åœºæ™¯ã€‚</p><p>SceneManager.GetActiveScene()è·å–å½“å‰åœºæ™¯ã€‚</p><p>Scene.GetRootGameObjects()è·å–åœºæ™¯ä¸­çš„æ‰€æœ‰æ¸¸æˆç‰©ä½“ã€‚</p><h2 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h2><p>AsyncOperationä½œä¸ºå¼‚æ­¥åŠ è½½åœºæ™¯SceneManager.LoadSceneAsync()çš„è¿”å›å€¼ï¼Œä½¿ç”¨yield returnè¿”å›ä¸€ä¸ªåç¨‹IEnumeratorï¼Œå¹¶ä½¿ç”¨StartCoroutineå¯åŠ¨åç¨‹ã€‚</p><p>operation.progresså¯ä»¥æŸ¥çœ‹åŠ è½½è¿›åº¦ï¼Œåœ¨UIåˆ¶ä½œæ—¶å¯ä»¥åšè¿›åº¦æ¡ã€‚</p><p>operation.allowSceneActivationå¯ä»¥æ§åˆ¶åœºæ™¯æ˜¯å¦è·³è½¬ï¼Œè®¾ç½®ä¸ºFalseä¸ä¼šè‡ªåŠ¨è·³è½¬ã€‚</p><h2 id="Transform"><a href="#Transform" class="headerlink" title="Transform"></a>Transform</h2><p>transform.positionæ˜¯ä¸–ç•Œåæ ‡ç³»é‡Œçš„ä½ç½®ã€‚</p><p>transform.localPositionæ˜¯ç›¸å¯¹çˆ¶ç‰©ä½“çš„ä½ç½®ã€‚</p><p>transform.LookAt(ç‚¹åæ ‡)çœ‹å‘æŸä¸ªç‚¹ã€‚</p><p>transform.Rotate(è½´, æ—‹è½¬åº¦æ•°)ï¼›transform.RotateAround(ç‚¹ï¼Œè½´ï¼Œæ—‹è½¬åº¦æ•°)ã€‚</p><p>transform.Translate()ç§»åŠ¨ã€‚</p><p>transform.parent.gameObjectè·å–çˆ¶ç‰©ä½“ã€‚</p><p>transform.DetachChildren()è§£é™¤æ‰€æœ‰å­ç‰©ä½“ã€‚</p><p>transform.GetChild(0)æ ¹æ®ä¸‹æ ‡è·å–å­ç‰©ä½“ï¼›transform.Find(â€œå­ç‰©ä½“åç§°â€)æ ¹æ®åç§°è·å¾—å­ç‰©ä½“ã€‚</p><p>SetParent()è®¾ç½®çˆ¶ç‰©ä½“ã€‚</p><h2 id="é”®é¼ æ“ä½œ"><a href="#é”®é¼ æ“ä½œ" class="headerlink" title="é”®é¼ æ“ä½œ"></a>é”®é¼ æ“ä½œ</h2><p>input.GetMouseButtonDown()æŒ‰ä¸‹é¼ æ ‡ï¼›input.GetKeyDown(KeyCode)æŒ‰ä¸‹é”®ç›˜ã€‚</p><p>input.GetMouseButton()æŒ‰ä½é¼ æ ‡ï¼›input.GetKey(KeyCode)æŒ‰ä½é”®ç›˜ã€‚</p><p>input.GetMouseButtonUP()æ¾å¼€é¼ æ ‡ï¼›input.GetKeyUp(KeyCode)æ¾å¼€é”®ç›˜ã€‚</p><h2 id="è§¦æ‘¸æ“ä½œ"><a href="#è§¦æ‘¸æ“ä½œ" class="headerlink" title="è§¦æ‘¸æ“ä½œ"></a>è§¦æ‘¸æ“ä½œ</h2><p>åˆ¤æ–­è§¦æ‘¸ç‚¹æ•°ç›®ä½¿ç”¨Input.touchCountã€‚åˆ¤æ–­è§¦æ‘¸é˜¶æ®µï¼Œç±»ä¼¼é”®é¼ æ“ä½œä¸­çš„æŠ¬èµ·æŒ‰ä¸‹ï¼ŒåŸºäºtouch.phaseã€‚</p><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(Input.touchCount == <span class="number">1</span>) &#123;</span><br><span class="line">    Touch touch = Input.touches[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">switch</span>(touch.phase) &#123;</span><br><span class="line">        <span class="keyword">case</span> TouchPhase.Began:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> TouchPhase.Moved:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> TouchPhase.Stationary:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> TouchPhase.Ended:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> TouchPhase.Cancled:</span><br><span class="line">            <span class="keyword">break</span>;            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  å¼€å¯å¤šç‚¹è§¦æ‘¸</span></span><br><span class="line">Input.multiTouchEnabled = True;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(Input.touchCount == <span class="number">2</span>) &#123;</span><br><span class="line">    Touch touch0 = Input.touches[<span class="number">0</span>];</span><br><span class="line">    Touch touch1 = Input.touches[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è™šæ‹Ÿè½´"><a href="#è™šæ‹Ÿè½´" class="headerlink" title="è™šæ‹Ÿè½´"></a>è™šæ‹Ÿè½´</h2><p>Input.GetAxis(â€œHorizontalâ€)è¡¨ç¤ºæ°´å¹³è™šæ‹Ÿè½´ï¼Œç”±adæˆ–è€…å·¦å³æ§åˆ¶ï¼Œæˆ–è€…æ‘‡æ†ã€‚</p><p>Input.GetAxis(â€œVerticalâ€)è¡¨ç¤ºå‚ç›´è™šæ‹Ÿè½´ï¼Œç”±wsæˆ–è€…å‰åæ§åˆ¶ï¼Œæˆ–è€…æ‘‡æ†ã€‚</p><p>CharacterController.SimpleMove(å‘é‡)ä¼šæœç€å‘é‡æ–¹å‘ç§»åŠ¨ï¼Œå‘é‡dirè®¾ç½®ä¸ºVector3(horizontal, 0, vertical)ï¼Œå¯ä»¥å®Œæˆç®€å•è§’è‰²æ–¹å‘æ§åˆ¶ã€‚</p><h2 id="ç¢°æ’æ£€æµ‹"><a href="#ç¢°æ’æ£€æµ‹" class="headerlink" title="ç¢°æ’æ£€æµ‹"></a>ç¢°æ’æ£€æµ‹</h2><p>OnCollisionEnterç›‘å¬å‘ç”Ÿç¢°æ’ï¼›OnCollisionStayç›‘å¬ç¢°æ’æŒç»­ä¸­ï¼›OnCollisionExitç›‘å¬ç¢°æ’ç»“æŸã€‚</p><p>Collisionç±»é‡ŒåŒ…å«äº†ç¢°æ’çš„ä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºæŸ¥çœ‹ç¢°æ’ç‰©ä½“åç§°ç­‰ã€‚</p><h2 id="è§¦å‘"><a href="#è§¦å‘" class="headerlink" title="è§¦å‘"></a>è§¦å‘</h2><p>OnTriggerEnterç›‘å¬è§¦å‘å‘ç”Ÿï¼›OnCollisionStayç›‘å¬è§¦å‘æŒç»­ä¸­ï¼›OnCollisionExitç›‘å¬è§¦å‘ç»“æŸã€‚</p><p>å‹¾é€‰æ˜¯è§¦å‘å™¨é€‰é¡¹åï¼Œä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºï¼Œå®ƒä¸å—ç‰©ç†å½±å“ï¼Œå¯ä»¥ç›´æ¥ç©¿é€è€Œä¸ä¼šæœ‰ç¢°æ’ä½“ç§¯ï¼Œä½†åŒæ—¶å¯ä»¥æ£€æµ‹åˆ°ç¢°æ’ã€‚</p><hr><h3 id="2024-8-29"><a href="#2024-8-29" class="headerlink" title="2024.8.29"></a>2024.8.29</h3><p>å¾ˆä¹…æ²¡å†™ï¼Œæˆ‘å†³å®šé‡å¯æˆ‘çš„blogï¼Œæœ€è¿‘åŸºæœ¬éƒ½åœ¨ä½¿ç”¨Unityå’Œç¼–å†™C#è„šæœ¬ï¼Œç„¶åå°±æ˜¯ç”¨Pythonæ­æ¨¡å‹è°ƒå‚æ•°â€¦</p>]]></content>
      
      
      <categories>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DWA path planning algorithm</title>
      <link href="/2023/11/21/DWA-path-planning-algorithm/"/>
      <url>/2023/11/21/DWA-path-planning-algorithm/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> è·¯å¾„è§„åˆ’ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è·¯å¾„è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A* path planning algorithm</title>
      <link href="/2023/11/21/A-path-planning-algorithm/"/>
      <url>/2023/11/21/A-path-planning-algorithm/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºæœ¬å®šä¹‰"><a href="#åŸºæœ¬å®šä¹‰" class="headerlink" title="åŸºæœ¬å®šä¹‰"></a>åŸºæœ¬å®šä¹‰</h2><p>Gï¼šèµ·ç‚¹Aåˆ°ç½‘æ ¼ä¸­çš„æŒ‡å®šç‚¹æ‰€èŠ±è´¹çš„ä»£ä»·</p><p>Hï¼šæŒ‡å®šç‚¹åˆ°ç»ˆç‚¹æ‰€èŠ±è´¹çš„ä»£ä»·ï¼ˆè¿™é‡ŒHåªç”¨ä¸Šä¸‹ä½œç”¨æ¥è®¡ç®—ï¼Œä¸èƒ½æ–œå‘ç§»åŠ¨ï¼‰</p><p>Fï¼šF &#x3D; G + Hï¼Œèµ·ç‚¹åˆ°ç»ˆç‚¹ç»è¿‡æŒ‡å®šç‚¹çš„æ€»ä»£ä»·</p><p>open_listï¼šç”¨æ¥å¯»æ‰¾æœ€çŸ­çš„è·¯å¾„çš„ä¸­é—´ç‚¹</p><p>closed_listï¼šä¸ä¼šè¢«è€ƒè™‘çš„ç‚¹</p><p>ç»“æŸæ¡ä»¶ï¼š1. ç»ˆç‚¹å‡ºç°åœ¨open_listï¼›2. open_listç©º</p><h2 id="è¯¦ç»†æ­¥éª¤"><a href="#è¯¦ç»†æ­¥éª¤" class="headerlink" title="è¯¦ç»†æ­¥éª¤"></a>è¯¦ç»†æ­¥éª¤</h2><ol><li>ä»èµ·ç‚¹Så¼€å§‹ï¼ŒæŠŠsä½œä¸ºä¸€ä¸ªç­‰å¾…æ£€æŸ¥çš„æ–¹æ ¼ï¼Œæ”¾å…¥åˆ°open_listä¸­</li><li>å¯»æ‰¾èµ·ç‚¹Så‘¨å›´å¯ä»¥åˆ°è¾¾çš„æ–¹æ ¼(æœ€å¤šå…«ä¸ª) ï¼Œå°†å®ƒä»¬æ”¾å…¥åˆ°open_listï¼Œå¹¶è®¾ç½®å®ƒä»¬çš„çˆ¶æ–¹æ ¼ä¸ºS</li><li>ä»open_listä¸­åˆ é™¤èµ·ç‚¹Sï¼Œå¹¶å°†æ”¾å…¥åˆ°closed_listä¸­(closed_listå­˜æ”¾çš„æ˜¯ä¸å†éœ€è¦æ£€æŸ¥çš„æ–¹æ ¼)</li><li>è®¡ç®—æ¯ä¸ªå‘¨å›´æ–¹æ ¼çš„Få€¼</li><li>ä»open_listä¸­é€‰æ‹©Få€¼æœ€ä½çš„æ–¹æ ¼ï¼Œå°†å®ƒä»open_listä¸­ç§»é™¤ï¼Œå¹¶ä¸”æŠŠå®ƒå¯è¾¾çš„æ–¹æ ¼ï¼ˆéšœç¢å’Œclosed_listä¸­çš„æ–¹æ ¼èˆå¼ƒï¼‰åŠ å…¥åˆ°open_list</li><li>å¦‚æœå¯è¾¾æ–¹æ ¼ä¸åœ¨open_listä¸­ï¼Œåˆ™çˆ¶æ–¹æ ¼è®¾ç½®ä¸ºå½“å‰æ–¹æ ¼ï¼›å¦‚æœå¯è¾¾æ–¹æ ¼å·²ç»åœ¨open_listä¸­ï¼Œå·²å½“å‰æ–¹æ ¼ä¸ºä¸­é—´ç‚¹å¾—åˆ°çš„Gå€¼æ¯”åŸæ¥çš„æ›´å°ï¼Œåˆ™æ›´æ–°çˆ¶èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹ï¼ŒF &#x3D; Gâ€™ + Hï¼Œå¦åˆ™ä¸å˜</li><li>å¾ªç¯ä»open_listä¸­æ‰¾Få€¼æœ€å°çš„ç‚¹æ¥æ›´æ–°ï¼Œç›´åˆ°ç»“æŸæ¡ä»¶</li></ol><h2 id="å›¾ç‰‡æ¼”ç¤º"><a href="#å›¾ç‰‡æ¼”ç¤º" class="headerlink" title="å›¾ç‰‡æ¼”ç¤º"></a>å›¾ç‰‡æ¼”ç¤º</h2><p><img src="https://s2.loli.net/2023/11/21/LE9CsnAJDSvFYTe.png" alt="img"></p><p>a5çš„Få€¼æœ€å°ï¼Œå› æ­¤æŠŠa5ä»open_listä¸­å»æ‰ï¼Œå®ƒçš„å¯è¾¾èŠ‚ç‚¹åŠ å…¥open_list</p><p><img src="https://s2.loli.net/2023/11/21/bqveX126Aht4PVr.png" alt="img"></p><p><img src="https://s2.loli.net/2023/11/21/E2F3tyeTvkUdPSq.png" alt="img"></p><p><img src="https://s2.loli.net/2023/11/21/lOAdNRSiC92LvfH.png" alt="img"></p><p>é€šè¿‡a7è¿›è¡Œæ›´æ–°ï¼Œå¾—åˆ°çš„Gå€¼æ¯”åŸå…ˆé€šè¿‡a8å¾—åˆ°çš„Gå€¼è¦æ›´å°ï¼Œå› æ­¤è¿™é‡Œb1çš„çˆ¶èŠ‚ç‚¹æ›¿æ¢ä¸ºa7ï¼ŒåŒæ—¶Få€¼åº”è¯¥æ›¿æ¢ä¸º80ï¼ˆåç»­å›¾ç‰‡æœ‰è¯¯ï¼‰</p><p><img src="https://s2.loli.net/2023/11/21/c5RQJDqiN2agyZC.png" alt="img"></p><p><img src="https://s2.loli.net/2023/11/21/zjTOR4LgXY721rD.png" alt="img"></p><p><img src="https://s2.loli.net/2023/11/21/l6ThY1idXp5mZ7F.png" alt="img"></p><p><img src="https://s2.loli.net/2023/11/21/R8lKGCP7Ac6SByt.png" alt="img"></p><p><img src="https://s2.loli.net/2023/11/21/pQt2oJUrPnYdwiE.png" alt="img"></p><p><img src="https://s2.loli.net/2023/11/21/9xHl2aVbM7YRrk3.png" alt="img"></p><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://blog.csdn.net/dujuancao11/article/details/114842884">https://blog.csdn.net/dujuancao11/article/details/114842884</a></p>]]></content>
      
      
      <categories>
          
          <category> è·¯å¾„è§„åˆ’ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è·¯å¾„è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ— äººæ°´é¢è‰‡å±€éƒ¨è·¯å¾„è§„åˆ’ç®—æ³•ç ”ç©¶ç»¼è¿°</title>
      <link href="/2023/11/20/%E6%97%A0%E4%BA%BA%E6%B0%B4%E9%9D%A2%E8%89%87%E5%B1%80%E9%83%A8%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%E7%AE%97%E6%B3%95%E7%A0%94%E7%A9%B6%E7%BB%BC%E8%BF%B0/"/>
      <url>/2023/11/20/%E6%97%A0%E4%BA%BA%E6%B0%B4%E9%9D%A2%E8%89%87%E5%B1%80%E9%83%A8%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%E7%AE%97%E6%B3%95%E7%A0%94%E7%A9%B6%E7%BB%BC%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<p>æ–‡ç« æ˜¯ä¸€ç¯‡ç»¼è¿°ï¼Œä»<strong>è·¯å¾„æœç´¢</strong>å’Œ<strong>è½¨è¿¹ä¼˜åŒ–</strong>è¿™ä¸¤ä¸ªå±‚é¢æ¥å¯¹ç›®å‰çš„è·¯å¾„è§„åˆ’ç®—æ³•è¿›è¡Œæ€»ç»“</p><h2 id="è·¯å¾„æœç´¢"><a href="#è·¯å¾„æœç´¢" class="headerlink" title="è·¯å¾„æœç´¢"></a>è·¯å¾„æœç´¢</h2><p><img src="https://s2.loli.net/2023/11/21/J6virsL3NZtRhn1.jpg" alt="img"></p><h3 id="Astar"><a href="#Astar" class="headerlink" title="Astar*"></a>Astar*</h3><p>æ–‡ç« æåˆ°äº†ä¸¤ç§Astarçš„æ”¹è¿›ç®—æ³•ï¼šä¸€ç§ç¨€ç–Astarç®—æ³•ï¼Œå¯¹è½¬è§’çš„æœ€å¤§å¢é‡åšäº†é™åˆ¶ï¼Œå¾—åˆ°çš„æ›²çº¿æ›´åŠ å¹³æ»‘ï¼›ä¸€ç§ç»“åˆè‡ªé€‚åº”æ›¿æ¢ç¼“å­˜ï¼ˆARCï¼‰ç­–ç•¥ä¸åŸºäºAstarç®—æ³•çš„Theta starç®—æ³•â€”â€”<a href="https://www.sciencedirect.com/science/article/abs/pii/S0029801814001292?via=ihub">Angular rate-constrained path planning algorithm for unmanned surface vehicles</a>ï¼Œè€ƒè™‘äº†è§’é€Ÿåº¦çº¦æŸå¾—åˆ°äº†æ›´ç¬¦åˆå…¶è¿åŠ¨ç‰¹æ€§çš„è§„åˆ’è·¯å¾„ï¼ˆæˆ‘è®¤ä¸ºæ¯”è¾ƒç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼‰</p><p><img src="https://s2.loli.net/2023/11/21/xUPiMm4nuDg5HQo.jpg" alt="img"></p><p>å¦å¤–é™¤äº†æµ·åŸŸå†…çš„éšœç¢ï¼Œè¿˜éœ€è¦è€ƒè™‘åˆ°èˆ¹åªï¼Œä»¥åŠèˆ¹èˆ¶å®‰å…¨é¢†åŸŸã€å›½é™…æµ·ä¸Šé¿ç¢°è§„åˆ™ç­‰çœŸå®å› ç´ é™åˆ¶ã€‚</p><h3 id="è™šæ‹ŸåŠ¿åœºæ³•"><a href="#è™šæ‹ŸåŠ¿åœºæ³•" class="headerlink" title="è™šæ‹ŸåŠ¿åœºæ³•"></a>è™šæ‹ŸåŠ¿åœºæ³•</h3><p>åŒ…å«äººå·¥åŠ¿åœºæ³•å’Œå¿«é€Ÿè¡Œè¿›æ³•</p><h4 id="äººå·¥åŠ¿åœºæ³•"><a href="#äººå·¥åŠ¿åœºæ³•" class="headerlink" title="äººå·¥åŠ¿åœºæ³•*"></a>äººå·¥åŠ¿åœºæ³•*</h4><p>äººå·¥åŠ¿åœºAPFå€Ÿé‰´äº†ç”µåŠ¿åœºçš„æ¦‚å¿µï¼Œç›®æ ‡ç‚¹äº§ç”Ÿå¼•åŠ›ï¼Œè€Œéšœç¢ç‰©äº§ç”Ÿæ–¥åŠ›ï¼Œå¼•åŠ›åœºä¸æ–¥åŠ›åœºå åŠ å½¢æˆåŒ…å«å¼•å¯¼USVåˆ°è¾¾ç›®æ ‡ç‚¹åŠé¿éšœä¿¡æ¯çš„äººå·¥åŠ¿åœºã€‚ä¼ ç»ŸAPFé’ˆå¯¹åŠ¨æ€é¿éšœæ•ˆæœè¾ƒå·®ï¼Œé›†ç¾¤è¿åŠ¨éœ€è¦è€ƒè™‘åˆ°èˆ¹èˆ¶ä¹‹é—´çš„è·ç¦»ã€‚</p><p><a href="https://www.sciencedirect.com/science/article/pii/S002980182100144X">The hybrid path planning algorithm based on improved A* and artificial potential field for unmanned surface vehicle formations</a>è¿™ç¯‡è®ºæ–‡ä¸­æå‡ºçš„æ”¹è¿›APFæ–¹æ³•ï¼Œåœ¨ç»“åˆAstarç®—æ³•çš„å‰æä¸‹ï¼Œå¯¹é›†ç¾¤ç¼–é˜Ÿé‡‡ç”¨äº†ä¼˜å…ˆç­–ç•¥ï¼Œè®¾ç½®ä¸€ä¸ªé¢†é˜Ÿï¼Œä¸€ä¸ªè·Ÿéšè€…ï¼Œä¸€ä¸ªå‰¯è·Ÿéšè€…ã€‚é€šè¿‡æ£€æµ‹èˆ¹èˆ¶ä¹‹é—´çš„è·ç¦»å¯¹é€Ÿåº¦è¿›è¡Œæ§åˆ¶æ¥é¿å…é›†ç¾¤ä¹‹é—´ç¢°æ’ï¼šè·Ÿéšè€…ä¸å‰¯è·Ÿéšè€…è·ç¦»é è¿‘æ—¶ï¼Œå‰¯è·Ÿéšè€…å‡é€Ÿï¼Œåä¹‹åŠ é€Ÿã€‚å½¢æˆé˜Ÿå½¢åå†æŒ‰ç…§Astarè§„åˆ’çš„è·¯å¾„å‰è¡Œã€‚</p><p><img src="https://s2.loli.net/2023/11/21/K4IfGyRlWCZpvok.jpg" alt="img"></p><h4 id="å¿«é€Ÿè¿›è¡Œæ³•"><a href="#å¿«é€Ÿè¿›è¡Œæ³•" class="headerlink" title="å¿«é€Ÿè¿›è¡Œæ³•"></a>å¿«é€Ÿè¿›è¡Œæ³•</h4><p>|âˆ‡(T(s))|W(s)&#x3D;1</p><p>åˆ©ç”¨äºŒå€¼æ …æ ¼æ³•è¿›è¡Œç¯å¢ƒå»ºæ¨¡ï¼Œå°†éšœç¢ç‰©åŒºåŸŸè®¾ä¸º<em>W</em>(<em>i</em>, <em>j</em>)&#x3D;0ï¼Œå°†å¯é€šè¡ŒåŒºåŸŸè®¾ä¸º<em>W</em>(<em>i</em>, <em>j</em>)&#x3D;1ã€‚é€šè¿‡æ•°å€¼æ±‚è§£ç¨‹å‡½æ–¹ç¨‹ï¼Œå¾—åˆ°åœ°å›¾ä¸­å„ç½‘æ ¼ç‚¹çš„<em>T</em>å€¼ï¼Œå°†å…¶è§†ä¸ºåŠ¿åœºå€¼ï¼Œä»è€Œå»ºç«‹è™šæ‹ŸåŠ¿åœº</p><p>ä¸APFæ³•ç›¸æ¯”ï¼ŒFMMæ³•æ„å»ºåŠ¿åœºå”¯ä¸€çš„æå°å€¼ç‚¹ä¾¿æ˜¯èµ·ç‚¹ï¼Œä¸å­˜åœ¨è·¯å¾„é™·å…¥å±€éƒ¨æå°å€¼é—®é¢˜</p><p>ï¼ˆæš‚æ—¶ä¸è€ƒè™‘ï¼‰</p><h3 id="æ™ºèƒ½ç®—æ³•"><a href="#æ™ºèƒ½ç®—æ³•" class="headerlink" title="æ™ºèƒ½ç®—æ³•"></a>æ™ºèƒ½ç®—æ³•</h3><h4 id="é—ä¼ ç®—æ³•"><a href="#é—ä¼ ç®—æ³•" class="headerlink" title="é—ä¼ ç®—æ³•"></a>é—ä¼ ç®—æ³•</h4><p>GAç®—æ³•çš„å®æ—¶æ€§è¾ƒå·®ï¼Œä¸€èˆ¬ä¸ç”¨äºå®æ—¶è§„åˆ’ï¼Œç”¨äºç¦»çº¿è§„åˆ’ï¼Œæš‚ä¸è€ƒè™‘</p><h4 id="ç²’å­ç¾¤ç®—æ³•"><a href="#ç²’å­ç¾¤ç®—æ³•" class="headerlink" title="ç²’å­ç¾¤ç®—æ³•"></a>ç²’å­ç¾¤ç®—æ³•</h4><p>é€šè¿‡æœ€ä¼˜è§£çš„ä½ç½®å¯å‘å…¶å®ƒç²’å­æœç€æœ€ä¼˜è§£æ–¹å‘å‰è¿›ï¼Œä»è€Œå®ç°ç²’å­ç¾¤æ•´ä½“æœç€æœ€ä¼˜è§£çš„æ–¹å‘æ”¶æ•›ï¼Œæœ¬æ–‡ä¸­æåˆ°çš„ç®—æ³•å¹´ä»£ä¹…è¿œäº†éœ€è¦é‡æ–°è°ƒç ”</p><p><img src="https://s2.loli.net/2023/11/13/yQ9gjscvZRGKYDr.png" alt="image-20231113111655572"></p><p><em>vi,d</em>ä¸ºå½“å‰ä»£æ•°ä¸‹ç²’å­è¿åŠ¨é€Ÿåº¦ï¼›<em>xi,d</em>ä¸ºå½“å‰ä»£æ•°ä¸‹ç²’å­ä½ç½®ï¼›<em>Pi,d</em>ä¸ºå½“å‰ä»£æ•°ä¸‹çš„æœ€ä¼˜è§£ï¼›<em>Pg,d</em>ä¸ºå†å²ï¼ˆå…¨å±€ï¼‰æœ€ä¼˜è§£ï¼›Ï‰ä¸ºæƒ¯æ€§æƒé‡ï¼›<em>c</em>1å’Œ<em>c</em>2ä¸ºå­¦ä¹ å› å­ï¼›<em>r</em>1å’Œ<em>r</em>2ä¸º[0 1]åŒºé—´å†…çš„éšæœºå°æ•°ï¼›<em>t</em>ä¸ºå½“å‰è¿­ä»£æ•°ã€‚PSOç®—æ³•é¦–å…ˆåˆå§‹åŒ–ä¸€ç¾¤éšæœºç²’å­ï¼Œå†é€šè¿‡ä¸Šå¼è¿›è¡Œè¿­ä»£å’Œè¿›åŒ–ï¼Œä»è€Œæ‰¾åˆ°æœ€ä¼˜è§£</p><p><strong>TODO</strong> è¿™ç¯‡æ–‡ç« æåˆ°çš„æ™ºèƒ½ç®—æ³•æ„Ÿè§‰ä¸æ˜¯å¾ˆæ»¡æ„ï¼Œæš‚æ—¶è·³è¿‡ï¼Œåç»­è°ƒç ”å¯»æ‰¾æ–°çš„ç®—æ³•è¡¥å……ä¸Šæ¥</p><h2 id="è½¨è¿¹ä¼˜åŒ–"><a href="#è½¨è¿¹ä¼˜åŒ–" class="headerlink" title="è½¨è¿¹ä¼˜åŒ–"></a>è½¨è¿¹ä¼˜åŒ–</h2><h3 id="Dubins"><a href="#Dubins" class="headerlink" title="Dubins"></a>Dubins</h3><p>ç›´çº¿ä¸åœ†å¼§ç»„åˆçš„æ›²çº¿ï¼Œç®€ä¾¿æ˜“è¡Œã€è®¡ç®—é‡å°ï¼›æ›²ç‡å˜åŒ–ä¸è¿ç»­ï¼Œåœ¨ç›´çº¿æ®µä¸åœ†å¼§æ®µçš„äº¤ç‚¹å¤„æ›²ç‡å‘ç”Ÿçªå˜</p><h3 id="Reeds-Shepp"><a href="#Reeds-Shepp" class="headerlink" title="Reeds-Shepp"></a>Reeds-Shepp</h3><p>é’ˆå¯¹å¯ä»¥å€’é€€çš„æ¨¡å‹å¯ä»¥è§„åˆ’å‡ºæ›´çŸ­çš„è·¯å¾„</p><h3 id="ä¸‰æ¬¡æ ·æ¡æ›²çº¿"><a href="#ä¸‰æ¬¡æ ·æ¡æ›²çº¿" class="headerlink" title="ä¸‰æ¬¡æ ·æ¡æ›²çº¿"></a>ä¸‰æ¬¡æ ·æ¡æ›²çº¿</h3><p>æŠŠåŒºé—´[a,b]åˆ†æˆnä¸ªåŒºé—´ï¼Œæ¯ä¸ªå°åŒºé—´çš„æ›²çº¿æ˜¯ä¸€ä¸ªä¸‰æ¬¡æ–¹ç¨‹ï¼Œè·¯å¾„è¿ç»­å¹³æ»‘ï¼Œé€‚åˆç”¨äºä¼˜åŒ–æŠ˜çº¿è·¯å¾„</p><h3 id="è´å¡å°”æ›²çº¿"><a href="#è´å¡å°”æ›²çº¿" class="headerlink" title="è´å¡å°”æ›²çº¿"></a>è´å¡å°”æ›²çº¿</h3><p>ç”±èµ·ç‚¹ï¼Œç»ˆç‚¹ï¼Œæ§åˆ¶ç‚¹ç»„æˆï¼Œè°ƒæ•´æ§åˆ¶ç‚¹ï¼Œè´å¡å°”æ›²çº¿çš„å½¢çŠ¶ä¼šå‘ç”Ÿå˜åŒ–ã€‚è®¡ç®—é€Ÿåº¦å’Œæ›²çº¿å½¢çŠ¶æ§åˆ¶æ–¹é¢ä¼˜äºä¸‰æ¬¡æ ·æ¡æ›²çº¿</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åªæ˜¯åˆæ­¥çš„è°ƒç ”ï¼Œç›®æ ‡æ˜¯å¯»æ‰¾ä¸€ä¸ªèƒ½å¤Ÿè€ƒè™‘åˆ°ç‰©ç†çº¦æŸï¼ˆæœ€å¤§è§’é€Ÿåº¦ï¼‰çš„ç®—æ³•ï¼Œæˆ–è€…å¯¹ç»™å‡ºçš„è·¯å¾„è¿›è¡Œè¾ƒå¥½çš„è½¨è¿¹ä¼˜åŒ–</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
          <category> æ°´é¢æ— äººé›†ç¾¤ä»¿çœŸç³»ç»Ÿçš„è®¾è®¡ä¸å®ç° </category>
          
          <category> è·¯å¾„è§„åˆ’ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è·¯å¾„è§„åˆ’ </tag>
            
            <tag> æ›²çº¿ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…’åº—ç®¡ç†ç³»ç»Ÿ-æ€»ç»“</title>
      <link href="/2023/09/13/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%80%BB%E7%BB%93/"/>
      <url>/2023/09/13/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h2><p>å‰ç«¯å¯ä»¥è¯´å®Œå…¨æ²¡åšï¼Œé™¤äº†flaskç”¨äº†ä¸€äº›åˆ«äººå†™å¥½çš„æ¨¡æ¿ï¼Œç”¨äº†ä¸€ä¸‹bootstrapå’ŒjQueryï¼Œå¯ä»¥è¯´æ˜¯å¾ˆç®€é™‹ã€‚å¦‚æœæœ‰æœºä¼šçš„è¯æƒ³å­¦ä¹ ä¸€ä¸‹Reactï¼Œä¹‹å‰æœ‰è¿‡Vueçš„å…¥é—¨ç»å†ï¼Œè¿˜æ˜¯æƒ³å¯¹è¿™äº›ä¸œè¥¿éƒ½æœ‰ä¸ªåˆæ­¥çš„è®¤è¯†ï¼ˆæœ€å¥½éƒ½èƒ½çœ‹æ‡‚ï¼‰ï¼Œä¸ºäº†åœ¨ä»¥åçš„å‰åç«¯æ²Ÿé€šä¸­æ›´åŠ æ–¹ä¾¿å§</p><h2 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>é€šè¿‡è¿™ä¸ªé¡¹ç›®è‡ªä¸»å­¦ä¹ å’Œå®è·µäº†ä¸€ä¸‹SpringCloudçš„åŸºæœ¬ç”¨æ³•ï¼ŒåŒ…æ‹¬Nacosï¼ŒEurekaï¼ŒGateWayï¼ŒFeignç­‰ã€‚ä¹Ÿåœ¨å®è·µä¸­ç†è§£äº†ä¸€äº›æ–°çš„æ¦‚å¿µï¼Œåƒæ˜¯è´Ÿè½½å‡è¡¡ï¼Œåå‘ä»£ç†ç­‰ã€‚</p><p>ç¾ä¸­ä¸è¶³çš„æ˜¯æ²¡æœ‰åšæœåŠ¡ç†”æ–­é™çº§è¿™ä¸€å—ï¼ŒåŸè®¡åˆ’æ˜¯å†å¯¹Sentinelè¿›è¡Œä¸€ä¸‹å­¦ä¹ ç„¶åä½¿ç”¨åˆ°è¿™ä¸ªé¡¹ç›®ä¸­çš„ï¼›åŒæ—¶MQå’ŒRedisä¹Ÿæ²¡æœ‰ç”¨åˆ°ï¼Œé™¤äº†ä½¿ç”¨JVMå¤„ç†å¹¶å‘ä»¥å¤–çš„å…¶ä»–æ–¹æ³•ä¹Ÿæ²¡æœ‰å°è¯•ï¼Œåƒç”¨Zookeeperçš„é”ï¼Œç”¨ä¹è§‚é”æ‚²è§‚é”è¿™äº›éƒ½æ²¡æœ‰å°è¯•ï¼Œæœ‰æœºä¼šå¸Œæœ›éƒ½èƒ½æŠŠè¿™äº›çŸ¥è¯†è¡¥ä¸Š</p><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>é€šè¿‡è¿™ä¸ªé¡¹ç›®ä¹Ÿæ˜¯æŠŠpythonå¼€å‘å®è·µäº†ä¸€ä¸‹ï¼Œä¹‹å‰åªåšè¿‡ç®€å•çš„çˆ¬è™«ï¼Œæˆ–è€…æ˜¯å°æ¨¡å‹çš„è®­ç»ƒï¼Œæ²¡æœ‰åšè¿‡Webåº”ç”¨è¿™æ–¹é¢çš„ã€‚Flaskæ¡†æ¶ç¡®å®å¾ˆæ–¹ä¾¿ï¼Œé…åˆjinja2å¯ä»¥å¾ˆå¿«é€Ÿçš„æ­å»ºä¸€äº›ç®€æ˜“çš„å¹³å°ï¼Œåœ¨å‰ç«¯ä¸­ç›´æ¥ä½¿ç”¨Pythonè¯­å¥ç¡®å®å¾ˆçˆ½ã€‚ä½†æ˜¯ç°åœ¨ä¸»æµè¿˜æ˜¯å‰åç«¯åˆ†ç¦»å§ï¼Œä¸“ä¸šçš„äººå¹²ä¸“ä¸šçš„äº‹ï¼Œå‰ç«¯è¿˜æ˜¯æŒæ¡çš„å¤ªå°‘äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é¡¹ç›® </category>
          
          <category> é…’åº—ç®¡ç†ç³»ç»Ÿ </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flask</title>
      <link href="/2023/09/13/Flask/"/>
      <url>/2023/09/13/Flask/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Flaskæ˜¯ä¸€ä¸ªè½»é‡çº§çš„webæ¡†æ¶ï¼Œæ”¯æŒå‰åç«¯æ•´åˆï¼Œå¹¶ä¸”å¯åœ¨å‰ç«¯ä¸­ç›´æ¥ä½¿ç”¨ç›¸å…³çš„pythonè¯­å¥ã€‚æ”¯æŒORMï¼ˆObject Relational Mappingï¼‰ï¼Œå¾ˆå¥½çš„ç»“åˆmvcæ¨¡å¼è¿›è¡Œå¼€å‘</p><h2 id="ä¾èµ–å®‰è£…"><a href="#ä¾èµ–å®‰è£…" class="headerlink" title="ä¾èµ–å®‰è£…"></a>ä¾èµ–å®‰è£…</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Flaskä¾èµ–</span></span><br><span class="line">pip install Flask</span><br><span class="line"><span class="comment"># ä¸æ•°æ®åº“äº¤äº’</span></span><br><span class="line">pip install flask<span class="literal">-sqlalchemy</span></span><br><span class="line"><span class="comment"># å°†å·²æœ‰æ•°æ®åº“å¯¼å…¥</span></span><br><span class="line">pip install sqlacodegen</span><br><span class="line"><span class="comment"># æ³¨å†Œå‘é€é‚®ä»¶</span></span><br><span class="line">pip install flask<span class="literal">-mail</span></span><br><span class="line"><span class="comment"># å‰ç«¯è¡¨å•éªŒè¯</span></span><br><span class="line">pip install wtforms</span><br></pre></td></tr></table></figure><h2 id="Jinja2"><a href="#Jinja2" class="headerlink" title="Jinja2"></a>Jinja2</h2><p>Jinja2æ˜¯ä¸€ä¸ªPythonæ¨¡æ¿å¼•æ“ï¼Œå®ƒæä¾›ä¸€ç§å°†æ•°æ®å’Œæ¨¡æ¿ç»“åˆåœ¨ä¸€èµ·ï¼Œä»¥ç”ŸæˆåŠ¨æ€æ–‡æœ¬çš„æ–¹æ³•ã€‚å®ƒèƒ½å¤Ÿç”Ÿæˆå…·æœ‰æ¸…æ™°è€Œç®€æ´çš„ç»“æ„ã€æ›´æ˜“è¯»å–çš„ç½‘é¡µä»£ç </p><p>å®ƒçš„å¸¸ç”¨ä½¿ç”¨æ–¹æ³•æœ‰ï¼špythonå˜é‡ã€è¯­å¥ç›´æ¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æˆ–æ‰§è¡Œ</p><p>ä½¿ç”¨{ { } }æ¥åŒ…å«ä¸€ä¸ªå˜é‡ï¼Œåœ¨render_templateä¸­é€šè¿‡é¢å¤–çš„å‚æ•°ä¼ é€’å˜é‡è‡³å®šä½çš„æ¨¡æ¿ä¸­ï¼Œåœ¨è¯¥æ¨¡æ¿ä¸­å¯ä»¥ä½¿ç”¨{ { var } }æ¥ä½¿ç”¨ä¼ é€’çš„å˜é‡</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template(<span class="string">&quot;admin.html&quot;</span>, hotels=hotels, facilities=facilities)</span><br></pre></td></tr></table></figure><p>åœ¨admin.htmlä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ¥ä½¿ç”¨hotelså˜é‡</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-10&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;question-ul&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: relative; left: 70px; top: 30px&quot;</span>&gt;</span></span><br><span class="line">                &#123;% for hotel in hotels %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hotel-main&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;question-title&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">                                &#123;&#123;hotel.name&#125;&#125;</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨{ % % }æ¥ä½¿ç”¨pythonè¯­å¥ï¼Œä¾‹å¦‚ä¸Šæ–¹çš„ä»£ç ä¸­æƒ³è¦ä½¿ç”¨pythonä¸­çš„forå¾ªç¯ï¼Œç›´æ¥ä½¿ç”¨{ % for hotel in hotels % }å³å¯</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œjinja2ä¸­å¯¹äºè¯­å¥çš„ä½¿ç”¨ï¼Œéƒ½éœ€è¦æœ‰é—­åˆã€‚ä¾‹å¦‚{ % if % }åˆ™éœ€è¦åœ¨ä»£ç å—ç»“æŸä¹‹åä»¥{ % endif % }ç»“å°¾ï¼›{ % for % }åˆ™éœ€è¦ä»¥{ % endfor% }ç»“å°¾</p><p>æ›´å¤šçš„ä½¿ç”¨æ–¹æ³•å°šæœªå­¦ä¹ ğŸ•ŠğŸ•ŠğŸ•Š</p><h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><p>é…ç½®æ–¹é¢ï¼Œå’ŒSpringBootå¾ˆç›¸ä¼¼ï¼Œæ”¯æŒç”¨ä¸€ä¸ªconfig.pyæ–‡ä»¶æ¥è¿›è¡Œæ•°æ®åº“ã€å‘é€é‚®ä»¶çš„smtpæœåŠ¡å™¨ä»¥åŠå¯†é’¥ç­‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SECRET_KEY = <span class="string">&quot;Geo0426_xxxUniversity_xxx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»æœº</span></span><br><span class="line">HOSTNAME = <span class="string">&quot;localhost&quot;</span></span><br><span class="line"><span class="comment"># ç«¯å£</span></span><br><span class="line">PORT = <span class="number">3307</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">USERNAME = <span class="string">&quot;root&quot;</span></span><br><span class="line"><span class="comment"># å¯†ç </span></span><br><span class="line">PASSWORD = <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“åç§°</span></span><br><span class="line">DATABASE = <span class="string">&quot;hms&quot;</span></span><br><span class="line"><span class="comment">#  uri</span></span><br><span class="line">DB_URI = <span class="string">f&quot;mysql+pymysql://<span class="subst">&#123;USERNAME&#125;</span>:<span class="subst">&#123;PASSWORD&#125;</span>@<span class="subst">&#123;HOSTNAME&#125;</span>:<span class="subst">&#123;PORT&#125;</span>/<span class="subst">&#123;DATABASE&#125;</span>?charset=utf8mb4&quot;</span></span><br><span class="line"></span><br><span class="line">SQLALCHEMY_DATABASE_URI = DB_URI</span><br><span class="line"></span><br><span class="line"><span class="comment">#  é‚®ç®±æœåŠ¡</span></span><br><span class="line">MAIL_SERVER = <span class="string">&quot;smtp.163.com&quot;</span></span><br><span class="line">MAIL_USE_SSL = <span class="literal">True</span></span><br><span class="line">MAIL_PORT = <span class="number">465</span></span><br><span class="line">MAIL_USERNAME = <span class="string">&quot;xxx@163.com&quot;</span></span><br><span class="line">MAIL_PASSWORD = <span class="string">&quot;xxx&quot;</span></span><br><span class="line">MAIL_DEFAULT_SENDER = <span class="string">&quot;xxx@163.com&quot;</span></span><br></pre></td></tr></table></figure><h2 id="app"><a href="#app" class="headerlink" title="app"></a>app</h2><p>Flaskçš„æ ¸å¿ƒï¼ˆæœ‰ç‚¹ç±»ä¼¼Vueçš„æ„Ÿè§‰ï¼‰ï¼Œç›¸å½“äºä¸€ä¸ªä¸»ç±»ï¼Œå°†ç›¸å…³çš„æ•°æ®åº“ã€æ§åˆ¶å™¨ï¼ˆè¿™é‡Œåº”è¯¥æ˜¯blueprintsï¼‰ã€é…ç½®è¿›è¡Œç®¡ç†ï¼Œæ­¤å¤–â€œé’©å­â€å‡½æ•°ï¼ˆè¯·æ±‚æ‹¦æˆªå™¨ï¼Œä¸Šä¸‹æ–‡å¤„ç†å™¨ï¼‰ä¹Ÿå®šä¹‰åœ¨å…¶ä¸­</p><h4 id="è¯·æ±‚æ‹¦æˆªå™¨"><a href="#è¯·æ±‚æ‹¦æˆªå™¨" class="headerlink" title="è¯·æ±‚æ‹¦æˆªå™¨"></a>è¯·æ±‚æ‹¦æˆªå™¨</h4><p>åœ¨æ¯ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œä¹‹å‰ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œçš„å‡½æ•°ã€‚è¿™é‡Œåœ¨è¯·æ±‚å‘èµ·ä¹‹å‰å…ˆå°†æµè§ˆå™¨ä¸­sessionçš„tokenå–å‡ºæ¥ï¼Œå¦‚æœå­˜åœ¨tokenä¿¡æ¯åˆ™è¡¨ç¤ºå®Œæˆäº†ç™»å½•ï¼Œå¯ä»¥ç»™å…¨å±€å˜é‡g.userè®¾ç½®ä¿¡æ¯ï¼›å¦åˆ™å°†å…¶è®¾ç½®ä¸ºç©ºè¡¨ç¤ºæ²¡æœ‰ç™»å½•</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_before_request</span>():</span><br><span class="line">    user_id = session.get(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user_id:</span><br><span class="line">        user = User.query.get(user_id)</span><br><span class="line">        <span class="built_in">setattr</span>(g, <span class="string">&quot;user&quot;</span>, user)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">setattr</span>(g, <span class="string">&quot;user&quot;</span>, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h4 id="ä¸Šä¸‹æ–‡å¤„ç†å™¨"><a href="#ä¸Šä¸‹æ–‡å¤„ç†å™¨" class="headerlink" title="ä¸Šä¸‹æ–‡å¤„ç†å™¨"></a>ä¸Šä¸‹æ–‡å¤„ç†å™¨</h4><p>ç”¨æ¥å¤„ç†ä¸€äº›æ‰€æœ‰é¡µé¢éƒ½éœ€è¦è¿›è¡Œæ¸²æŸ“çš„å˜é‡ï¼Œæ¯”å¦‚ç™»å½•ä¿¡æ¯ï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥å¾ˆå¥½é…åˆjinja2</p><p>ä¾‹å¦‚æˆ‘ä»¬å°†ç”¨æˆ·ç™»å½•åçš„ä¿¡æ¯ç”¨ä¸€ä¸ªuserå˜é‡å­˜å‚¨</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.context_processor</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_context_processor</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user&quot;</span>: g.user&#125;</span><br></pre></td></tr></table></figure><p>å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œæ¥ä¸‹é‡Œæ‰€æœ‰templateä¸­éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªé”®å€¼æ¥è·å–è¿™ä¸ªå¯¹è±¡g.user</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% if user %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span>&gt;</span>&#123;&#123; user.username &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;auth.logout&#x27;) &#125;&#125;&quot;</span>&gt;</span>é€€å‡ºç™»å½•<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, g</span><br><span class="line"><span class="keyword">from</span> ext <span class="keyword">import</span> db, mail</span><br><span class="line"><span class="keyword">from</span> blueprints.auth <span class="keyword">import</span> bp <span class="keyword">as</span> auth_bp</span><br><span class="line"><span class="keyword">from</span> blueprints.users <span class="keyword">import</span> bp <span class="keyword">as</span> user_bp</span><br><span class="line"><span class="keyword">from</span> blueprints.hotels <span class="keyword">import</span> bp <span class="keyword">as</span> hotel_bp</span><br><span class="line"><span class="keyword">from</span> blueprints.rooms <span class="keyword">import</span> bp <span class="keyword">as</span> room_bp</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment">#  é…ç½®</span></span><br><span class="line">app.config.from_object(config)</span><br><span class="line"><span class="comment">#  è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜</span></span><br><span class="line">db.init_app(app)</span><br><span class="line"><span class="comment">#  æ³¨å†Œè“å›¾</span></span><br><span class="line">app.register_blueprint(auth_bp)</span><br><span class="line">app.register_blueprint(user_bp)</span><br><span class="line">app.register_blueprint(hotel_bp)</span><br><span class="line">app.register_blueprint(room_bp)</span><br><span class="line">mail.init_app(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_before_request</span>():</span><br><span class="line">    user_id = session.get(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user_id:</span><br><span class="line">        user = User.query.get(user_id)</span><br><span class="line">        <span class="built_in">setattr</span>(g, <span class="string">&quot;user&quot;</span>, user)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">setattr</span>(g, <span class="string">&quot;user&quot;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#  ä¸Šä¸‹æ–‡å¤„ç†å™¨ï¼Œç”¨æ¥å¤„ç†ä¸€äº›æ‰€æœ‰ç•Œé¢éƒ½éœ€è¦ç”¨åˆ°çš„å˜é‡ï¼ˆå¯ä»¥ç”¨æ¥å¯¹ç™»å½•çŠ¶æ€åšä¸€ä¸ªä¿å­˜ï¼‰</span></span><br><span class="line"><span class="meta">@app.context_processor</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_context_processor</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user&quot;</span>: g.user&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="models"><a href="#models" class="headerlink" title="models"></a>models</h2><p>modelsæ˜¯Flaskä¸­ORMçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé€šè¿‡ç±»å®šä¹‰çš„æ–¹å¼ï¼Œä¸æ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œæ˜ å°„</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Facility</span>(db.Model):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;t_facility&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">255</span>, <span class="string">&#x27;utf8mb4_general_ci&#x27;</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    created_at = Column(DateTime, nullable=<span class="literal">False</span>)</span><br><span class="line">    updated_at = Column(DateTime, nullable=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>tablenameè®¾ç½®ä¸ºæ•°æ®åº“ä¸­å¯¹æ˜ çš„è¡¨æ ¼åç§°ï¼Œæ¥ç€é€šè¿‡flask_sqlalchemyä¸­çš„SQLAlchemyå¯ä»¥å°†models.pyä¸­å®šä¹‰å®Œæˆçš„ç±»ï¼Œä»¥è¡¨çš„å½¢å¼åœ¨æ•°æ®åº“ä¸­ç”Ÿæˆã€‚</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line"><span class="comment"># åœ¨å®Œæˆäº†db.init_app(app)å°†appä¸dbç»‘å®šåï¼Œæ‰§è¡Œcreate_all()ç”Ÿæˆæ•°æ®åº“è¡¨</span></span><br><span class="line">db.create_all()</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦å¯¹æ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œæ”¹åŠ¨ï¼ˆå¢åˆ å­—æ®µç­‰æ“ä½œï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹models.pyä¸­çš„æ¨¡å‹ï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ°æ•°æ®åº“ã€‚</p><p>éœ€è¦ç”¨åˆ°flask-migrate</p><p>å®‰è£…ä¾èµ–</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install flask<span class="literal">-migrate</span></span><br></pre></td></tr></table></figure><p>åœ¨app.pyä¸­å¼•å…¥Migrate</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">migrate = Migrate(app, db)</span><br></pre></td></tr></table></figure><p>å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼š</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  first step</span></span><br><span class="line">flask db init</span><br><span class="line"><span class="comment">#  second step</span></span><br><span class="line">flask db migrate</span><br><span class="line"><span class="comment">#  third step</span></span><br><span class="line">flask db upgrade</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œå®Œç¬¬ä¸€æ­¥å®Œæˆåˆå§‹åŒ–ä¹‹åï¼Œåç»­æ›´æ–°æ•°æ®åº“çš„è¡¨åªéœ€è¦æ‰§è¡Œåä¸¤æ­¥å³å¯ï¼Œå³flask db migrateå’Œflask db upgrade</p><p>åœ¨Flaskä¸­ä¸éœ€è¦ç¼–å†™sqlè¯­å¥ï¼Œå¯ä»¥é€šè¿‡db.sessionåªé€šè¿‡å¯¹ç±»è¿›è¡Œæ“ä½œæ¥å®ç°æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥</p><h3 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h3><p>å¤§è‡´æ­¥éª¤ä¸ºåˆ›å»ºä¸€ä¸ªå®ä½“ç±»çš„å¯¹è±¡å¯¹åº”æ•°æ®åº“ä¸­è¡¨çš„ä¸€è¡Œæ•°æ®ï¼›ä½¿ç”¨db.sessionæ·»åŠ å¹¶æäº¤</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  åˆ›å»ºRoomå¯¹è±¡</span></span><br><span class="line">room = Room(hotel_id=hotel_id, original_price=original_price, price=price, num=num, <span class="built_in">type</span>=room_type, created_at=now, updated_at=now)</span><br><span class="line"><span class="comment">#  å°†å…¶åœ¨ä¼šè¯ä¸­æ’å…¥</span></span><br><span class="line">db.session.add(room)</span><br><span class="line"><span class="comment">#  æäº¤</span></span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨class.query.get()</p><p>æ ¹æ®æ¡ä»¶æŸ¥è¯¢æ•°æ®é›†åˆï¼Œåˆ™éœ€è¦ç”¨åˆ°filterè¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªé›†åˆ</p><p>.all()å¯ä»¥è·å–å…¨éƒ¨çš„æ•°æ®; .first()èƒ½å¤Ÿè·å¾—ç¬¬ä¸€æ¡æ•°æ®</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  æ ¹æ®ä¸»é”®æŸ¥è¯¢ä¸€è¡Œæ•°æ®ï¼Œå¹¶æ˜ å°„åˆ°å®ä½“ç±»å¯¹è±¡</span></span><br><span class="line">room = Room.query.get(room_id)</span><br><span class="line"><span class="comment">#  æŒ‰ç…§ä¸€å®šçš„æ¡ä»¶æŸ¥è¯¢ï¼ˆä½¿ç”¨è¿‡æ»¤å™¨ï¼‰</span></span><br><span class="line">hotel_facilities = HotelFacility.query.filter_by(hotel_id=hotel.<span class="built_in">id</span>).<span class="built_in">all</span>()</span><br><span class="line"><span class="comment">#  è·å–é›†åˆä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³è¯¥æ¡ä»¶çš„æ•°æ®è¡Œ</span></span><br><span class="line">user = User.query.filter_by(email=email).first()</span><br></pre></td></tr></table></figure><h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><p>å…ˆåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°å¯¹åº”çš„æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼›ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼›ä½¿ç”¨db.sessionå®Œæˆcommit</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">room = Room.query.get(room_id)</span><br><span class="line">room.original_price = <span class="built_in">float</span>(form.original_price.data)</span><br><span class="line">room.price = <span class="built_in">float</span>(form.price.data)</span><br><span class="line">room.num = <span class="built_in">int</span>(form.num.data)</span><br><span class="line">room.room_type = form.room_type.data</span><br><span class="line">now = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">room.updated_at = now</span><br><span class="line"><span class="comment"># æ•°æ®åº“æ›´æ–°</span></span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure><h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><p>åˆ é™¤éœ€è¦å…ˆæŸ¥è¯¢åˆ°è¯¥æ¡è®°å½•ï¼Œç„¶åä½¿ç”¨ä¼šè¯è¿›è¡Œåˆ é™¤</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤è®¾æ–½è®°å½•  </span></span><br><span class="line">facility = Facility.query.get(<span class="number">1</span>)  </span><br><span class="line">db.session.delete(facility)  </span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure><h2 id="blueprints"><a href="#blueprints" class="headerlink" title="blueprints"></a>blueprints</h2><p>blueprintsï¼ˆè“å›¾ï¼‰èƒ½å¤Ÿé™ä½app.pyä¸­ä»£ç çš„å¤æ‚åº¦ï¼ŒåŒæ—¶å¯ä»¥å°†åŠŸèƒ½æ¨¡å—è¿›è¡Œæ‹†è§£ï¼Œä¾¿äºç»´æŠ¤ï¼Œç±»ä¼¼springä¸­çš„controller</p><p>åªéœ€è¦åœ¨app.pyä¸­æ³¨å†Œè¯¥è“å›¾ï¼Œç„¶ååœ¨è“å›¾ä¸­ç¼–å†™è¯·æ±‚urlå¯¹åº”çš„å‰ç¼€ï¼Œè·¯ç”±ä»¥åŠè¯·æ±‚æ–¹æ³•ç­‰å³å¯</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, request, g, redirect, render_template, url_for</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> Hotel</span><br><span class="line"><span class="keyword">from</span> ext <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> .form <span class="keyword">import</span> HotelForm</span><br><span class="line"></span><br><span class="line">bp = Blueprint(<span class="string">&quot;hotels&quot;</span>, __name__, url_prefix=<span class="string">&quot;/hotels&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ é…’åº—</span></span><br><span class="line"><span class="meta">@bp.route(<span class="params"><span class="string">&quot;/addHotel&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_hotel</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;add_hotel.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = HotelForm(request.form)</span><br><span class="line">        <span class="keyword">if</span> form.validate():</span><br><span class="line">            name = form.name.data</span><br><span class="line">            address = form.address.data</span><br><span class="line">            introduction = form.introduction.data</span><br><span class="line">            phone = form.phone.data</span><br><span class="line">            stars = form.stars.data</span><br><span class="line">            brand = form.brand.data</span><br><span class="line">            business_district = form.business_district.data</span><br><span class="line">            now = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">            hotel = Hotel(name=name, address=address, introduction=introduction, phone=phone, stars=stars, brand=brand, business_district=business_district, created_at=now, updated_at=now)</span><br><span class="line">            db.session.add(hotel)</span><br><span class="line">            db.session.commit()</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;auth.index&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(form.errors)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æ·»åŠ é…’åº—å¤±è´¥ï¼Œæ£€æŸ¥å¡«å†™ä¿¡æ¯æ˜¯å¦æ­£ç¡®&quot;</span></span><br></pre></td></tr></table></figure><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¸Œæœ›æœ‰æœºä¼šè¿˜èƒ½ç”¨åˆ°FlaskğŸ˜‚ğŸ˜‚ğŸ˜‚</p><hr><p>2024.3.13æ›´æ–°</p><h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><p>Flaské€šè¿‡app.run(threaded&#x3D;True)å¼€å¯çš„å¤šçº¿ç¨‹å¤„ç†ï¼Œå¹¶ä¸æ˜¯æŒ‡åŒä¸€è·¯ç”±å¼€å¯å¤šä¸ªçº¿ç¨‹å¤„ç†ï¼Œè€Œæ˜¯ä¸åŒè·¯ç”±ä½¿ç”¨å¤šä¸ªçº¿ç¨‹å¤„ç†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(threaded=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œthreadedä¸ºTrue ï¼ŒåŒæ—¶è®¿é—® &#x2F;t1 å’Œ &#x2F;t2 è·¯ç”± ï¼Œ5ç§’å&#x2F;t1 å’Œ &#x2F;t2 ä¸€èµ·è¿”å›ç»“æœ<br>threadedä¸ºFalse ï¼ŒåŒæ—¶è®¿é—® &#x2F;t1 å’Œ &#x2F;t2 è·¯ç”± ï¼Œ5ç§’å&#x2F;t1è¿”å›ç»“æœï¼Œ10ç§’å&#x2F;t2è¿”å›ç»“æœ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/t1&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t1</span>():</span><br><span class="line">   sleep(<span class="number">5</span>)</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&#x27;Hello World t1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/t2&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t2</span>():</span><br><span class="line">   sleep(<span class="number">5</span>)</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&#x27;Hello World t2&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flask </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…’åº—ç®¡ç†ç³»ç»Ÿ-è®¢å•æ¨¡å—</title>
      <link href="/2023/09/09/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97/"/>
      <url>/2023/09/09/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹å•"><a href="#ä¸‹å•" class="headerlink" title="ä¸‹å•"></a>ä¸‹å•</h2><p>ä¸‹å•åŠŸèƒ½çš„è®¾è®¡å’Œä»£ç ç¼–å†™è¿‡ç¨‹ä¸­éƒ½é­é‡ä¸å°‘å›°éš¾ã€‚</p><h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><p>é¦–å…ˆæ˜¯å¯¹äºåº“å­˜è¿›è¡ŒåŠ é”æ¥é¿å…å¤šçº¿ç¨‹ä¸‹å‡ºç°åº“å­˜è´Ÿæ•°çš„æƒ…å†µï¼Œåœ¨è®¾è®¡æ–¹é¢ç›®å‰è€ƒè™‘åˆ°å•æœåŠ¡å™¨éƒ¨ç½²ä¸‹ä½¿ç”¨jvmçš„synchronizedæ¥è§£å†³ã€‚</p><p>å…¶æ¬¡æ˜¯å¼‚æ­¥æ–¹é¢çš„è®¾è®¡ï¼Œè¦æ±‚æ˜¯â€œå°†è€—æ—¶çš„æ“ä½œæ”¾åˆ°åå°ï¼Œè€Œç•Œé¢å¯ä»¥æ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼Œå¹¶ä¸”å“åº”ç­‰çš„ä¸è€çƒ¦çš„ç”¨æˆ·çš„å–æ¶ˆæ“ä½œã€‚â€</p><p>å‰ç«¯è®¾è®¡åº”è¯¥éœ€è¦ç”¨åˆ°å¼‚æ­¥å’Œå›è°ƒï¼Œåœ¨å“åº”åˆ°è¾¾ä¹‹å‰è¿›å…¥ä¸€ä¸ªæ­£åœ¨ä¸‹å•çš„ç•Œé¢ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©å–æ¶ˆï¼Œå“åº”åˆ°è¾¾åˆ™å…³é—­è¿™ä¸ªç•Œé¢ã€‚é’ˆå¯¹æ­¤ï¼Œåç«¯éœ€è¦è®¾è®¡çš„åªæ˜¯å–æ¶ˆè¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘åœ¨æ•°æ®åº“è®¾è®¡æ–¹é¢å¯¹è®¢å•çŠ¶æ€å¢åŠ äº†ä¸€ä¸ªä¸‹å•ä¸­çš„çŠ¶æ€OrderStatus.CREATINGï¼Œè®¢å•åœ¨æ’å…¥æ•°æ®åº“æ—¶é»˜è®¤æ˜¯è¿™ä¸ªçŠ¶æ€ã€‚åœ¨ç”¨æˆ·å‘é€å–æ¶ˆçš„è¯·æ±‚åï¼Œå–æ¶ˆæœåŠ¡çš„å®ç°æ–¹é¢ï¼Œæˆ‘é¦–å…ˆä¼šå¯¹è®¢å•çš„çŠ¶æ€è¿›è¡ŒæŸ¥è¯¢ï¼Œå› ä¸ºå¹¶ä¸ç¡®è®¤æ­¤æ—¶çš„ä¸‹å•ä¸šåŠ¡æ˜¯å¦å®Œæˆï¼Œè®¢å•çŠ¶æ€å¯èƒ½å¤„äºä¸‹å•ä¸­ï¼Œä¸‹å•å¤±è´¥ï¼Œå¾…æ”¯ä»˜ä¸‰ç§çŠ¶æ€ã€‚å¦‚æœå¤„äºä¸‹å•ä¸­çš„çŠ¶æ€ï¼Œå°†å…¶ä¿®æ”¹ä¸ºå–æ¶ˆçŠ¶æ€ï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºä»£è¡¨ç€ä¸‹å•æœåŠ¡ä¸­çš„æ£€æŸ¥åº“å­˜ã€ä¿®æ”¹è®¢å•çŠ¶æ€è¿˜æ²¡æœ‰å‘ç”Ÿï¼Œå³ä½¿å°†å…¶è®¾ç½®ä¸ºå–æ¶ˆçŠ¶æ€ï¼Œåç»­ä¹Ÿä¼šè¢«è¦†ç›–ã€‚</p><p>å› æ­¤æˆ‘è®¤ä¸ºæ¯”è¾ƒåˆç†çš„è®¾è®¡æ˜¯å¤šæ¬¡è¯¢é—®è®¢å•çŠ¶æ€ï¼Œç›´è‡³å˜åŒ–ä¸ºä¸‹å•å¤±è´¥æˆ–å¾…æ”¯ä»˜ï¼Œå¦‚æœå¤šæ¬¡è¯¢é—®ä»ä¸ºä¸‹å•ä¸­ï¼Œåˆ™æŠ›å‡ºå–æ¶ˆå¤±è´¥çš„å¼‚å¸¸è¿”å›ç»™å‰ç«¯ã€‚</p><h3 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h3><p>åœ¨Feignçš„ä½¿ç”¨ä¸Šï¼Œä¹‹å‰å­¦ä¹ å¹¶æ²¡æœ‰å­¦åˆ°å‚æ•°ä¼ é€’æ–¹é¢çš„çŸ¥è¯†ç‚¹ï¼Œç°åœ¨å·²ç»å¼„æ¸…æ¥šäº†ã€‚ç»“åˆä¸Šä¸€ç¯‡é…’åº—æ¨¡å—ä¸­çš„è¿›è¡Œä¸€ä¸ªæ•´ç†</p><h4 id="è·¯å¾„ä¸­çš„å‚æ•°"><a href="#è·¯å¾„ä¸­çš„å‚æ•°" class="headerlink" title="è·¯å¾„ä¸­çš„å‚æ•°"></a>è·¯å¾„ä¸­çš„å‚æ•°</h4><p>å½“è¯·æ±‚è·¯å¾„ä¸­ä»£æœ‰å‚æ•°ï¼Œå¹¶ä¸”æƒ³è¦å°†å…¶æå–å‡ºæ¥ï¼Œéœ€è¦ä½¿ç”¨@PathVariableæ³¨è§£ï¼ŒåŒæ—¶å‚æ•°åå’Œç±»å‹ä¸Controllerä¸­ä¿æŒä¸€è‡´</p><p>FeignClient</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rooms/&#123;id&#125;&quot;)</span></span><br><span class="line">Room <span class="title function_">findRoomById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>;</span><br></pre></td></tr></table></figure><p>Controller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Room <span class="title function_">findRoomById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> roomService.findRoomById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•ä¸­çš„å‚æ•°"><a href="#æ–¹æ³•ä¸­çš„å‚æ•°" class="headerlink" title="æ–¹æ³•ä¸­çš„å‚æ•°"></a>æ–¹æ³•ä¸­çš„å‚æ•°</h4><p>å½“æ¥å£æ–¹æ³•ä¸­æœ‰å‚æ•°æ—¶ï¼Œä½¿ç”¨@RequestParamæ³¨è§£ï¼ŒåŒæ—¶å‚æ•°åå’Œç±»å‹ä¸Controllerä¸­ä¿æŒä¸€è‡´ï¼ŒControllerä¸­ä¸éœ€è¦@RequestParamæ³¨è§£</p><p>FeignClient</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rooms/roomsOfHotel&quot;)</span></span><br><span class="line">ArrayList&lt;Room&gt; <span class="title function_">roomsOfHotel</span><span class="params">(<span class="meta">@RequestParam(&quot;hotelId&quot;)</span> Integer hotelId)</span>;</span><br></pre></td></tr></table></figure><p>Controller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;roomsOfHotel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ArrayList&lt;Room&gt; <span class="title function_">roomsOfHotel</span><span class="params">(Integer hotelId)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> roomService.findRoomByHotel(hotelId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•ä¸­è‡ªå®šä¹‰ç±»"><a href="#æ–¹æ³•ä¸­è‡ªå®šä¹‰ç±»" class="headerlink" title="æ–¹æ³•ä¸­è‡ªå®šä¹‰ç±»"></a>æ–¹æ³•ä¸­è‡ªå®šä¹‰ç±»</h4><p>å½“æ¥å£æ–¹æ³•ä¸­æƒ³è¦ä¼ é€’å¯åºåˆ—åŒ–ç±»æ—¶ï¼Œä½¿ç”¨@RequestBodyæ³¨è§£ï¼ŒåŒæ—¶å‚æ•°åå’Œç±»å‹ä¸Controllerä¸­ä¿æŒä¸€è‡´ï¼ŒControllerä¸­<strong>éœ€è¦@RequestBodyæ³¨è§£</strong>ï¼Œå¾ˆé‡è¦ï¼Œä¸€å®šè¦åŠ </p><p>FeignClient</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rooms/updateRoom&quot;)</span></span><br><span class="line">JsonResult <span class="title function_">updateRoom</span><span class="params">(<span class="meta">@RequestBody</span> Room room)</span>;</span><br></pre></td></tr></table></figure><p>Controller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;updateRoom&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult <span class="title function_">updateRoom</span><span class="params">(<span class="meta">@RequestBody</span> Room room)</span> &#123;</span><br><span class="line">  roomService.updateRoom(room);</span><br><span class="line">  <span class="type">JsonResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>(OK);</span><br><span class="line">  result.setMessage(<span class="string">&quot;æ›´æ–°æˆ¿é—´ä¿¡æ¯æˆåŠŸ&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><h4 id="OrderService"><a href="#OrderService" class="headerlink" title="OrderService"></a>OrderService</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">  <span class="type">LocalDate</span> <span class="variable">start</span> <span class="operator">=</span> order.getCheckInDate();</span><br><span class="line">  <span class="type">LocalDate</span> <span class="variable">end</span> <span class="operator">=</span> order.getCheckOutDate();</span><br><span class="line">  <span class="type">long</span> <span class="variable">days</span> <span class="operator">=</span> ChronoUnit.DAYS.between(start, end);</span><br><span class="line">  <span class="comment">//  å¯¹é¢„å®šæ—¥æœŸåˆç†æ€§åšæ£€æŸ¥</span></span><br><span class="line">  <span class="keyword">if</span>(days &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderDateException</span>(<span class="string">&quot;é¢„å®šæ—¥æœŸé”™è¯¯&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//  è®¡ç®—ä»·æ ¼</span></span><br><span class="line">  <span class="type">Room</span> <span class="variable">room</span> <span class="operator">=</span> roomClient.findRoomById(order.getRoomId());</span><br><span class="line">  <span class="type">Integer</span> <span class="variable">roomNum</span> <span class="operator">=</span> order.getRoomNum();</span><br><span class="line">  <span class="type">Double</span> <span class="variable">price</span> <span class="operator">=</span> roomNum * days * room.getPrice();</span><br><span class="line">  order.setPrice(price);</span><br><span class="line">  <span class="comment">//  å°†è®¢å•çŠ¶æ€è®¾ç½®ä¸ºä¸‹å•ä¸­å¹¶æ’å…¥æ•°æ®åº“</span></span><br><span class="line">  <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  order.setCreatedAt(date);</span><br><span class="line">  order.setUpdatedAt(date);</span><br><span class="line">  order.setStatus(OrderStatus.CREATING.ordinal());</span><br><span class="line">  <span class="comment">//  æ“ä½œæ•°æ®åº“</span></span><br><span class="line">  <span class="keyword">if</span>(orderMapper.insert(order) != <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddOrderException</span>(<span class="string">&quot;åˆ›å»ºè®¢å•å¤±è´¥&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  String result;</span><br><span class="line">  <span class="comment">//  å¯¹åº“å­˜è¿›è¡Œæ ¸éªŒï¼Œå¦‚æœåº“å­˜æ»¡è¶³åˆ™å¯ä»¥ä¸‹å•</span></span><br><span class="line">  <span class="keyword">if</span>(checkStorage(room.getId(), roomNum)) &#123;</span><br><span class="line">    <span class="comment">//  ä¸‹å•æˆåŠŸ</span></span><br><span class="line">    order.setStatus(OrderStatus.UNPAID.ordinal());</span><br><span class="line">    result = <span class="string">&quot;è®¢å•å¾…æ”¯ä»˜&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//  åº“å­˜ä¸æ»¡è¶³,è®¢å•çŠ¶æ€è®¾ç½®ä¸ºå¤±è´¥</span></span><br><span class="line">    order.setStatus(OrderStatus.FAIL.ordinal());</span><br><span class="line">    result = <span class="string">&quot;ä¸‹å•å¤±è´¥ï¼Œåº“å­˜ä¸è¶³&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//  å¯¹çŠ¶æ€è¿›è¡Œæ›´æ–°</span></span><br><span class="line">  <span class="keyword">if</span>(orderMapper.update(order) != <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateOrderException</span>(<span class="string">&quot;æ›´æ–°è®¢å•çŠ¶æ€å¤±è´¥&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">  <span class="comment">//  å¯¹è®¢å•çŠ¶æ€è¿›è¡Œæ£€æŸ¥</span></span><br><span class="line">  <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectById(id);</span><br><span class="line">  <span class="comment">//  ä»å¤„åœ¨ä¸‹å•ä¸­çš„æ— æ³•è¿›è¡Œå–æ¶ˆï¼Œå¿…é¡»ç­‰å¾…çŠ¶æ€å˜ä¸ºå¤±è´¥æˆ–æœªæ”¯ä»˜</span></span><br><span class="line">  <span class="keyword">while</span>(order.getStatus() == OrderStatus.CREATING.ordinal()) &#123;</span><br><span class="line">    order = orderMapper.selectById(id);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//  è·³å‡ºå¾ªç¯åˆ™è®¢å•çŠ¶æ€ç†è®ºä¸Šå˜ä¸ºå¤±è´¥å’Œæœªæ”¯ä»˜</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//  ä¸‹å•æˆåŠŸå¤„äºæœªæ”¯ä»˜çŠ¶æ€ï¼Œå–æ¶ˆè®¢å•éœ€è¦è¿˜åŸåº“å­˜</span></span><br><span class="line">  <span class="keyword">if</span>(order.getStatus() != OrderStatus.FAIL.ordinal()) &#123;</span><br><span class="line">    <span class="comment">//  ä¸æ˜¯å¤±è´¥ä¹Ÿä¸æ˜¯æœªæ”¯ä»˜ï¼ŒçŠ¶æ€é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span>(order.getStatus() != OrderStatus.UNPAID.ordinal()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderStatusException</span>(<span class="string">&quot;è®¢å•çŠ¶æ€é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//  æœªæ”¯ä»˜æˆ¿é—´åº“å­˜è¿˜åŸ(è¿™é‡Œåº”è¯¥ä½¿ç”¨äº‹åŠ¡)</span></span><br><span class="line">    <span class="type">Room</span> <span class="variable">room</span> <span class="operator">=</span> roomClient.findRoomById(order.getRoomId());</span><br><span class="line">    room.setNum(room.getNum() + order.getRoomNum());</span><br><span class="line">    roomClient.updateRoom(room);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//  ä¸‹å•å¤±è´¥æ— éœ€è¿˜åŸæˆ¿é—´åº“å­˜ï¼ŒçŠ¶æ€è®¾ç½®ä¸ºå–æ¶ˆä¸‹å•å³å¯</span></span><br><span class="line">  order.setStatus(OrderStatus.CANCEL.ordinal());</span><br><span class="line">  <span class="keyword">if</span>(orderMapper.update(order) != <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateOrderException</span>(<span class="string">&quot;å–æ¶ˆè®¢å•å¤±è´¥&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Boolean <span class="title function_">checkStorage</span><span class="params">(Integer roomId, Integer roomNum)</span> &#123;</span><br><span class="line">  <span class="comment">//  ç»å¯¹çš„ä½æ•ˆç‡</span></span><br><span class="line">  <span class="type">Room</span> <span class="variable">room</span> <span class="operator">=</span> roomClient.findRoomById(roomId);</span><br><span class="line">  <span class="keyword">if</span>(room.getNum() &gt;= roomNum) &#123;</span><br><span class="line">    room.setNum(room.getNum() - roomNum);</span><br><span class="line">    <span class="type">JsonResult</span> <span class="variable">result</span> <span class="operator">=</span> roomClient.updateRoom(room);</span><br><span class="line">    <span class="comment">//  åº“å­˜å……è¶³</span></span><br><span class="line">    <span class="keyword">return</span> result.getCode() == <span class="number">200</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//  åº“å­˜ä¸è¶³</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªèƒ½è¯´éƒ½èƒ½è¾¾åˆ°æƒ³è¦çš„æ•ˆæœï¼Œä½†æ˜¯æ•ˆç‡éƒ½ä¸å¤Ÿé«˜ï¼Œå¤šæ¬¡çš„è®¿é—®æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢å°±æ„å‘³ç€æ•ˆç‡çš„ä½ä¸‹ã€‚å¦å¤–å°±æ˜¯cancelä¸­è¯¢é—®è®¢å•çŠ¶æ€åº”è¯¥è®¾ç½®ä¸€å®šçš„é‡è¯•æ¬¡æ•°ï¼Œä½¿ç”¨whileå¾ªç¯æ˜¯æœ‰æ­»å¾ªç¯çš„é£é™©çš„ï¼ˆæˆ‘è¿™é‡Œå›¾çœäº‹äº†hhhï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é¡¹ç›® </category>
          
          <category> é…’åº—ç®¡ç†ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Feign </tag>
            
            <tag> SpringCloudGateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…’åº—ç®¡ç†ç³»ç»Ÿ-é…’åº—æ¨¡å—</title>
      <link href="/2023/09/06/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E9%85%92%E5%BA%97%E6%A8%A1%E5%9D%97/"/>
      <url>/2023/09/06/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E9%85%92%E5%BA%97%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h2><p>è¿™ä¸¤å¤©å‡ ä¹é‡åˆ°çš„æ‰€æœ‰éš¾é¢˜éƒ½å’ŒFeignæœ‰å…³ï¼Œå¯ä»¥è¯´è¢«Feignç‹ ç‹ æ‹·æ‰“äº†â€¦</p><h3 id="é”™è¯¯ä¸€"><a href="#é”™è¯¯ä¸€" class="headerlink" title="é”™è¯¯ä¸€"></a>é”™è¯¯ä¸€</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">feign.codec.DecodeException: Error <span class="keyword">while</span> extracting response <span class="keyword">for</span> <span class="built_in">type</span> [java.util.ArrayList&lt;com.magus.api.entity.Room&gt;] and content <span class="built_in">type</span> [application/json];</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤å¤©è§åˆ°çš„æœ€å¤šçš„å°±æ˜¯è¿™å¥è¯ï¼Œç„¶è€Œé€ æˆè¿™ä¸ªé”™è¯¯çš„åŸå› æ˜¯å¤šç§å¤šæ ·çš„ã€‚</p><p>æˆ‘ç¬¬ä¸€æ¬¡é­é‡è¿™ä¸ªé”™è¯¯æ˜¯è¿”å›å€¼ä¸åŒ¹é…é€ æˆçš„ï¼Œèµ·å› æ˜¯æˆ‘åœ¨ç½‘ä¸Šçœ‹åˆ°äº†å’Œæˆ‘åŒæ ·çš„æ“ä½œï¼Œåœ¨Controllerä¸­è¿”å›è‡ªå®šä¹‰çš„Jsonç±»ï¼Œä»–è¯´ä»–åœ¨ä¿®æ”¹ä¸ºJavaè‡ªå°è£…ç±»å‹Listä¹‹åå°±è§£å†³äº†ï¼ˆå…¶å®è‡ªå®šä¹‰ç±»å®Œå…¨æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯éœ€è¦åˆ›å»ºæ— å‚æ„é€ å‡½æ•°ï¼‰ã€‚å› æ­¤æˆ‘è¿›è¡Œäº†å°è¯•ï¼Œä»¥è‡³äºåé¢æ”¹çš„å¤ªä¹±äº†ï¼Œæœ‰çš„åœ°æ–¹æ˜¯JsonResultï¼Œæœ‰çš„åœ°æ–¹æ˜¯Userï¼Œä¸åŒ¹é…é€ æˆäº†è¿™ä¸ªé”™è¯¯ã€‚</p><p>ç„¶åè¿˜æœ‰ä¸€ä¸ªåŸå› åˆ™æ˜¯æˆ‘çš„Feignä¸­ç¼ºå°‘ä¸€ä¸ªé…ç½®</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.magus.base.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.ObjectProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.http.HttpMessageConverters;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * feignçš„httpå®¢æˆ·ç«¯é…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *No qualifying bean of type â€˜org.springframework.boot.autoconfigure.http.HttpMessage</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">  <span class="keyword">public</span> HttpMessageConverters <span class="title function_">messageConverters</span><span class="params">(ObjectProvider&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpMessageConverters</span>(converters.orderedStream().collect(Collectors.toList()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>HttpMessageConvertersåœ¨ä¸€äº›ç‰ˆæœ¬ä¸­æ— æ³•è¢«è£…é…ï¼Œå› æ­¤æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªFeignçš„é…ç½®ç±»å¯¹ä»–è¿›è¡Œ@Beanè£…é…</p><h3 id="é”™è¯¯äºŒ"><a href="#é”™è¯¯äºŒ" class="headerlink" title="é”™è¯¯äºŒ"></a>é”™è¯¯äºŒ</h3><p>è¿™ä¸ªé”™è¯¯åˆéš¾æ‰¾åˆé€†å¤©ï¼Œç½‘ä¸Šä¹Ÿæœç½—ä¸åˆ°ç›¸å…³çš„ä¿¡æ¯ï¼Œæˆ‘åªèƒ½ä¸€ç‚¹ç‚¹çš„æ¨æµ‹æ¥åˆ¤æ–­ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;roomProvider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoomClient</span> &#123;</span><br><span class="line">  <span class="comment">//  æ ¹æ®idè·å–room</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/rooms/&#123;id&#125;&quot;)</span></span><br><span class="line">  Room <span class="title function_">findRoomById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  è·å–æ‰€æœ‰room</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/rooms&quot;)</span></span><br><span class="line">  ArrayList&lt;Room&gt; <span class="title function_">findAllRooms</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  æ ¹æ®é…’åº—idè·å–room</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/rooms/roomsOfHotel&quot;)</span></span><br><span class="line">  ArrayList&lt;Room&gt; <span class="title function_">roomsOfHotel</span><span class="params">(<span class="meta">@RequestParam(&quot;hotelId&quot;)</span> Integer hotelId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœFeignClientä¸­å®šä¹‰çš„æ¥å£éœ€è¦å¸¦å‚æ•°çš„è¯ï¼Œè€Œä¸”å‚æ•°æœ¬èº«ä¸æ˜¯åœ¨urlä¸Šï¼Œé‚£ä¹ˆä¸€å®šè¦æ·»åŠ æ³¨è§£@RequestParamï¼Œä¸ç„¶æ˜¯æ— æ³•è¯†åˆ«åˆ°å¯¹åº”çš„controlleræ¥å£çš„</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;roomsOfHotel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ArrayList&lt;Room&gt; <span class="title function_">roomsOfHotel</span><span class="params">(Integer hotelId)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> roomService.findRoomByHotel(hotelId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘çš„controlleræ¥å£åç§°ï¼Œè¿”å›å€¼ï¼Œå‚æ•°åï¼Œä¸€åˆ‡éƒ½æ˜¯å»åˆçš„ï¼Œä½†æ˜¯ä¾ç„¶è¦åŠ @RequestParamæ³¨è§£ï¼Œä¸ç„¶æ”¶è·ä¸€å°æ—¶è°ƒè¯•hhh</p><h3 id="æŸ¥è¯¢é…’åº—è¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥è¯¢é…’åº—è¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢é…’åº—è¯¦ç»†ä¿¡æ¯"></a>æŸ¥è¯¢é…’åº—è¯¦ç»†ä¿¡æ¯</h3><p>è¿™ä¸ªå‡½æ•°çš„å®ç°å¾ˆå¥½çš„ä½¿ç”¨äº†Feignæ¥è·¨æœåŠ¡è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> HotelDetail <span class="title function_">getDetail</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">  <span class="type">Hotel</span> <span class="variable">hotel</span> <span class="operator">=</span> hotelMapper.selectById(id);</span><br><span class="line">  <span class="comment">//  é…’åº—id</span></span><br><span class="line">  <span class="type">Integer</span> <span class="variable">hotelId</span> <span class="operator">=</span> hotel.getId();</span><br><span class="line">  <span class="type">HotelDetail</span> <span class="variable">detail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDetail</span>(hotel);</span><br><span class="line">  <span class="comment">//  è®¾ç½®æˆ¿é—´åˆ—è¡¨</span></span><br><span class="line">  ArrayList&lt;Room&gt; rooms = roomClient.roomsOfHotel(hotelId);</span><br><span class="line">  detail.setRooms(rooms);</span><br><span class="line">  <span class="comment">//  è®¾ç½®è®¾æ–½åˆ—è¡¨</span></span><br><span class="line">  ArrayList&lt;Facility&gt; facilities = facilityClient.facilitiesOfHotel(hotelId);</span><br><span class="line">  detail.setFacilities(facilities);</span><br><span class="line">  <span class="keyword">return</span> detail;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾è®¡äº†ä¸€ä¸ªdtoæ¥å±•ç¤ºé…’åº—è¯¦ç»†ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelDetail</span> &#123;</span><br><span class="line">  <span class="comment">//  é…’åº—åœ°å€</span></span><br><span class="line">  <span class="keyword">private</span> String address;</span><br><span class="line">  <span class="comment">//  å“ç‰Œ</span></span><br><span class="line">  <span class="keyword">private</span> String brand;</span><br><span class="line">  <span class="comment">//  å•†åœˆ</span></span><br><span class="line">  <span class="keyword">private</span> String businessDistrict;</span><br><span class="line">  <span class="comment">//  é…’åº—id</span></span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="comment">//  é…’åº—ç®€ä»‹</span></span><br><span class="line">  <span class="keyword">private</span> String introduction;</span><br><span class="line">  <span class="comment">//  é…’åº—åç§°</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="comment">//  è”ç³»æ–¹å¼</span></span><br><span class="line">  <span class="keyword">private</span> String phone;</span><br><span class="line">  <span class="comment">//  æ˜Ÿçº§</span></span><br><span class="line">  <span class="keyword">private</span> Integer stars;</span><br><span class="line">  <span class="comment">//  è®¾æ–½</span></span><br><span class="line">  ArrayList&lt;Facility&gt; facilities;</span><br><span class="line">  <span class="comment">//  æˆ¿é—´åˆ—è¡¨</span></span><br><span class="line">  ArrayList&lt;Room&gt; rooms;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">HotelDetail</span><span class="params">(Hotel hotel)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.stars = hotel.getStars();</span><br><span class="line">    <span class="built_in">this</span>.phone = hotel.getPhone();</span><br><span class="line">    <span class="built_in">this</span>.name = hotel.getName();</span><br><span class="line">    <span class="built_in">this</span>.introduction = hotel.getIntroduction();</span><br><span class="line">    <span class="built_in">this</span>.id = hotel.getId();</span><br><span class="line">    <span class="built_in">this</span>.businessDistrict = hotel.getBusinessDistrict();</span><br><span class="line">    <span class="built_in">this</span>.brand = hotel.getBrand();</span><br><span class="line">    <span class="built_in">this</span>.address = hotel.getAddress();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é¡¹ç›® </category>
          
          <category> é…’åº—ç®¡ç†ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Feign </tag>
            
            <tag> SpringCloudGateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…’åº—ç®¡ç†ç³»ç»Ÿ-ç”¨æˆ·æ¨¡å—</title>
      <link href="/2023/09/05/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97/"/>
      <url>/2023/09/05/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="æƒé™è®¤è¯"><a href="#æƒé™è®¤è¯" class="headerlink" title="æƒé™è®¤è¯"></a>æƒé™è®¤è¯</h2><p>ä»¥å‰å†™é¡¹ç›®çš„æ—¶å€™æ ¹æœ¬æ²¡æœ‰æ€ä¹ˆè€ƒè™‘è¿‡æƒé™é—®é¢˜ï¼Œå¾ˆç®€å•çš„åšäº†ä¸€ä¸ªtokenéªŒè¯å°±ç»“æŸäº†ï¼Œç°åœ¨è‡ªå·±å¼€å§‹è€ƒè™‘åˆ°è¿™äº›é—®é¢˜å‘ç°è‡ªå·±æ ¹æœ¬æƒ³ä¸åˆ°ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>é¦–å…ˆæ‹…å¿ƒçš„æ˜¯åŒè§’è‰²ä¹‹é—´èµ„æºçš„ç›¸äº’è®¿é—®é—®é¢˜ï¼Œä¹Ÿè®¸å¯ä»¥é€šè¿‡éªŒè¯ç”¨æˆ·çš„è§’è‰²èº«ä»½æ¥è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœåŒè§’è‰²è¯•å›¾è®¿é—®å…¶ä»–ç”¨æˆ·çš„èµ„æºï¼Œä¸å¯¹tokenä¸­çš„ç”¨æˆ·idè¿›è¡Œè§£ææ˜¯æ²¡æ³•è§£å†³çš„ã€‚è¿™æ ·çš„è¯æˆ‘åœ¨Gatewayçš„å¾®æœåŠ¡ä¸­è¿˜éœ€è¦æ·»åŠ ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œæˆ‘ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¿…é¡»å¦‚æ­¤â€¦æˆ‘ä¸»è§‚ä¸Šæ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œç¡®å®æƒ³ä¸åˆ°æ›´ä¼˜é›…çš„åŠæ³•ï¼Œä½†æ˜¯æ„Ÿè§‰è¿™æ ·å­ä¼šå¾ˆç¬¨ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exchange åŒ…å«è¯·æ±‚å¤´ï¼Œè¯·æ±‚ä½“çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> chain è¿‡æ»¤å™¨é“¾ï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨å°†å…¶æ”¾è¡Œè‡³ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> Monoç±»å‹çš„ç»“æœï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨åªéœ€è¦è¿”å›chain.filter(exchange)å³å¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">    <span class="comment">//  è·å–è¯·æ±‚</span></span><br><span class="line">    <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">    <span class="comment">//  ä»è¯·æ±‚ä¸­è·å–è¯·æ±‚å¤´</span></span><br><span class="line">    <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> request.getHeaders();</span><br><span class="line">    <span class="comment">//  è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">requestPath</span> <span class="operator">=</span> request.getURI().getPath();</span><br><span class="line">    <span class="comment">//  åˆ¤æ–­æ˜¯å¦éœ€è¦æ ¸éªŒtoken</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//  éœ€è¦token</span></span><br><span class="line">    <span class="keyword">if</span>(tokenShouldCheck(requestPath)) &#123;</span><br><span class="line">      <span class="comment">//  ä¸åŒ…å«token</span></span><br><span class="line">      <span class="keyword">if</span>(!headers.containsKey(<span class="string">&quot;Authorization&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">//  èº«ä»½éªŒè¯å¤±è´¥ï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        <span class="comment">//  å‚æ•°æ˜¯HttpStatusç±»å‹çš„ï¼Œæœªç™»å½•çŠ¶æ€ç ä¸º401</span></span><br><span class="line">        response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  æ ¸éªŒtokenæ˜¯å¦æœ‰æ•ˆ,ä»¥åŠç”¨æˆ·æƒé™èƒ½å¦è·å–èµ„æº</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">      <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtils.getClaimsByToken(token);</span><br><span class="line">      <span class="comment">//  è¿‡æœŸ</span></span><br><span class="line">      <span class="keyword">if</span>(claims.getExpiration().getTime() &lt; <span class="keyword">new</span> <span class="title class_">Date</span>().getTime()) &#123;</span><br><span class="line">        <span class="comment">//  tokenè¿‡æœŸï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  æ²¡æœ‰è¿‡æœŸï¼Œå¯¹æƒé™è¿›è¡ŒéªŒè¯  </span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Boolean <span class="title function_">tokenShouldCheck</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !path.equals(<span class="string">&quot;/users/login&quot;</span>) &amp;&amp; !path.equals(<span class="string">&quot;/users/register&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´æ®µä»£ç æˆ‘åªèƒ½è¯´ï¼Œå’Œä¼˜é›…æ˜¯å®Œå…¨ä¸æ²¾è¾¹ï¼Œæ„Ÿè§‰è¿‡æ»¤å™¨åªå­¦åˆ°äº†çš®æ¯›â€¦</p><hr></hr><h3 id="2023-09-06"><a href="#2023-09-06" class="headerlink" title="2023&#x2F;09&#x2F;06"></a>2023&#x2F;09&#x2F;06</h3><p>åœ¨æ˜¨æ™šå†™ä¸‹åšå®¢ä¹‹ååˆè‡ªå·±æ£é¼“äº†å¥½ä¹…ï¼Œå‘ç°æˆ‘ç¡®å®å­¦çš„ä¸ç²¾â€¦</p><p>æˆ‘æœ€å¼€å§‹çš„æ€è·¯æ˜¯ç”¨feignæ¥è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘å±…ç„¶è®¤ä¸ºfeignçš„è¿œç¨‹è°ƒç”¨è¦ç»è¿‡httpï¼Œæ‰€ä»¥æˆ‘æ”¾å¼ƒäº†è¿™ä¸ªæƒ³æ³•ã€‚å¦‚æœçœŸæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£å¾®æœåŠ¡ä¸­ä½¿ç”¨feignè°ƒç”¨å…¶ä»–å¾®æœåŠ¡æ¥å®ç°åŠŸèƒ½éƒ½æ²¡æ³•æˆç«‹äº†ï¼Œæ¯•ç«Ÿä½ åœ¨å®ç°ä¸­å“ªæ¥çš„tokenï¼ˆå¦‚æœè¦åštokenéªŒè¯ï¼‰</p><p>äºæ˜¯ä½¿ç”¨feignè§£å†³äº†ï¼Œä½†æ˜¯ç¡®å®ä¸ç®—ä¼˜é›…</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  UserClient userClient;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exchange åŒ…å«è¯·æ±‚å¤´ï¼Œè¯·æ±‚ä½“çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> chain è¿‡æ»¤å™¨é“¾ï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨å°†å…¶æ”¾è¡Œè‡³ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> Monoç±»å‹çš„ç»“æœï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨åªéœ€è¦è¿”å›chain.filter(exchange)å³å¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">    <span class="comment">//  è·å–è¯·æ±‚</span></span><br><span class="line">    <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">    <span class="comment">//  ä»è¯·æ±‚ä¸­è·å–è¯·æ±‚å¤´</span></span><br><span class="line">    <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> request.getHeaders();</span><br><span class="line">    <span class="comment">//  ä»è¯·æ±‚ä¸­è·å–å‚æ•°</span></span><br><span class="line"><span class="comment">//    MultiValueMap&lt;String, String&gt; params = request.getQueryParams();</span></span><br><span class="line">    <span class="comment">//  è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">requestPath</span> <span class="operator">=</span> request.getURI().getPath();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  éœ€è¦token</span></span><br><span class="line">    <span class="keyword">if</span>(tokenShouldCheck(requestPath)) &#123;</span><br><span class="line">      <span class="comment">//  ä¸åŒ…å«token</span></span><br><span class="line">      <span class="keyword">if</span>(!headers.containsKey(<span class="string">&quot;Authorization&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">//  èº«ä»½éªŒè¯å¤±è´¥ï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        <span class="comment">//  å‚æ•°æ˜¯HttpStatusç±»å‹çš„ï¼Œæœªç™»å½•çŠ¶æ€ç ä¸º401</span></span><br><span class="line">        response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  æ ¸éªŒtokenæ˜¯å¦æœ‰æ•ˆ,ä»¥åŠç”¨æˆ·æƒé™èƒ½å¦è·å–èµ„æº</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">      <span class="comment">//  ç©ºtoken</span></span><br><span class="line">      <span class="keyword">if</span>(token == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//  èº«ä»½éªŒè¯å¤±è´¥ï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        <span class="comment">//  å‚æ•°æ˜¯HttpStatusç±»å‹çš„ï¼Œæœªç™»å½•çŠ¶æ€ç ä¸º401</span></span><br><span class="line">        response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtils.getClaimsByToken(token);</span><br><span class="line">      <span class="comment">//  è¿‡æœŸ</span></span><br><span class="line">      <span class="keyword">if</span>(claims.getExpiration().getTime() &lt; <span class="keyword">new</span> <span class="title class_">Date</span>().getTime()) &#123;</span><br><span class="line">        <span class="comment">//  tokenè¿‡æœŸï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//  æ²¡æœ‰è¿‡æœŸ</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> Integer.valueOf(claims.getSubject());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.findUserById(id);</span><br><span class="line">        <span class="comment">//  æƒé™ä¸è¶³</span></span><br><span class="line">        <span class="keyword">if</span>(!hasAuthority(user, requestPath)) &#123;</span><br><span class="line">          <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">          <span class="comment">//  403æƒé™ä¸è¶³</span></span><br><span class="line">          response.setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">          <span class="keyword">return</span> response.setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Boolean <span class="title function_">tokenShouldCheck</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !path.equals(<span class="string">&quot;/users/login&quot;</span>) &amp;&amp; !path.equals(<span class="string">&quot;/users/register&quot;</span>) &amp;&amp; !path.equals(<span class="string">&quot;/users/sendVerifyCode&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®å½“å‰urlä¸‹çš„èµ„æº</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> user ç”¨æˆ·</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> requestPath è¯·æ±‚è·¯å¾„</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> æ˜¯å¦æœ‰æƒé™</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> Boolean <span class="title function_">hasAuthority</span><span class="params">(User user, String requestPath)</span> &#123;</span><br><span class="line">    <span class="comment">//  åˆ¤æ–­ç®¡ç†å‘˜æƒé™</span></span><br><span class="line">    <span class="keyword">if</span>(requestPath.equals(<span class="string">&quot;/users&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> user.getIdentity() == Identity.Admin.ordinal();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//  å·²/users/ä¸ºå¼€å¤´</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (requestPath.startsWith(<span class="string">&quot;/users/&quot;</span>)) &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">paramId</span> <span class="operator">=</span> requestPath.split(<span class="string">&quot;/&quot;</span>)[<span class="number">2</span>];</span><br><span class="line">      <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> String.valueOf(user.getId());</span><br><span class="line">      <span class="comment">//  idæ­£ç¡®</span></span><br><span class="line">      <span class="keyword">if</span>(paramId.equals(id)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  idé”™è¯¯ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ç®¡ç†æƒé™</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getIdentity() == Identity.Admin.ordinal();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//  å…¶ä»–url</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>å…¶ä»–åŠŸèƒ½ä»¥å‰éƒ½å†™çƒ‚äº†ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„æ„Ÿè§‰ï¼Œä¸èƒ½å¾ˆå¥½çš„å®Œæˆæƒé™è®¤è¯æ˜¯æˆ‘è®¤ä¸ºè¿™é¡¹ç›®å¼€å±€çš„è´¥ç¬”ğŸ˜¡</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é¡¹ç›® </category>
          
          <category> é…’åº—ç®¡ç†ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Feign </tag>
            
            <tag> SpringCloudGateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…’åº—ç®¡ç†ç³»ç»Ÿ-è®¾è®¡è§„åˆ’</title>
      <link href="/2023/09/02/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E8%AE%BE%E8%AE%A1%E8%A7%84%E5%88%92/"/>
      <url>/2023/09/02/%E9%85%92%E5%BA%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E8%AE%BE%E8%AE%A1%E8%A7%84%E5%88%92/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>ç»è¿‡å¯¹SpringCloudçš„åŸºç¡€çŸ¥è¯†å­¦ä¹ åï¼Œå¸Œæœ›å°†å®ƒåº”ç”¨åˆ°é…’åº—ç®¡ç†ç³»ç»Ÿè¿™ä¸ªé¡¹ç›®ä¸­å»ã€‚æˆ‘çš„è§„åˆ’å¦‚ä¸‹ï¼š</p><ul><li>åœ¨åŠŸèƒ½éœ€æ±‚å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œåˆ†æå¹¶å°†ä¸šåŠ¡æ‹†è§£æˆå¤šä¸ªæ¨¡å—å®ç°å¾®æœåŠ¡æ¶æ„</li><li>è¿›è¡Œåˆæ­¥çš„å®ä½“ç±»è®¾è®¡ï¼Œæ•°æ®åº“è®¾è®¡</li><li>ä¼˜å…ˆä½¿ç”¨å·²æŒæ¡æŠ€èƒ½å®ŒæˆåŸºç¡€åŠŸèƒ½æ¨¡å—ï¼Œå¦‚å¤„ç†ç§’æ€åº“å­˜æš‚æ—¶ä¸è€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œç›®å‰è®¡åˆ’ä½¿ç”¨synchronizedè§£å†³</li></ul><p>å½“å‰é˜»åŠ›ï¼š</p><ul><li>å‰ç«¯è®¾è®¡</li><li>ç”¨æˆ·æƒé™æ§åˆ¶ç®¡ç†è¿™å—æ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ ï¼Œåªèƒ½åŸºç¡€çš„ä½¿ç”¨JWTè¿›è¡Œtokenè§£æ</li><li>Flaskæ¡†æ¶å¹¶æ²¡æœ‰å®é™…ä¸Šæ‰‹å†™è¿‡ï¼Œä¹Ÿå¹¶æ²¡æœ‰ä½¿ç”¨Pythonè¿›è¡Œè¿‡ä¸æ•°æ®åº“äº¤äº’çš„é¡¹ç›®å¼€å‘ï¼Œæ²¡æœ‰ç¼–å†™è¿‡è„šæœ¬</li><li>æ¶ˆæ¯ä¸­é—´ä»¶æ²¡æœ‰è¿‡å¤šå®é™…ç¼–ç ç»éªŒï¼Œå°šæ— æ³•ç¡®è®¤èƒ½å¦é¡ºåˆ©æŠ•å…¥åˆ°é¡¹ç›®ä½¿ç”¨ä¸­</li></ul><p>ç†æƒ³çŠ¶æ€ï¼š</p><ul><li><input checked="" disabled="" type="checkbox"> èƒ½å¤Ÿç†Ÿç»ƒçš„ä½¿ç”¨SpringCloudå¯¹é¡¹ç›®å„ä¸ªæœåŠ¡æ¨¡å—è¿›è¡Œå¼€å‘</li><li><input disabled="" type="checkbox"> å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶æ¥å®ç°å¯¹é«˜å¹¶å‘çš„æ”¯æŒï¼Œå¼•å…¥redisç¼“å­˜æ¥æé«˜ç§’æ€æ•ˆç‡</li><li><input disabled="" type="checkbox"> è¡¥å……SpringSecurityçŸ¥è¯†ï¼Œå¯¹æƒé™è®¤è¯è¿›è¡Œå®Œå–„</li></ul><h4 id="2023-09-13"><a href="#2023-09-13" class="headerlink" title="2023.09.13"></a>2023.09.13</h4><p>rediså’ŒSpringSecurityåœ¨åç»­å­¦ä¹ çš„æ—¶å€™å†ç”¨äºè¿™ä¸ªé¡¹ç›®</p><h2 id="æ¨¡å—è®¾è®¡"><a href="#æ¨¡å—è®¾è®¡" class="headerlink" title="æ¨¡å—è®¾è®¡"></a>æ¨¡å—è®¾è®¡</h2><p>ä»…é’ˆå¯¹Javaéƒ¨åˆ†çš„SpringCloudå¾®æœåŠ¡è®¾è®¡</p><ol><li>ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼šè´Ÿè´£å¤„ç†ç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•ã€åŸºæœ¬ä¿¡æ¯ç»´æŠ¤ç­‰åŠŸèƒ½ã€‚</li><li>é…’åº—ä¿¡æ¯ç®¡ç†æ¨¡å—ï¼šè´Ÿè´£å¤„ç†é…’åº—åˆ—è¡¨ã€åŸºæœ¬ä¿¡æ¯ã€ç»†èŠ‚ä¿¡æ¯çš„ç»´æŠ¤ç­‰åŠŸèƒ½ã€‚</li><li>è®¢å•ç®¡ç†æ¨¡å—ï¼šè´Ÿè´£å¤„ç†ç”¨æˆ·é¢„å®šçš„è®¢å•ï¼ŒåŒ…æ‹¬æµè§ˆè®¢å•ç­‰åŠŸèƒ½ã€‚</li><li>ç®¡ç†å‘˜å®¢æˆ·ç®¡ç†æ¨¡å—ï¼šè´Ÿè´£å¸®åŠ©å®¢æˆ·é‡ç½®å¯†ç ï¼Œç”Ÿæˆæ–°çš„éšæœºå¯†ç ï¼Œåˆ é™¤ç”¨æˆ·</li></ol><h2 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h2><p>é’ˆå¯¹é…’åº—ç®¡ç†ç³»ç»Ÿçš„ä¸šåŠ¡è¿›è¡Œæ•°æ®åº“è®¾è®¡å’Œç±»å›¾çš„è®¾è®¡</p><h3 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h3><h4 id="t-user"><a href="#t-user" class="headerlink" title="t_user"></a>t_user</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">ç”¨æˆ·id</td></tr><tr><td align="center">username</td><td align="center">varchar</td><td align="center">255</td><td align="center">ç”¨æˆ·å</td></tr><tr><td align="center">password</td><td align="center">varchar</td><td align="center">255</td><td align="center">å¯†ç </td></tr><tr><td align="center">salt</td><td align="center">varchar</td><td align="center">255</td><td align="center">ç›å€¼</td></tr><tr><td align="center">sex</td><td align="center">int</td><td align="center"></td><td align="center">æ€§åˆ«(å¥³0ï¼Œç”·1)</td></tr><tr><td align="center">type</td><td align="center">int</td><td align="center"></td><td align="center">ç±»å‹(0æœªæˆå¹´äººï¼Œ1æˆå¹´äºº)</td></tr><tr><td align="center">identity</td><td align="center">int</td><td align="center"></td><td align="center">èº«ä»½(0ä¸ºæ™®é€šç”¨æˆ·ï¼Œ1ä¸ºç”¨æˆ·ç®¡ç†å‘˜ï¼Œ2ä¸ºé…’åº—ç®¡ç†äººå‘˜ï¼Œ3ä¸ºé…’åº—ç®¡ç†å‘˜)</td></tr><tr><td align="center">idcn</td><td align="center">char</td><td align="center">18</td><td align="center">èº«ä»½è¯å·ç </td></tr><tr><td align="center">real_name</td><td align="center">varchar</td><td align="center">255</td><td align="center">çœŸå®å§“å</td></tr><tr><td align="center">phone</td><td align="center">varchar</td><td align="center">255</td><td align="center">ç”µè¯å·ç </td></tr><tr><td align="center">email</td><td align="center">varchar</td><td align="center">255</td><td align="center">é‚®ç®±</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-hotel"><a href="#t-hotel" class="headerlink" title="t_hotel"></a>t_hotel</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">ç”¨æˆ·id</td></tr><tr><td align="center">name</td><td align="center">varchar</td><td align="center">255</td><td align="center">é…’åº—åç§°</td></tr><tr><td align="center">address</td><td align="center">varchar</td><td align="center">255</td><td align="center">é…’åº—åœ°å€</td></tr><tr><td align="center">introduction</td><td align="center">varchar</td><td align="center">255</td><td align="center">é…’åº—ä»‹ç»</td></tr><tr><td align="center">phone</td><td align="center">varchar</td><td align="center"></td><td align="center">è”ç³»æ–¹å¼</td></tr><tr><td align="center">stars</td><td align="center">int</td><td align="center"></td><td align="center">æ˜Ÿçº§</td></tr><tr><td align="center">brand</td><td align="center">varchar</td><td align="center">255</td><td align="center">å“ç‰Œ</td></tr><tr><td align="center">business_district</td><td align="center">varchar</td><td align="center">255</td><td align="center">æ‰€å±å•†åœˆ</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-order"><a href="#t-order" class="headerlink" title="t_order"></a>t_order</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">è®¢å•id</td></tr><tr><td align="center">user_id</td><td align="center">int</td><td align="center">255</td><td align="center">ç”¨æˆ·id</td></tr><tr><td align="center">room_id</td><td align="center">int</td><td align="center">255</td><td align="center">æˆ¿é—´id</td></tr><tr><td align="center">check_in_date</td><td align="center">datetime</td><td align="center">255</td><td align="center">å…¥ä½æ—¥æœŸ</td></tr><tr><td align="center">check_out_date</td><td align="center">datetime</td><td align="center"></td><td align="center">é€€æˆ¿æ—¥æœŸ</td></tr><tr><td align="center">room_num</td><td align="center">int</td><td align="center"></td><td align="center">æˆ¿é—´æ•°é‡</td></tr><tr><td align="center">expected_guest_num</td><td align="center">int</td><td align="center"></td><td align="center">é¢„æœŸå…¥ä½äººæ•°</td></tr><tr><td align="center">has_children</td><td align="center">int</td><td align="center">18</td><td align="center">æ˜¯å¦æœ‰å„¿ç«¥ï¼ˆ0æ— 1æœ‰ï¼‰</td></tr><tr><td align="center">status</td><td align="center">int</td><td align="center">255</td><td align="center">è®¢å•çŠ¶æ€ï¼ˆ0æœªæ”¯ä»˜ï¼Œ1å·²æ”¯ä»˜ï¼Œ2å·²å–æ¶ˆï¼‰</td></tr><tr><td align="center">price</td><td align="center">decimal</td><td align="center">255</td><td align="center">è®¢å•ä»·æ ¼</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-room"><a href="#t-room" class="headerlink" title="t_room"></a>t_room</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">æˆ¿é—´id</td></tr><tr><td align="center">hotel_id</td><td align="center">int</td><td align="center"></td><td align="center">æ‰€å±é…’åº—id</td></tr><tr><td align="center">num</td><td align="center">int</td><td align="center"></td><td align="center">å‰©ä½™æ•°é‡</td></tr><tr><td align="center">type</td><td align="center">varchar</td><td align="center">255</td><td align="center">æˆ¿é—´ç±»å‹ï¼ˆ0å•äººé—´ï¼Œ1åŒåºŠæˆ¿ï¼Œ2å¤§åºŠæˆ¿ï¼‰</td></tr><tr><td align="center">original_price</td><td align="center">decimal</td><td align="center"></td><td align="center">åŸä»·</td></tr><tr><td align="center">price</td><td align="center">decimal</td><td align="center"></td><td align="center">å½“å‰ä»·æ ¼</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-facilities"><a href="#t-facilities" class="headerlink" title="t_facilities"></a>t_facilities</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center">è®¾æ–½id</td></tr><tr><td align="center">name</td><td align="center">varchar</td><td align="center">255</td><td align="center">è®¾æ–½åç§°</td></tr><tr><td align="center">is_free</td><td align="center">int</td><td align="center"></td><td align="center">æ˜¯å¦å…è´¹(0ä»˜è´¹ï¼Œ1å…è´¹)</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="t-hotel-facilities"><a href="#t-hotel-facilities" class="headerlink" title="t_hotel_facilities"></a>t_hotel_facilities</h4><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">æ³¨é‡Š</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">int</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">hotel_id</td><td align="center">int</td><td align="center"></td><td align="center">é…’åº—id</td></tr><tr><td align="center">facilities_id</td><td align="center">int</td><td align="center"></td><td align="center">è®¾æ–½id</td></tr><tr><td align="center">created_at</td><td align="center">datetime</td><td align="center"></td><td align="center">åˆ›å»ºæ—¶é—´</td></tr><tr><td align="center">updated_at</td><td align="center">datetime</td><td align="center"></td><td align="center">ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="2023-09-13-1"><a href="#2023-09-13-1" class="headerlink" title="2023.09.13"></a>2023.09.13</h4><p>t_facilitiesè®¾è®¡æœ‰é—®é¢˜ï¼Œis_freeå­—æ®µåº”è¯¥æ”¾åœ¨t_hotel_facilitiesä¸­è€Œä¸æ˜¯t_facilitiesä¸­ï¼›å…¶æ¬¡ä¸ºç”¨æˆ·å¢åŠ äº†ä¸€ä¸ªhotel_idçš„å­—æ®µï¼Œæä¾›ç»™é…’åº—ç®¡ç†äººå‘˜æ ‡è¯†å…¶ç®¡ç†çš„é…’åº—</p><h3 id="ç±»å›¾"><a href="#ç±»å›¾" class="headerlink" title="ç±»å›¾"></a>ç±»å›¾</h3><p>æœ‰æœºä¼šå†è¡¥å§ï¼Œå…ˆğŸ•Šäº†</p><h4 id="2023-09-13-2"><a href="#2023-09-13-2" class="headerlink" title="2023.09.13"></a>2023.09.13</h4><p>ä¸ä¼šå†è¡¥äº†ï¼Œå½»åº•ğŸ•Šäº†</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é¡¹ç›® </category>
          
          <category> é…’åº—ç®¡ç†ç³»ç»Ÿ </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UML </tag>
            
            <tag> æ•°æ®åº“è®¾è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-GateWay</title>
      <link href="/2023/09/02/SpringCloud-GateWay/"/>
      <url>/2023/09/02/SpringCloud-GateWay/</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘å…³åŠŸèƒ½"><a href="#ç½‘å…³åŠŸèƒ½" class="headerlink" title="ç½‘å…³åŠŸèƒ½"></a>ç½‘å…³åŠŸèƒ½</h2><ol><li>èº«ä»½è®¤è¯ï¼Œæƒé™è®¤è¯</li><li>æœåŠ¡è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡</li><li>è¯·æ±‚é™æµ</li></ol><h2 id="æ­å»ºç½‘å…³"><a href="#æ­å»ºç½‘å…³" class="headerlink" title="æ­å»ºç½‘å…³"></a>æ­å»ºç½‘å…³</h2><ol><li>æ·»åŠ ä¾èµ–ï¼ŒnacosæœåŠ¡å‘ç°ä»¥åŠç½‘å…³çš„ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ç½‘å…³ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–å†™è·¯ç”±é…ç½®ä»¥åŠnacosçš„åœ°å€</li></ol><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># è·¯ç”±çš„idï¼Œè‡ªå®šä¹‰ï¼Œå”¯ä¸€å³å¯</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡çš„æ„æ€ï¼Œåé¢è·Ÿç€æœåŠ¡çš„åç§°</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œè¯·æ±‚åŒ¹é…è§„åˆ™ï¼Œåªè¦ä»¥userå¼€å¤´çš„å°±åŒ¹é…</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¥ç€å‘ç½‘å…³æ‰€åœ¨ç«¯å£å‘é€è¯·æ±‚ä¿¡æ¯ï¼Œå¦‚<a href="http://localhost:10010/user/1%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0userService%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%BF%94%E5%9B%9E%E3%80%82">http://localhost:10010/user/1ï¼Œå°±å¯ä»¥å¾—åˆ°userServiceæœåŠ¡çš„è¿”å›ã€‚</a></p><p>æœåŠ¡æµç¨‹ï¼š</p><p><img src="https://s2.loli.net/2023/09/02/oTYa7EjHKGSqIVC.png" alt="image-20230902161302541"></p><h2 id="è·¯ç”±æ–­è¨€å·¥å‚"><a href="#è·¯ç”±æ–­è¨€å·¥å‚" class="headerlink" title="è·¯ç”±æ–­è¨€å·¥å‚"></a>è·¯ç”±æ–­è¨€å·¥å‚</h2><p>Springæä¾›äº†å¤šç§æ–­è¨€å·¥å‚ï¼Œé™¤äº†Pathç”¨æ¥é™åˆ¶è·¯å¾„ä»¥å¤–ï¼Œè¿˜å¯ä»¥é™åˆ¶ipï¼Œé™åˆ¶æ—¶é—´ç­‰</p><p><img src="https://s2.loli.net/2023/09/02/z782hbNTxtBpIZS.png" alt="image-20230902162312852"></p><p>è¯¦æƒ…å®ä¾‹è§SpringCloudGatewayæ–‡æ¡£<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">è·¯ç”±æ–­è¨€å·¥å‚</a></p><h2 id="è·¯ç”±è¿‡æ»¤å™¨"><a href="#è·¯ç”±è¿‡æ»¤å™¨" class="headerlink" title="è·¯ç”±è¿‡æ»¤å™¨"></a>è·¯ç”±è¿‡æ»¤å™¨</h2><h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>å¯¹è¯·æ±‚æˆ–è€…å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</p><h3 id="è¯·æ±‚æµç¨‹"><a href="#è¯·æ±‚æµç¨‹" class="headerlink" title="è¯·æ±‚æµç¨‹"></a>è¯·æ±‚æµç¨‹</h3><p>å®¢æˆ·ç«¯å‘ç½‘å…³å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚ç»è¿‡å¤šå±‚è¿‡æ»¤å™¨åˆ°è¾¾æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯çš„å“åº”ä¹Ÿä¼šç»è¿‡è¿‡æ»¤å™¨å†è¿”å›ç»™å®¢æˆ·ç«¯</p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>å‡å¦‚æƒ³è¦ç»™è¯·æ±‚å¤´æ·»åŠ ä¸€ä¸ªtoken</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># è·¯ç”±çš„idï¼Œè‡ªå®šä¹‰ï¼Œå”¯ä¸€å³å¯</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userService</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡çš„æ„æ€ï¼Œåé¢è·Ÿç€æœåŠ¡çš„åç§°</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œè¯·æ±‚åŒ¹é…è§„åˆ™ï¼Œåªè¦ä»¥userå¼€å¤´çš„å°±åŒ¹é…</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddRequestHeader=token,</span> <span class="string">xxx</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=token,</span> <span class="string">xxx</span> <span class="comment"># é»˜è®¤è¿‡æ»¤å™¨ï¼Œä¼šå¯¹æ‰€æœ‰è¯·æ±‚éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</span></span><br></pre></td></tr></table></figure><p>SpringCloudå®˜ç½‘æä¾›äº†31ç§è¿‡æ»¤å™¨ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒ<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories">è¿‡æ»¤å™¨å·¥å‚</a></p><h3 id="å…¨å±€è¿‡æ»¤å™¨"><a href="#å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="å…¨å±€è¿‡æ»¤å™¨"></a>å…¨å±€è¿‡æ»¤å™¨</h3><p>å®šä¹‰ä¸€ä¸ªç±»å¹¶ä¸”å®ç°GlobalFilteræ¥å£ï¼Œå¹¶ä¸”é‡å†™å‡½æ•°filter</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exchange åŒ…å«è¯·æ±‚å¤´ï¼Œè¯·æ±‚ä½“çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> chain è¿‡æ»¤å™¨é“¾ï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨å°†å…¶æ”¾è¡Œè‡³ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> Monoç±»å‹çš„ç»“æœï¼Œè‹¥é€šè¿‡è¿‡æ»¤å™¨åªéœ€è¦è¿”å›chain.filter(exchange)å³å¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">    <span class="comment">//  è·å–è¯·æ±‚</span></span><br><span class="line">    <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">    <span class="comment">//  ä»è¯·æ±‚ä¸­è·å–å‚æ•°</span></span><br><span class="line">    MultiValueMap&lt;String, String&gt; params = request.getQueryParams();</span><br><span class="line">    <span class="comment">//  è·å–å…·ä½“å‚æ•°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> params.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">    <span class="comment">//  åˆ¤æ–­èº«ä»½ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>.equals(authorization)) &#123;</span><br><span class="line">      <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//  èº«ä»½éªŒè¯å¤±è´¥ï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">    <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">    <span class="comment">//  å‚æ•°æ˜¯HttpStatusç±»å‹çš„ï¼Œæœªç™»å½•çŠ¶æ€ç ä¸º401</span></span><br><span class="line">    response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response.setComplete();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Order(-1)æ³¨è§£æ˜¯è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼ˆæˆ–è€…è¯´ä¼˜å…ˆçº§ï¼‰ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</p><p>@Componentæ³¨è§£å°†è¿‡æ»¤å™¨æ³¨å†Œä¸ºä¸€ä¸ªBean</p><p><strong>æ€»ç»“æ­¥éª¤ï¼š</strong></p><ol><li>å®ç°GlobalFilteræ¥å£</li><li>æ·»åŠ @Orderå’Œ@Componentæ³¨è§£è‡³ç±»</li><li>ç¼–å†™è¿‡æ»¤å¤„ç†é€»è¾‘</li></ol><h3 id="è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº"><a href="#è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº" class="headerlink" title="è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº"></a>è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº</h3><p>æ¯ä¸ªè¿‡æ»¤å™¨éƒ½æœ‰ä¸€ä¸ªorderå€¼ï¼Œæ ¹æ®orderå€¼è¿›è¡Œæ’åº</p><p>GlobalFilteræ˜¯ç”±æˆ‘ä»¬è‡ªå®šä¹‰orderçš„å€¼çš„</p><p>è·¯ç”±è¿‡æ»¤å™¨ä¸é»˜è®¤è¿‡æ»¤å™¨çš„orderå€¼ç”±springå†³å®šï¼Œspringé»˜è®¤æŒ‰ç…§å£°æ˜é¡ºåºä»1å¼€å§‹é€’å¢</p><p>å½“orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§é»˜è®¤è¿‡æ»¤å™¨&gt;è·¯ç”±è¿‡æ»¤å™¨&gt;å…¨å±€è¿‡æ»¤å™¨çš„é¡ºåºæ‰§è¡Œ</p><h2 id="è·¨åŸŸå¤„ç†"><a href="#è·¨åŸŸå¤„ç†" class="headerlink" title="è·¨åŸŸå¤„ç†"></a>è·¨åŸŸå¤„ç†</h2><p>åªéœ€è¦é€šè¿‡springçš„é…ç½®å°±å¯ä»¥å¯¹ç½‘å…³çš„è·¨åŸŸè¿›è¡Œå¤„ç†</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line">  <span class="attr">globalcors:</span></span><br><span class="line">    <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span></span><br><span class="line"><span class="attr">corsConfigurations:</span></span><br><span class="line">  <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">    <span class="attr">allowedOrigins:</span> <span class="comment"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ï¼Œspring boot2.4ä»¥å‰çš„é…ç½®</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;http://localhost&quot;</span></span><br><span class="line"><span class="comment"># allowedOriginPatterns: &quot;*&quot; # spring boot2.4ä»¥åçš„é…ç½®  </span></span><br><span class="line"><span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment">#  æ˜¯å¦å…è®¸å¸¦cookie</span></span><br><span class="line"><span class="attr">allowedMethods:</span> <span class="comment"># è·¨åŸŸæ–¹æ³•è®¾ç½®</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GET</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">OPTIONS</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">PUT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DELETE</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">POST</span></span><br><span class="line"><span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># å…è®¸æºå¸¦çš„è¯·æ±‚å¤´ä¿¡æ¯</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">36000</span> <span class="comment"># è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ,å•ä½s</span></span><br></pre></td></tr></table></figure><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><p>æ¥SpringCloud-Feignçš„é¢˜å¤–è¯ï¼Œæœç„¶æœ‰æ—¶å€™æ— æ³•ç†è§£æŸä¸ªçŸ¥è¯†çš„æ—¶å€™ï¼Œä¸å¦¨ç»§ç»­å­¦ä¸‹å»çœ‹çœ‹ï¼Œåç»§æ‹‰åŠ¨å‰é©±äº†å±äºæ˜¯</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> GateWay </tag>
            
            <tag> æƒé™è®¤è¯ </tag>
            
            <tag> æœåŠ¡è·¯ç”± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Feign</title>
      <link href="/2023/09/02/SpringCloud-Feign/"/>
      <url>/2023/09/02/SpringCloud-Feign/</url>
      
        <content type="html"><![CDATA[<h2 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h2><p>ç”±äºå¾®æœåŠ¡æ¶æ„ï¼Œæ— æ³•ç›´æ¥è¯·æ±‚å…¶ä»–æœåŠ¡çš„serviceï¼Œéœ€è¦è¿œç¨‹è°ƒç”¨ï¼Œå› æ­¤ä¼šç”¨åˆ°RestTemplateæ¥åšè¿œç¨‹è°ƒç”¨ã€‚åŒæ—¶æˆ‘ä»¬ä½¿ç”¨Ribbonç»“åˆRestTemplateæ¥å®ç°ä½¿ç”¨æœåŠ¡åç§°ä»£æ›¿ipå’Œç«¯å£ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚Feignåˆ™æ˜¯ä¸€ç§æ›´åŠ ä¼˜é›…çš„æ–¹å¼ï¼Œä¸ä¼šéœ€è¦åƒRestTemplateä¸€æ ·å‡ºç°url</p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>é¦–å…ˆæ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åä¸»å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š@EnableFeignClientsæ³¨è§£ï¼Œå°±åƒ@EnableEurekaServeræ³¨è§£ä¸€æ ·</p><p>åœ¨Serviceæ¥å£ä¸Šæ·»åŠ @FeignClientæ³¨è§£ï¼Œå¹¶ä¸”æŒ‡å®šæœåŠ¡çš„åç§°ï¼ˆæ³¨å†Œåˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„åç§°ï¼‰ï¼Œå› æ­¤è¿™é‡Œå°±å¯ä»¥å®ç°è·¨æœåŠ¡è°ƒç”¨ï¼Œåªéœ€è¦å®ç°æ³¨å†Œå…¶ä»–æœåŠ¡çš„åç§°çš„æ¥å£ã€‚ä½¿ç”¨èµ·æ¥çš„æ•´ä½“æ„Ÿè§‰åƒcontroller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Feigné…ç½®"><a href="#Feigné…ç½®" class="headerlink" title="Feigné…ç½®"></a>Feigné…ç½®</h2><p><strong>æ–¹å¼ä¸€ï¼š</strong>é€šè¿‡ä¿®æ”¹ymlæ–‡ä»¶å¯¹feignè¿›è¡Œé…ç½®</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  OrderService</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼äºŒï¼š</strong>é€šè¿‡é…ç½®ç±»å’Œæ³¨è§£</p><p>åˆ›å»ºä¸€ä¸ªconfigurationç±»ï¼Œé…ç½®Logger.Levelè¿™ä¸ªBeanï¼ŒåŠ åœ¨æŒ‡å®šæœåŠ¡çš„@FeignClient(value &#x3D; â€œuserserviceâ€)æ³¨è§£ä¸­ï¼Œæˆ–è€…åŠ åœ¨å¯åŠ¨ç±»çš„@EnableFeignClients( defaultConfiguration &#x3D; xxxconfiguration.class )æ³¨è§£ä¸­ã€‚</p><h2 id="Feignæ€§èƒ½ä¼˜åŒ–"><a href="#Feignæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="Feignæ€§èƒ½ä¼˜åŒ–"></a>Feignæ€§èƒ½ä¼˜åŒ–</h2><p>Feignåº•å±‚é»˜è®¤ä½¿ç”¨çš„URLConnectionï¼Œä¸æ”¯æŒè¿æ¥æ± ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨Apache HttpClientæ¥æ”¯æŒè¿æ¥æ± ï¼ˆå‡å°‘è¿æ¥çš„åˆ›å»ºä¸é‡Šæ”¾ï¼‰</p><h3 id="ä½¿ç”¨æ–¹æ³•-1"><a href="#ä½¿ç”¨æ–¹æ³•-1" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>æ·»åŠ HttpClientä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®è¿æ¥æ± </p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ”¯æŒHttpClientçš„å¼€å…³</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment"># æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment"># å•ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span></span><br></pre></td></tr></table></figure><h2 id="Feign-Api"><a href="#Feign-Api" class="headerlink" title="Feign-Api"></a>Feign-Api</h2><p>controllerå’ŒFeignClientçš„é‡åˆåº¦è¾ƒé«˜ï¼Œå¯ä»¥é€šè¿‡é‡‡ç”¨å®šä¹‰æ¥å£ï¼Œè®©äºŒè€…éƒ½å»ç»§æ‰¿è¿™ä¸ªæ¥å£ï¼Œåˆ©ç”¨è¿™ç§æ–¹å¼æä¾›ä¾¿æ·ã€‚</p><p>å­˜åœ¨çš„é—®é¢˜ï¼šç´§è€¦åˆ</p><p>æˆ‘æ›´åå‘çš„æ–¹æ³•æ˜¯å°†FeignClientã€POJOã€Feignçš„é»˜è®¤é…ç½®å°è£…åˆ°ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œé€šè¿‡å¼•å…¥æ¨¡å—æ¥ä¾›å…¶ä»–æ¶ˆè´¹è€…ä½¿ç”¨ã€‚è¿™æ ·åšä¹Ÿå¯ä»¥é¿å…æ¯ä¸ªæœåŠ¡éƒ½è¦å»å®ç°ä¸€æ ·çš„FeignClientï¼Œåˆ›å»ºå®ä½“ç±»ç­‰ã€‚</p><p>å­˜åœ¨çš„é—®é¢˜ï¼šæœ‰çš„æœåŠ¡å¯èƒ½ä»…ä»…éœ€è¦éƒ¨åˆ†å®ä½“ç±»å’ŒåŠŸèƒ½ï¼Œæœ‰æ‰€å†—ä½™</p><h3 id="ä½¿ç”¨æ–¹æ³•-2"><a href="#ä½¿ç”¨æ–¹æ³•-2" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>åœ¨å…¶ä»–æœåŠ¡çš„pomæ–‡ä»¶ä¸­å¼•å…¥è¯¥feign-apiçš„ä¾èµ–ï¼Œè¿™æ ·å°±å¯ä»¥å¼•å…¥æœ¬æ¨¡å—ä¸­æœªåˆ›å»ºçš„å®ä½“ç±»ï¼Œå®ç°å¤ç”¨</p><p>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šå¯¹FeignClientçš„è‡ªåŠ¨è£…é…ï¼Œ@Autowiredåªèƒ½è£…é…é¡¹ç›®æ‰€åœ¨åŒ…ç›®å½•ä¸‹çš„Beanï¼Œå› æ­¤éœ€è¦åœ¨@EnableFeignClientsæ³¨è§£ä¸Šæ·»åŠ clientså‚æ•°ã€‚</p><p>@EnableFeignClients( clients &#x3D; {UserClient.class, OrderClent.class}, defaultConfiguration &#x3D; xxxconfiguration.class ) clientså‚æ•°å¯ä»¥æ˜¯æ•°ç»„</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æµç¨‹æ¢³ç†ï¼š</p><ol><li>æœåŠ¡æ¨¡å—ä¸éœ€è¦å®ç°FeignClientæ¥å®ç°è·¨æœåŠ¡ï¼Œä¸éœ€è¦åˆ›å»ºå…¶ä»–çš„å®ä½“</li><li>é€šè¿‡åˆ›å»ºfeign-apiæ¥å¯¹æœåŠ¡è¿›è¡Œå°è£…ï¼Œä¸ºå…¶ä»–æœåŠ¡çš„è·¨æœåŠ¡è°ƒç”¨æä¾›æ¥å£ï¼ŒåŒæ—¶å‡å°‘äº†å®ä½“ç±»é‡å¤å†™çš„æƒ…å†µ</li></ol><p>å¼€å‘æµç¨‹ï¼š</p><p>providerçš„æœåŠ¡ç›¸å…³å†…å®¹æŒ‰ç…§springbootä¸€æ ·ç…§å¸¸å†™ï¼Œç„¶ååœ¨provider-apiä¸­æä¾›å¯¹æœåŠ¡controllerçš„è®¿é—®ï¼Œå…¶ä»–æœåŠ¡éœ€è¦è·¨æœåŠ¡è°ƒç”¨æ—¶é€šè¿‡provider-apiæ¥ä»å…¶å®ƒæœåŠ¡çš„controllerä¸­è·å–</p><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><p>æ˜¨æ™šä¸€ç›´åœ¨æ€è€ƒå‰ç«¯åˆ°åº•æ˜¯å¦‚ä½•è°ƒç”¨æœ‰å¤šä¸ªå®ä¾‹çš„åç«¯æœåŠ¡ï¼Œä¸ºæ­¤å»äº†è§£äº†ä¸€ä¸‹nginxçš„è´Ÿè½½å‡è¡¡å’Œåå‘ä»£ç†ã€‚</p><p>æˆ‘çš„çº ç»“ç‚¹åœ¨äºï¼Œæˆ‘ç›®å‰å­¦åˆ°çš„springcloudå†…éƒ¨çš„è´Ÿè½½å‡è¡¡éƒ½æ˜¯æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡å…¶ä»–æœåŠ¡çš„åç§°å‘æ³¨å†Œä¸­å¿ƒè¿›è¡Œè¯·æ±‚ï¼Œç„¶åå†æ ¹æ®è¿”å›çš„æœåŠ¡å®ä¾‹åˆ—è¡¨è´Ÿè½½å‡è¡¡ã€‚é‚£å¦‚æœè¿™ä¸ªæœåŠ¡æœ¬èº«æˆ‘ä»å‰ç«¯å‘ä»–å‘èµ·è¯·æ±‚ï¼Œåˆåº”è¯¥æ€ä¹ˆåšæ‰èƒ½ä¸è®¿é—®å›ºå®šçš„ç«¯å£å·å‘¢ï¼Ÿ</p><p>æœ€åˆæƒ³åˆ°çš„æ–¹æ³•æ˜¯å°†å¯¹è¿™å°ä¸»æœºçš„httpè¯·æ±‚ï¼Œå…¨éƒ¨å‘nacoså¯»æ‰¾æœåŠ¡åç§°çš„è¿™ç§æ–¹å¼ï¼Œå½“ç„¶åªæ˜¯æˆ‘çš„çŒœæƒ³ã€‚ä»Šå¤©æŸ¥èµ„æ–™ï¼Œè²Œä¼¼æ˜¯é€šè¿‡å‘ç½‘å…³å‘å‡ºè¯·æ±‚ï¼Œå†ç”±ç½‘å…³è¿›è¡Œè·¯ç”±åˆ°å…·ä½“æœåŠ¡ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œä»è®¾è®¡çš„è§’åº¦æ„Ÿè§‰éå¸¸åˆç†ï¼Œå‰ç«¯çš„è¯·æ±‚å¯ä»¥é€šè¿‡nginxçš„è´Ÿè½½å‡è¡¡å‘ä¸åŒç½‘å…³å®ä¾‹å‘é€ï¼Œç½‘å…³åˆå¯ä»¥æ ¹æ®urlçš„è·¯å¾„å‘å…·ä½“çš„æœåŠ¡è¯·æ±‚ï¼ŒæœåŠ¡åˆ™åˆè¢«æ³¨å†Œåˆ°äº†nacosï¼Œè‹¥å­˜åœ¨å¤šä¸ªå®ä¾‹ä¹Ÿä¼šåœ¨openfeignä¸­å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>è«åå…¶å¦™å°±ä¸²è”èµ·æ¥äº†ï¼Œå­¦å®Œç½‘å…³å†çœ‹çœ‹</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Feign </tag>
            
            <tag> RestTemplate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Nacos</title>
      <link href="/2023/09/01/SpringCloud-Nacos/"/>
      <url>/2023/09/01/SpringCloud-Nacos/</url>
      
        <content type="html"><![CDATA[<h2 id="NacosæœåŠ¡æ³¨å†Œ"><a href="#NacosæœåŠ¡æ³¨å†Œ" class="headerlink" title="NacosæœåŠ¡æ³¨å†Œ"></a>NacosæœåŠ¡æ³¨å†Œ</h2><p>é¦–å…ˆçˆ¶æ¨¡å—çš„ä¾èµ–æ§åˆ¶å¤„éœ€è¦æ·»åŠ spring cloud alibaba</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringCloudAlibabaæœ‰å…³ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€åœ¨æœåŠ¡æ¨¡å—çš„pomä¸­æ·»åŠ spring-cloud-starter-alibaba-nacos-discoveryä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ›´æ”¹é…ç½®ï¼Œnacosæ˜¯åœ¨springcloudé…ç½®ä¸­çš„</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼šEnableDiscoveryClientæ³¨è§£ç°åœ¨æ˜¯å¯é€‰é¡¹äº†ï¼Œåªè¦ä¾èµ–äº†ä»¥spring-cloud-starter-netflixä¸ºå‰ç¼€çš„åº“(ä¾‹å¦‚spring-cloud-starter-netflix-eureka-client)ï¼Œå°±å¯ç”¨äº†<strong>æœåŠ¡æ³¨å†Œå‘ç°</strong>åŠŸèƒ½ï¼›</p><h2 id="æœåŠ¡åˆ†å±‚æ¶æ„"><a href="#æœåŠ¡åˆ†å±‚æ¶æ„" class="headerlink" title="æœåŠ¡åˆ†å±‚æ¶æ„"></a>æœåŠ¡åˆ†å±‚æ¶æ„</h2><p>Nacosçš„æœåŠ¡æŒ‰ç…§æœåŠ¡-&gt;é›†ç¾¤-&gt;å®ä¾‹æ¥åˆ†å±‚ï¼Œä¼˜å…ˆè°ƒç”¨æœ¬åœ°é›†ç¾¤å†…çš„å®ä¾‹ï¼Œæœ¬åœ°é›†ç¾¤ä¸­å®ä¾‹ä¸å¯ç”¨å†è°ƒç”¨å…¶ä»–é›†ç¾¤çš„å®ä¾‹</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span> </span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HangZhou</span> <span class="comment"># é›†ç¾¤åç§°</span></span><br></pre></td></tr></table></figure><h2 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><p>å¦‚æœæƒ³è¦é…ç½®ä¼˜å…ˆè°ƒç”¨æœ¬åœ°é›†ç¾¤å†…çš„å®ä¾‹ï¼Œéœ€è¦ä¿®æ”¹nacosçš„é…ç½®ï¼Œä¾‹å¦‚è®¢å•æœåŠ¡æƒ³è¦ä¼˜å…ˆè°ƒç”¨æœ¬åœ°ç”¨æˆ·æœåŠ¡çš„å®ä¾‹ï¼Œéœ€è¦ä½¿ç”¨nacosçš„è´Ÿè½½å‡è¡¡ç­–ç•¥</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="comment"># è§„åˆ™ç±»çš„åç§°</span></span><br></pre></td></tr></table></figure><p>NacosRuleä¼˜å…ˆé€‰æ‹©æœ¬åœ°é›†ç¾¤ï¼Œé›†ç¾¤å†…éƒ¨éšæœºé€‰æ‹©ï¼›å½“æœ¬åœ°é›†ç¾¤å¥åº·æœåŠ¡æ•°ä¸º0æ—¶ï¼Œé€‰æ‹©è·¨é›†ç¾¤è®¿é—®å¹¶è­¦å‘Š</p><h3 id="æƒé‡é…ç½®"><a href="#æƒé‡é…ç½®" class="headerlink" title="æƒé‡é…ç½®"></a>æƒé‡é…ç½®</h3><p>æ§åˆ¶å°å¯ä»¥ä¿®æ”¹å®ä¾‹çš„æƒé‡ï¼Œæƒé‡è¶Šé«˜ï¼Œç”¨æˆ·è¯·æ±‚æ›´å¤šçš„å‘è¯¥å®ä¾‹è¿ç§»ã€‚åœ¨æœåŠ¡å‡çº§ä¸­ï¼Œå¯ä»¥é€šè¿‡å°†æƒé‡æ¯”ä¾‹è°ƒä¸º0ç„¶åè¿›è¡Œå‡çº§ï¼Œä¹‹åå†è°ƒæˆå°æƒé‡è¿›è¡Œä¸€æ®µæ—¶é—´æµ‹è¯•ï¼Œç¨³å®šåæ¢å¤æƒé‡</p><h2 id="NameSpace"><a href="#NameSpace" class="headerlink" title="NameSpace"></a>NameSpace</h2><p>ç¯å¢ƒéš”ç¦»ï¼Œå¯¹ç›¸ä¼¼çš„æœåŠ¡å¯ä»¥è¿›è¡Œåˆ†ç»„ï¼Œå¦‚æœä¸åŒç»„çš„æœåŠ¡ä¹Ÿæ— æ³•ç›¸äº’è®¿é—®ã€‚æ¯ä¸ªnamespaceæœ‰å”¯ä¸€çš„idï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹å®ƒçš„å€¼æ¥è®¾ç½®ç¯å¢ƒ</p><h2 id="Nacoså’ŒEurekaçš„åŒºåˆ«"><a href="#Nacoså’ŒEurekaçš„åŒºåˆ«" class="headerlink" title="Nacoså’ŒEurekaçš„åŒºåˆ«"></a>Nacoså’ŒEurekaçš„åŒºåˆ«</h2><h3 id="å¥åº·ç›‘æµ‹"><a href="#å¥åº·ç›‘æµ‹" class="headerlink" title="å¥åº·ç›‘æµ‹"></a>å¥åº·ç›‘æµ‹</h3><p>å¯¹äºæœåŠ¡æä¾›è€…çš„å¥åº·çŠ¶æ€ç›‘æµ‹ï¼Œnacoså°†æœåŠ¡å®ä¾‹åˆ†ä¸ºä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹</p><p>ä¸´æ—¶å®ä¾‹ï¼š</p><p>å’ŒEurekaä¸€æ ·ï¼Œä½¿ç”¨å¿ƒè·³æ£€æµ‹ï¼Œå¦‚æœä¸åœ¨æœåŠ¡å°±ä¼šä¸»åŠ¨å‰”é™¤ï¼ˆé»˜è®¤æƒ…å†µä¸‹å¦‚æœä¸é…ç½®ï¼Œå®ä¾‹éƒ½æ˜¯ä¸´æ—¶çš„ï¼‰</p><p>éä¸´æ—¶å®ä¾‹ï¼š</p><p>éä¸´æ—¶å®ä¾‹åˆ™ä¼šç”±nacosä¸»åŠ¨å‘èµ·è¯¢é—®æœåŠ¡å®ä¾‹çš„å¥åº·çŠ¶æ€ï¼Œå¹¶ä¸”ä¸ä¼šå°†ä¸å¥åº·çš„æœåŠ¡å®ä¾‹æ¸…æ¥šï¼Œä¼šç­‰å¾…æ¢å¤</p><p>åˆ›å»ºéä¸´æ—¶å®ä¾‹åªéœ€è¦ä¿®æ”¹discoveryçš„å€¼</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span> </span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HangZhou</span> <span class="comment"># é›†ç¾¤åç§°</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span> <span class="comment"># æ˜¯å¦ä¸ºä¸´æ—¶å®ä¾‹</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡åˆ—è¡¨"><a href="#æœåŠ¡åˆ—è¡¨" class="headerlink" title="æœåŠ¡åˆ—è¡¨"></a>æœåŠ¡åˆ—è¡¨</h3><p>Eurekaå’ŒNacoséƒ½ä¼šå®šæ—¶æ‹‰å–æœåŠ¡åˆ—è¡¨åŠ åˆ°ç¼“å­˜ä¸­ï¼Œæé«˜æ•ˆç‡ã€‚ä½†æ˜¯Nacosè¿˜é‡‡å–äº†æ¶ˆæ¯æ¨é€çš„å½¢å¼ï¼Œå½“æœåŠ¡å‘ç”Ÿå˜æ›´ï¼Œä¼šä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™æ¶ˆè´¹è€…</p><h2 id="é…ç½®ç®¡ç†"><a href="#é…ç½®ç®¡ç†" class="headerlink" title="é…ç½®ç®¡ç†"></a>é…ç½®ç®¡ç†</h2><h3 id="é…ç½®è®¾ç½®"><a href="#é…ç½®è®¾ç½®" class="headerlink" title="é…ç½®è®¾ç½®"></a>é…ç½®è®¾ç½®</h3><p>å‘½åè§„åˆ™æ˜¯ æœåŠ¡å-è¿è¡Œç¯å¢ƒ.yamlå¦‚userservice-dev.yaml</p><p>é…ç½®å†…å®¹åªè®¾ç½®æœ‰çƒ­æ›´æ–°éœ€æ±‚çš„é…ç½®é¡¹ï¼Œä¾‹å¦‚æ—¥æœŸæ ¼å¼ç­‰ï¼›åƒæ•°æ®åº“åœ°å€è¿™ç§å¯ä»¥ä¸æ”¾ä¸Šå»</p><h3 id="é…ç½®æ‹‰å–"><a href="#é…ç½®æ‹‰å–" class="headerlink" title="é…ç½®æ‹‰å–"></a>é…ç½®æ‹‰å–</h3><p>é…ç½®è¯»å–æ­¥éª¤ï¼š</p><p><img src="https://s2.loli.net/2023/09/01/iCF7szOZ6HVGjlS.png" alt="image-20230901202139446.png"></p><p>bootstap.ymlé…ç½®çš„ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œå¯ä»¥è¯»å–åˆ°nacosçš„åœ°å€ï¼Œå†è¯»å–nacosçš„é…ç½®æ–‡ä»¶ï¼Œæœ€åè¯»å–application.ymlçš„é…ç½®æ–‡ä»¶</p><p>é¦–å…ˆåœ¨<strong>å¾®æœåŠ¡</strong>å¼•å…¥nacos-configä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos configä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€åˆ›å»ºbootstrap.ymlæ–‡ä»¶ï¼Œå¼•å¯¼é…ç½®æ–‡ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºapplication.yml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-service</span> <span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># å¼€å‘ç¯å¢ƒ</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacosåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># æ–‡ä»¶åç¼€å</span></span><br></pre></td></tr></table></figure><p>ä¸‰è€…ç»“åˆå‘ç°å°±æ˜¯åœ¨æ§åˆ¶å°åˆ›å»ºçš„é…ç½®idå³userservice-dev.yaml</p><p>åŒæ—¶ï¼Œä¹‹å‰çš„application.ymlä¸­çš„é‡å¤é…ç½®å¯ä»¥åˆ é™¤äº†ï¼Œå¦‚æœåŠ¡åç§°å’Œnacosåœ°å€</p><p>æ³¨ï¼šnacosé…ç½®ç®¡ç†æ˜¯æŒ‰æœåŠ¡åˆ†çš„ï¼Œå› æ­¤å†™åœ¨<strong>å¾®æœåŠ¡</strong>æ¨¡å—ä¸­</p><h3 id="é…ç½®çƒ­æ›´æ–°"><a href="#é…ç½®çƒ­æ›´æ–°" class="headerlink" title="é…ç½®çƒ­æ›´æ–°"></a>é…ç½®çƒ­æ›´æ–°</h3><p>å‰ç½®çŸ¥è¯†ï¼š</p><p>ä½¿ç”¨@Value(â€œ${pattern.dateformat}â€)æ³¨è§£å¯ä»¥è·å–é…ç½®é¡¹ï¼ˆæ”¹æˆNacosValueï¼‰</p><p>@ConfigurationProperties(prefix &#x3D; â€œxxxâ€) çº¦å®šå¤§äºé…ç½®ï¼Œåªè¦prefixå‰ç¼€xxxä¸å˜é‡åè¿›è¡Œæ‹¼æ¥ä¸é…ç½®ä¸€è‡´ï¼Œå°±å¯ä»¥æ³¨å…¥</p><p>æ–¹æ³•ä¸€ï¼šåœ¨Valueæ³¨è§£æ‰€åœ¨ç±»ä¸ŠåŠ ä¸€ä¸ªæ³¨è§£@RefreshScopeï¼Œå¯ä»¥å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯æœåŠ¡</p><p>æ–¹æ³•äºŒï¼šä½¿ç”¨@ConfigurationProperties(prefix &#x3D; â€œxxxâ€)æ³¨è§£</p><h2 id="å°æ’æ›²"><a href="#å°æ’æ›²" class="headerlink" title="å°æ’æ›²"></a>å°æ’æ›²</h2><p>æµªè´¹äº†è¿‘ä¸€ä¸ªå°æ—¶æ—¶é—´åœ¨å¤„ç†ä¾èµ–å’Œé…ç½®çš„é—®é¢˜ä¸Šã€‚è¿™é‡Œå±äºæ˜¯å¯¹dependencymanagementä¸ç†Ÿæ‚‰äº†ã€‚</p><p>ä½¿ç”¨dependencyManagementå¯ä»¥ç»Ÿä¸€ç®¡ç†é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œç¡®ä¿åº”ç”¨çš„å„ä¸ªé¡¹ç›®çš„ä¾èµ–å’Œç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ç”¨æ¯ä¸ªæ¨¡å—é¡¹ç›®éƒ½å¼„ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œä¸åˆ©äºç®¡ç†ï¼Œå½“éœ€è¦å˜æ›´ç‰ˆæœ¬å·çš„æ—¶å€™åªéœ€è¦åœ¨çˆ¶ç±»å®¹å™¨é‡Œæ›´æ–°ï¼Œä¸éœ€è¦ä»»ä½•ä¸€ä¸ªå­é¡¹ç›®çš„ä¿®æ”¹ï¼›å¦‚æœæŸä¸ªå­é¡¹ç›®éœ€è¦å¦å¤–ä¸€ä¸ªç‰¹æ®Šçš„ç‰ˆæœ¬å·æ—¶ï¼Œåªéœ€è¦åœ¨è‡ªå·±çš„æ¨¡å—dependenciesä¸­å£°æ˜ä¸€ä¸ªç‰ˆæœ¬å·å³å¯ã€‚å­ç±»å°±ä¼šä½¿ç”¨å­ç±»å£°æ˜çš„ç‰ˆæœ¬å·ï¼Œä¸ç»§æ‰¿äºçˆ¶ç±»ç‰ˆæœ¬å·ã€‚</p><p>è¯¯è§£ï¼šä»¥ä¸ºåœ¨çˆ¶æ¨¡å—ä¸­å®šä¹‰dependencyManagementä¹‹åï¼Œå­æ¨¡å—å°±å¯ä»¥ç»§æ‰¿ä¸‹æ¥ï¼Œä½†æ˜¯åœ¨mavenä¸­å‘ç°å­æ¨¡å—ä¸­å¹¶æ²¡æœ‰ç»§æ‰¿ä¸‹æ¥ä¾èµ–ã€‚å®é™…ä¸Šæ˜¯å­æ¨¡å—ä¸­ä¾ç„¶éœ€è¦æ·»åŠ ç›¸å…³ä¾èµ–ä½†æ˜¯ä¸ç”¨åŠ ç‰ˆæœ¬å·ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šæƒ³è¦å®ç°æˆ‘çš„éœ€æ±‚åªéœ€è¦å°†çˆ¶æ¨¡å—çš„ä¾èµ–æ ‡ç­¾dependencyManagementåˆ é™¤ï¼Œä»…ä½¿ç”¨dependencieså³å¯</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">&lt;!--nacos --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--mybatis --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--mysql --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--webèµ·æ­¥ä¾èµ–--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Nacos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Ribbon</title>
      <link href="/2023/08/30/SpringCloud-Ribbon/"/>
      <url>/2023/08/30/SpringCloud-Ribbon/</url>
      
        <content type="html"><![CDATA[<h2 id="Ribbonè´Ÿè½½å‡è¡¡æµç¨‹"><a href="#Ribbonè´Ÿè½½å‡è¡¡æµç¨‹" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡æµç¨‹"></a>Ribbonè´Ÿè½½å‡è¡¡æµç¨‹</h2><p>åƒè¿™æ ·çš„urlï¼š<a href="http://userservice/user/1">http://userservice/user/1</a> æ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡httpè®¿é—®çš„ï¼Œå› ä¸ºå®é™…ä¸Šä¸å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªç½‘ç«™ï¼Œå› æ­¤Ribbonèµ·åˆ°ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå¤„ç†çš„ä½œç”¨</p><ol><li><p>æ”¶åˆ°è¯·æ±‚åï¼Œå‘Eurekaæ‹‰å–æœåŠ¡</p></li><li><p>è¿”å›æœåŠ¡åˆ—è¡¨ï¼Œè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œè½®è¯¢è·å–å…·ä½“æœåŠ¡ç«¯å£</p></li></ol><p>å…·ä½“æ“ä½œéœ€è¦åœ¨xxx-serviceæ¨¡å—ä¸­çš„xxxServiceApplicationä¸­å°†RestTemplateæ³¨å…¥springå®¹å™¨</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ribbonåº•å±‚"><a href="#Ribbonåº•å±‚" class="headerlink" title="Ribbonåº•å±‚"></a>Ribbonåº•å±‚</h2><ol><li>LoadBalancerInterceptoræ‹¦æˆªhttpè¯·æ±‚ï¼Œå°†è¯·æ±‚è§£æå¾—åˆ°æœåŠ¡åç§°</li><li>å°†æœåŠ¡åç§°äº¤ç»™RibbonLoadBalancerClient</li><li>RibbonLoadBalancerClienté€šè¿‡DynamicServerListLoadBalancerå‘eurekaæ‹‰å–æœåŠ¡åˆ—è¡¨</li><li>DynamicServerListLoadBalanceré€šè¿‡è´Ÿè½½å‡è¡¡ç­–ç•¥IRuleä»æœåŠ¡åˆ—è¡¨ä¸­è¿›è¡Œé€‰æ‹©ï¼Œæäº¤ç»™RibbonLoadBalancerClient</li><li>RibbonLoadBalancerClientå¯¹urlè¿›è¡Œä¿®æ”¹ï¼Œå‘èµ·è¯·æ±‚</li></ol><h2 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><p><img src="https://s2.loli.net/2023/08/30/Vc82tw4vB5gkmPi.png" alt="image-20230830184232870.png"></p><h3 id="ä¿®æ”¹ç­–ç•¥"><a href="#ä¿®æ”¹ç­–ç•¥" class="headerlink" title="ä¿®æ”¹ç­–ç•¥"></a>ä¿®æ”¹ç­–ç•¥</h3><ol><li>é€šè¿‡åœ¨ç›¸å…³æœåŠ¡ä¸­å°†IRuleæ³¨å…¥springå®¹å™¨å®ç°å¯¹è´Ÿè½½å‡è¡¡ç­–ç•¥çš„ä¿®æ”¹ï¼Œä¾‹å¦‚xxx-serviceæ¨¡å—ä¸­çš„xxxServiceApplicationä¸­ï¼ˆæœ¬èº«ä¹Ÿç®—æ˜¯é…ç½®ç±»ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">randomRule</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œåœ¨xxx-serviceæ¨¡å—ä¸­çš„ymlé…ç½®ä¸­æ·»åŠ </li></ol><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.magus.config.RandomRule</span> <span class="comment"># è§„åˆ™ç±»çš„åç§°</span></span><br></pre></td></tr></table></figure><h2 id="é¥¥é¥¿åŠ è½½"><a href="#é¥¥é¥¿åŠ è½½" class="headerlink" title="é¥¥é¥¿åŠ è½½"></a>é¥¥é¥¿åŠ è½½</h2><p>Ribboné»˜è®¤æ˜¯æ‡’åŠ è½½ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ‰ä¼šåˆ›å»ºLoadBalancerClientï¼Œè¯·æ±‚æ—¶é—´è¾ƒé•¿ã€‚ä½¿ç”¨é¥¥é¥¿åŠ è½½å¯ä»¥åœ¨æœåŠ¡å¯åŠ¨æ—¶å°±åˆ›å»ºï¼Œå‡å°‘è¯·æ±‚æ—¶é—´</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="string">userservice</span> <span class="comment"># å•ä¸ªæœåŠ¡</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="comment"># å¤šä¸ªæœåŠ¡</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">userservice</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">orderservice</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Ribbon </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Eureka</title>
      <link href="/2023/08/30/SpringCloud-Eureka/"/>
      <url>/2023/08/30/SpringCloud-Eureka/</url>
      
        <content type="html"><![CDATA[<h2 id="Eurekaè§’è‰²"><a href="#Eurekaè§’è‰²" class="headerlink" title="Eurekaè§’è‰²"></a>Eurekaè§’è‰²</h2><p>æœåŠ¡ç«¯ï¼šEurekaServerï¼ŒæœåŠ¡ç«¯ï¼Œæ³¨å†Œä¸­å¿ƒã€‚è´Ÿè´£å¿ƒè·³ç›‘æ§ï¼Œè®°å½•æœåŠ¡ä¿¡æ¯</p><p>å®¢æˆ·ç«¯ï¼šEurekaClientï¼Œåˆ†ä¸ºæ¶ˆè´¹è€…å’Œæä¾›è€…ã€‚</p><h2 id="Eurekaçš„ä½œç”¨"><a href="#Eurekaçš„ä½œç”¨" class="headerlink" title="Eurekaçš„ä½œç”¨"></a>Eurekaçš„ä½œç”¨</h2><p>eurekaæœåŠ¡ç±»ä¼¼æ³¨å†Œä¸­å¿ƒï¼š</p><ol><li>æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…å°†æœåŠ¡ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</li><li>æ¶ˆè´¹è€…å‘æ³¨å†Œä¸­å¿ƒæ‹‰å–æä¾›è€…çš„æ–°æ¶ˆæ¯</li><li>é€šè¿‡è´Ÿè½½å‡è¡¡è¿›è¡Œé€‰æ‹©</li><li>å®ç°è¿œç¨‹è°ƒç”¨</li></ol><p>æ³¨å†Œä¸­å¿ƒä½¿ç”¨å¿ƒè·³ç»­çº¦ï¼Œéšæ—¶ç›‘æ§æœåŠ¡çŠ¶æ€</p><h2 id="Eurekaæ­å»º"><a href="#Eurekaæ­å»º" class="headerlink" title="Eurekaæ­å»º"></a>Eurekaæ­å»º</h2><p>æ­å»ºæœåŠ¡æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥spring-cloud-starter-netflix-eureka-serverä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- EurekaæœåŠ¡ç«¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœçˆ¶å·¥ç¨‹ä¸­å·²ç»é€‰å¥½äº†springcloudçš„ç‰ˆæœ¬ä»¥åŠç›¸å…³ä¾èµ–ï¼Œè¿™é‡Œä¸éœ€è¦å¡«å†™ç‰ˆæœ¬å·</p><ol start="2"><li>ç¼–å†™å¯åŠ¨ç±»ï¼Œå¹¶æ·»åŠ @EnableEurekaServeræ³¨è§£</li><li>ç¼–å†™ymlé…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯å£ã€æœåŠ¡åç§°ã€åœ°å€ä¿¡æ¯ï¼ˆç”¨äºeurekaé›†ç¾¤é€šä¿¡ï¼‰</li></ol><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Tomcat</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9099</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Spring</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hms_eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">sevice-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:$&#123;server.port&#125;/eureka</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œé€‰æ‹©ä¸å°†è‡ªå·±æ³¨å†Œ </span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ³¨å†Œ"></a>æœåŠ¡æ³¨å†Œ</h2><p>åœ¨ä¾èµ–ä¸­å¼•å…¥</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Eurekaå®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶åœ¨application.ymlä¸­é…ç½®eurekaç›¸å…³ä¿¡æ¯</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:9099/eureka</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå¯åŠ¨ç±»ä¸Šè¦åŠ ä¸Š@EnableEurekaServeræ³¨è§£</p><p>ä¸€ç›´é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæ—¥å¿—å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2023-08-30 16:57:34.306  INFO 1076 --- [           main] com.magus.UserServiceApplication         : No active profile <span class="built_in">set</span>, falling back to default profiles: default</span><br><span class="line">2023-08-30 16:57:34.580  INFO 1076 --- [           main] o.s.cloud.context.scope.GenericScope     : BeanFactory <span class="built_in">id</span>=24ae86d6-4a71-3421-838c-868a60323ef7</span><br><span class="line">2023-08-30 16:57:34.621  INFO 1076 --- [           main] trationDelegate<span class="variable">$BeanPostProcessorChecker</span> : Bean <span class="string">&#x27;org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration&#x27;</span> of <span class="built_in">type</span> [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$<span class="variable">$9adaa148</span>] is not eligible <span class="keyword">for</span> getting processed by all BeanPostProcessors (<span class="keyword">for</span> example: not eligible <span class="keyword">for</span> auto-proxying)</span><br><span class="line">2023-08-30 16:57:34.632  INFO 1076 --- [           main] trationDelegate<span class="variable">$BeanPostProcessorChecker</span> : Bean <span class="string">&#x27;org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration&#x27;</span> of <span class="built_in">type</span> [org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration$$EnhancerBySpringCGLIB$<span class="variable">$b6f4a445</span>] is not eligible <span class="keyword">for</span> getting processed by all BeanPostProcessors (<span class="keyword">for</span> example: not eligible <span class="keyword">for</span> auto-proxying)</span><br><span class="line">2023-08-30 16:57:34.644  WARN 1076 --- [           main] c.n.c.sources.URLConfigurationSource     : No URLs will be polled as dynamic configuration sources.</span><br><span class="line">2023-08-30 16:57:34.644  INFO 1076 --- [           main] c.n.c.sources.URLConfigurationSource     : To <span class="built_in">enable</span> URLs as dynamic configuration sources, define System property archaius.configurationSource.additionalUrls or make config.properties available on classpath.</span><br><span class="line">2023-08-30 16:57:34.649  WARN 1076 --- [           main] c.n.c.sources.URLConfigurationSource     : No URLs will be polled as dynamic configuration sources.</span><br><span class="line">2023-08-30 16:57:34.649  INFO 1076 --- [           main] c.n.c.sources.URLConfigurationSource     : To <span class="built_in">enable</span> URLs as dynamic configuration sources, define System property archaius.configurationSource.additionalUrls or make config.properties available on classpath.</span><br><span class="line">2023-08-30 16:57:36.516  INFO 1076 --- [           main] o.s.cloud.commons.util.InetUtils         : Cannot determine <span class="built_in">local</span> hostname</span><br><span class="line">2023-08-30 16:57:38.145  INFO 1076 --- [           main] o.s.cloud.commons.util.InetUtils         : Cannot determine <span class="built_in">local</span> hostname</span><br><span class="line">2023-08-30 16:57:38.203  INFO 1076 --- [           main] o.s.c.n.eureka.InstanceInfoFactory       : Setting initial instance status as: STARTING</span><br><span class="line">2023-08-30 16:57:38.224  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Initializing Eureka <span class="keyword">in</span> region us-east-1</span><br><span class="line">2023-08-30 16:57:38.855  INFO 1076 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using JSON encoding codec LegacyJacksonJson</span><br><span class="line">2023-08-30 16:57:38.855  INFO 1076 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using JSON decoding codec LegacyJacksonJson</span><br><span class="line">2023-08-30 16:57:38.928  INFO 1076 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using XML encoding codec XStreamXml</span><br><span class="line">2023-08-30 16:57:38.929  INFO 1076 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using XML decoding codec XStreamXml</span><br><span class="line">2023-08-30 16:57:39.042  INFO 1076 --- [           main] c.n.d.s.r.aws.ConfigClusterResolver      : Resolving eureka endpoints via configuration</span><br><span class="line">2023-08-30 16:57:39.460  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Disable delta property : <span class="literal">false</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Single vip registry refresh property : null</span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Force full registry fetch : <span class="literal">false</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Application is null : <span class="literal">false</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Registered Applications size is zero : <span class="literal">true</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Application version is -1: <span class="literal">true</span></span><br><span class="line">2023-08-30 16:57:39.461  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Getting all instance registry info from the eureka server</span><br><span class="line">2023-08-30 16:57:39.535  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : The response status is 200</span><br><span class="line">2023-08-30 16:57:39.536  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Starting heartbeat executor: renew interval is: 30</span><br><span class="line">2023-08-30 16:57:39.538  INFO 1076 --- [           main] c.n.discovery.InstanceInfoReplicator     : InstanceInfoReplicator onDemand update allowed rate per min is 4</span><br><span class="line">2023-08-30 16:57:39.541  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Discovery Client initialized at timestamp 1693385859540 with initial instances count: 0</span><br><span class="line">2023-08-30 16:57:39.542  INFO 1076 --- [           main] o.s.c.n.e.s.EurekaServiceRegistry        : Registering application USER-SERVICE with eureka with status UP</span><br><span class="line">2023-08-30 16:57:39.543  INFO 1076 --- [           main] com.netflix.discovery.DiscoveryClient    : Saw <span class="built_in">local</span> status change event StatusChangeEvent [timestamp=1693385859543, current=UP, previous=STARTING]</span><br><span class="line">2023-08-30 16:57:39.544  INFO 1076 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999: registering service...</span><br><span class="line">2023-08-30 16:57:39.554  INFO 1076 --- [           main] com.magus.UserServiceApplication         : Started UserServiceApplication <span class="keyword">in</span> 9.058 seconds (JVM running <span class="keyword">for</span> 10.165)</span><br><span class="line">2023-08-30 16:57:39.556  INFO 1076 --- [       Thread-5] o.s.c.n.e.s.EurekaServiceRegistry        : Unregistering application USER-SERVICE with eureka with status DOWN</span><br><span class="line">2023-08-30 16:57:39.557  WARN 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : Saw <span class="built_in">local</span> status change event StatusChangeEvent [timestamp=1693385859557, current=DOWN, previous=UP]</span><br><span class="line">2023-08-30 16:57:39.561  INFO 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : Shutting down DiscoveryClient ...</span><br><span class="line">2023-08-30 16:57:39.602  INFO 1076 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999 - registration status: 204</span><br><span class="line">2023-08-30 16:57:39.603  INFO 1076 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999: registering service...</span><br><span class="line">2023-08-30 16:57:39.614  INFO 1076 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999 - registration status: 204</span><br><span class="line">2023-08-30 16:57:39.615  INFO 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : Unregistering ...</span><br><span class="line">2023-08-30 16:57:39.630  INFO 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_USER-SERVICE/localhost:user-service:9999 - deregister  status: 200</span><br><span class="line">2023-08-30 16:57:39.637  INFO 1076 --- [       Thread-5] com.netflix.discovery.DiscoveryClient    : Completed shut down of DiscoveryClient</span><br></pre></td></tr></table></figure><p><strong>åŸå› ï¼š</strong> Eurekaå®¢æˆ·ç«¯ï¼ˆæœåŠ¡æä¾›è€…&#x2F;æ¶ˆè´¹è€…ï¼‰æ²¡æœ‰æˆåŠŸå¼•å…¥webçš„starterï¼ˆå¤´ç–¼äº†åŠå°æ—¶ï¼‰ã€‚</p><h3 id="æ³¨å†Œå¤šä¸ªå®ä¾‹"><a href="#æ³¨å†Œå¤šä¸ªå®ä¾‹" class="headerlink" title="æ³¨å†Œå¤šä¸ªå®ä¾‹"></a>æ³¨å†Œå¤šä¸ªå®ä¾‹</h3><p>å¯ä»¥å¯¹æœåŠ¡çš„é…ç½®è¿›è¡Œå¤åˆ¶ç„¶ååœ¨VMè®¾ç½®ä¸­æ·»åŠ å‚æ•°-Dserver.port&#x3D;xxxx</p><h2 id="æœåŠ¡æ‹‰å–"><a href="#æœåŠ¡æ‹‰å–" class="headerlink" title="æœåŠ¡æ‹‰å–"></a>æœåŠ¡æ‹‰å–</h2><ol><li>åŒæ³¨å†Œï¼Œå¼•å…¥ä¾èµ–ï¼Œé…ç½®eurekaåœ°å€ã€‚</li><li>ç»™ResTemplateæ·»åŠ @LoadBanlancedæ³¨è§£ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰</li><li>ç”¨æœåŠ¡æä¾›è€…çš„æ³¨å†ŒæœåŠ¡åç§°ä»£æ›¿urlä¸­çš„ä¸€éƒ¨åˆ†è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œä¾‹å¦‚ <a href="http://userservice/user/1">http://userservice/user/1</a> (restful)</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Eurekaèµ·åˆ°ä¸ºæœåŠ¡ä¹‹é—´æä¾›è¿œç¨‹è°ƒç”¨çš„ä½œç”¨ï¼Œæ¥å®ç°å°†æœåŠ¡åˆ†ç¦»åˆèƒ½äº¤äº’</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SpringCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Eureka </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyFirstBlog</title>
      <link href="/2023/08/29/MyFirstBlog/"/>
      <url>/2023/08/29/MyFirstBlog/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬ä¸€ç¯‡æ–‡ç« "><a href="#ç¬¬ä¸€ç¯‡æ–‡ç« " class="headerlink" title="ç¬¬ä¸€ç¯‡æ–‡ç« "></a>ç¬¬ä¸€ç¯‡æ–‡ç« </h2><p>2023å¹´8æœˆ29æ—¥æ­£å¼æ­å»ºå±äºæˆ‘çš„åšå®¢ï¼Œå¸Œæœ›æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½å†™å‡ºåƒhexoä¸€æ ·èƒ½è¢«ç™¾ä¸‡äººä½¿ç”¨çš„project</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
